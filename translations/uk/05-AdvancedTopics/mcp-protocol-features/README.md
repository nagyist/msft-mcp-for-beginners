# –ì–ª–∏–±–æ–∫–µ –∑–∞–Ω—É—Ä–µ–Ω–Ω—è —É —Ñ—É–Ω–∫—Ü—ñ—ó –ø—Ä–æ—Ç–æ–∫–æ–ª—É MCP

–¶–µ–π –ø–æ—Å—ñ–±–Ω–∏–∫ –¥–æ—Å–ª—ñ–¥–∂—É—î —Ä–æ–∑—à–∏—Ä–µ–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –ø—Ä–æ—Ç–æ–∫–æ–ª—É MCP, —â–æ –≤–∏—Ö–æ–¥—è—Ç—å –∑–∞ —Ä–∞–º–∫–∏ –±–∞–∑–æ–≤–æ—ó –æ–±—Ä–æ–±–∫–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —Ç–∞ —Ä–µ—Å—É—Ä—Å—ñ–≤. –†–æ–∑—É–º—ñ–Ω–Ω—è —Ü–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π –¥–æ–ø–æ–º–∞–≥–∞—î —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –±—ñ–ª—å—à –Ω–∞–¥—ñ–π–Ω—ñ, –∑—Ä—É—á–Ω—ñ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —ñ –≥–æ—Ç–æ–≤—ñ –¥–æ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–∞ —Å–µ—Ä–≤–µ—Ä–∏ MCP.

## –†–æ–∑–≥–ª—è–Ω—É—Ç—ñ —Ñ—É–Ω–∫—Ü—ñ—ó

1. **–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ –ø—Ä–æ–≥—Ä–µ—Å** ‚Äì –ü–æ–≤—ñ–¥–æ–º–ª—è—Ç–∏ –ø—Ä–æ –ø—Ä–æ–≥—Ä–µ—Å –ø—Ä–∏ —Ç—Ä–∏–≤–∞–ª–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ—è—Ö  
2. **–°–∫–∞—Å—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤** ‚Äì –î–æ–∑–≤–æ–ª—è—Ç–∏ –∫–ª—ñ—î–Ω—Ç–∞–º —Å–∫–∞—Å–æ–≤—É–≤–∞—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ñ –∑–∞–ø–∏—Ç–∏  
3. **–®–∞–±–ª–æ–Ω–∏ —Ä–µ—Å—É—Ä—Å—ñ–≤** ‚Äì –î–∏–Ω–∞–º—ñ—á–Ω—ñ URI —Ä–µ—Å—É—Ä—Å—ñ–≤ –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏  
4. **–ü–æ–¥—ñ—ó –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É —Å–µ—Ä–≤–µ—Ä–∞** ‚Äì –ü—Ä–∞–≤–∏–ª—å–Ω–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–æ–±–æ—Ç–∏  
5. **–ö–µ—Ä—É–≤–∞–Ω–Ω—è –ª–æ–≥—É–≤–∞–Ω–Ω—è–º** ‚Äì –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è  
6. **–®–∞–±–ª–æ–Ω–∏ –æ–±—Ä–æ–±–∫–∏ –ø–æ–º–∏–ª–æ–∫** ‚Äì –ü–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ –ø–æ–º–∏–ª–∫–∏

---

## 1. –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ –ø—Ä–æ–≥—Ä–µ—Å

–î–ª—è –æ–ø–µ—Ä–∞—Ü—ñ–π, —è–∫—ñ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å —á–∞—Å—É (–æ–±—Ä–æ–±–∫–∞ –¥–∞–Ω–∏—Ö, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤, –≤–∏–∫–ª–∏–∫–∏ API), —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ –ø—Ä–æ–≥—Ä–µ—Å —Ç—Ä–∏–º–∞—é—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É –∫—É—Ä—Å—ñ.

### –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

```mermaid
sequenceDiagram
    participant Client
    participant Server
    
    Client->>Server: tools/call (–¥–æ–≤–≥–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è)
    Server-->>Client: –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: –ø—Ä–æ–≥—Ä–µ—Å 10%
    Server-->>Client: –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: –ø—Ä–æ–≥—Ä–µ—Å 50%
    Server-->>Client: –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: –ø—Ä–æ–≥—Ä–µ—Å 90%
    Server->>Client: —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–∑–∞–≤–µ—Ä—à–µ–Ω–æ)
```  
### –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –Ω–∞ Python

```python
from mcp.server import Server, NotificationOptions
from mcp.types import ProgressNotification
import asyncio

app = Server("progress-server")

@app.tool()
async def process_large_file(file_path: str, ctx) -> str:
    """Process a large file with progress updates."""
    
    # –û—Ç—Ä–∏–º–∞—Ç–∏ —Ä–æ–∑–º—ñ—Ä —Ñ–∞–π–ª—É –¥–ª—è –æ–±—á–∏—Å–ª–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É
    file_size = os.path.getsize(file_path)
    processed = 0
    
    with open(file_path, 'rb') as f:
        while chunk := f.read(8192):
            # –û–±—Ä–æ–±–∏—Ç–∏ —á–∞—Å—Ç–∏–Ω—É
            await process_chunk(chunk)
            processed += len(chunk)
            
            # –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ –ø—Ä–æ–≥—Ä–µ—Å
            progress = (processed / file_size) * 100
            await ctx.send_notification(
                ProgressNotification(
                    progressToken=ctx.request_id,
                    progress=progress,
                    total=100,
                    message=f"Processing: {progress:.1f}%"
                )
            )
    
    return f"Processed {file_size} bytes"

@app.tool()
async def batch_operation(items: list[str], ctx) -> str:
    """Process multiple items with progress."""
    
    results = []
    total = len(items)
    
    for i, item in enumerate(items):
        result = await process_item(item)
        results.append(result)
        
        # –ó–≤—ñ—Ç–∞—Ç–∏ –ø—Ä–æ –ø—Ä–æ–≥—Ä–µ—Å –ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞
        await ctx.send_notification(
            ProgressNotification(
                progressToken=ctx.request_id,
                progress=i + 1,
                total=total,
                message=f"Processed {i + 1}/{total}: {item}"
            )
        )
    
    return f"Completed {total} items"
```
  
### –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –Ω–∞ TypeScript

```typescript
import { Server } from "@modelcontextprotocol/sdk/server/index.js";

server.setRequestHandler(CallToolSchema, async (request, extra) => {
  const { name, arguments: args } = request.params;
  
  if (name === "process_data") {
    const items = args.items as string[];
    const results = [];
    
    for (let i = 0; i < items.length; i++) {
      const result = await processItem(items[i]);
      results.push(result);
      
      // –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø—Ä–æ–≥—Ä–µ—Å
      await extra.sendNotification({
        method: "notifications/progress",
        params: {
          progressToken: request.id,
          progress: i + 1,
          total: items.length,
          message: `Processing item ${i + 1}/${items.length}`
        }
      });
    }
    
    return { content: [{ type: "text", text: JSON.stringify(results) }] };
  }
});
```
  
### –û–±—Ä–æ–±–∫–∞ –Ω–∞ –∫–ª—ñ—î–Ω—Ç—ñ (Python)

```python
async def handle_progress(notification):
    """Handle progress notifications from server."""
    params = notification.params
    print(f"Progress: {params.progress}/{params.total} - {params.message}")

# –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ –æ–±—Ä–æ–±–Ω–∏–∫
session.on_notification("notifications/progress", handle_progress)

# –í–∏–∫–ª–∏–∫–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É –Ω–∞–¥—Ö–æ–¥–∏—Ç–∏–º—É—Ç—å —á–µ—Ä–µ–∑ –æ–±—Ä–æ–±–Ω–∏–∫)
result = await session.call_tool("process_large_file", {"file_path": "/data/large.csv"})
```
  
---

## 2. –°–∫–∞—Å—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤

–î–æ–∑–≤–æ–ª—è—î –∫–ª—ñ—î–Ω—Ç–∞–º —Å–∫–∞—Å–æ–≤—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç–∏, —è–∫—ñ –±—ñ–ª—å—à–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –∞–±–æ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –∑–∞–Ω–∞–¥—Ç–æ –¥–æ–≤–≥–æ.

### –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –Ω–∞ Python

```python
from mcp.server import Server
from mcp.types import CancelledError
import asyncio

app = Server("cancellable-server")

@app.tool()
async def long_running_search(query: str, ctx) -> str:
    """Search that can be cancelled."""
    
    results = []
    
    try:
        for page in range(100):  # –ü–æ—à—É–∫ –ø–æ –±–∞–≥–∞—Ç—å–æ—Ö —Å—Ç–æ—Ä—ñ–Ω–∫–∞—Ö
            # –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –±—É–ª–æ –∑–∞–ø–∏—Ç–∞–Ω–æ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è
            if ctx.is_cancelled:
                raise CancelledError("Search cancelled by user")
            
            # –Ü–º—ñ—Ç—É–≤–∞—Ç–∏ –ø–æ—à—É–∫ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ
            page_results = await search_page(query, page)
            results.extend(page_results)
            
            # –ù–µ–≤–µ–ª–∏–∫–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ –¥–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è
            await asyncio.sleep(0.1)
            
    except CancelledError:
        # –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ —á–∞—Å—Ç–∫–æ–≤—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
        return f"Cancelled. Found {len(results)} results before cancellation."
    
    return f"Found {len(results)} total results"

@app.tool()
async def download_file(url: str, ctx) -> str:
    """Download with cancellation support."""
    
    async with aiohttp.ClientSession() as session:
        async with session.get(url) as response:
            total_size = int(response.headers.get('content-length', 0))
            downloaded = 0
            chunks = []
            
            async for chunk in response.content.iter_chunked(8192):
                if ctx.is_cancelled:
                    return f"Download cancelled at {downloaded}/{total_size} bytes"
                
                chunks.append(chunk)
                downloaded += len(chunk)
            
            return f"Downloaded {downloaded} bytes"
```
  
### –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è

```python
class CancellableContext:
    """Context object that tracks cancellation state."""
    
    def __init__(self, request_id: str):
        self.request_id = request_id
        self._cancelled = asyncio.Event()
        self._cancel_reason = None
    
    @property
    def is_cancelled(self) -> bool:
        return self._cancelled.is_set()
    
    def cancel(self, reason: str = "Cancelled"):
        self._cancel_reason = reason
        self._cancelled.set()
    
    async def check_cancelled(self):
        """Raise if cancelled, otherwise continue."""
        if self.is_cancelled:
            raise CancelledError(self._cancel_reason)
    
    async def sleep_or_cancel(self, seconds: float):
        """Sleep that can be interrupted by cancellation."""
        try:
            await asyncio.wait_for(
                self._cancelled.wait(),
                timeout=seconds
            )
            raise CancelledError(self._cancel_reason)
        except asyncio.TimeoutError:
            pass  # –ó–≤–∏—á–∞–π–Ω–µ —Ç–∞–π–º-–∞—É—Ç, –ø—Ä–æ–¥–æ–≤–∂—É—î–º–æ
```
  
### –°–∫–∞—Å—É–≤–∞–Ω–Ω—è –Ω–∞ –∫–ª—ñ—î–Ω—Ç—Å—å–∫—ñ–π —Å—Ç–æ—Ä–æ–Ω—ñ

```python
import asyncio

async def search_with_timeout(session, query, timeout=30):
    """Search with automatic cancellation on timeout."""
    
    task = asyncio.create_task(
        session.call_tool("long_running_search", {"query": query})
    )
    
    try:
        result = await asyncio.wait_for(task, timeout=timeout)
        return result
    except asyncio.TimeoutError:
        # –ó–∞–ø–∏—Ç —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è
        await session.send_notification({
            "method": "notifications/cancelled",
            "params": {"requestId": task.request_id, "reason": "Timeout"}
        })
        return "Search timed out"
```
  
---

## 3. –®–∞–±–ª–æ–Ω–∏ —Ä–µ—Å—É—Ä—Å—ñ–≤

–®–∞–±–ª–æ–Ω–∏ —Ä–µ—Å—É—Ä—Å—ñ–≤ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –¥–∏–Ω–∞–º—ñ—á–Ω–æ —Ñ–æ—Ä–º—É–≤–∞—Ç–∏ URI –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, —â–æ –∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è API —Ç–∞ –±–∞–∑ –¥–∞–Ω–∏—Ö.

### –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —à–∞–±–ª–æ–Ω—ñ–≤

```python
from mcp.server import Server
from mcp.types import ResourceTemplate

app = Server("template-server")

@app.list_resource_templates()
async def list_templates() -> list[ResourceTemplate]:
    """Return available resource templates."""
    return [
        ResourceTemplate(
            uriTemplate="db://users/{user_id}",
            name="User Profile",
            description="Fetch user profile by ID",
            mimeType="application/json"
        ),
        ResourceTemplate(
            uriTemplate="api://weather/{city}/{date}",
            name="Weather Data",
            description="Historical weather for city and date",
            mimeType="application/json"
        ),
        ResourceTemplate(
            uriTemplate="file://{path}",
            name="File Content",
            description="Read file at given path",
            mimeType="text/plain"
        )
    ]

@app.read_resource()
async def read_resource(uri: str) -> str:
    """Read resource, expanding template parameters."""
    
    # –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π—Ç–µ URI, —â–æ–± –≤–∏—Ç—è–≥—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
    if uri.startswith("db://users/"):
        user_id = uri.split("/")[-1]
        return await fetch_user(user_id)
    
    elif uri.startswith("api://weather/"):
        parts = uri.replace("api://weather/", "").split("/")
        city, date = parts[0], parts[1]
        return await fetch_weather(city, date)
    
    elif uri.startswith("file://"):
        path = uri.replace("file://", "")
        return await read_file(path)
    
    raise ValueError(f"Unknown resource URI: {uri}")
```
  
### –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –Ω–∞ TypeScript

```typescript
server.setRequestHandler(ListResourceTemplatesSchema, async () => {
  return {
    resourceTemplates: [
      {
        uriTemplate: "github://repos/{owner}/{repo}/issues/{issue_number}",
        name: "GitHub Issue",
        description: "Fetch a specific GitHub issue",
        mimeType: "application/json"
      },
      {
        uriTemplate: "db://tables/{table}/rows/{id}",
        name: "Database Row",
        description: "Fetch a row from a database table",
        mimeType: "application/json"
      }
    ]
  };
});

server.setRequestHandler(ReadResourceSchema, async (request) => {
  const uri = request.params.uri;
  
  // –†–æ–∑—ñ–±—Ä–∞—Ç–∏ URI –ø—Ä–æ–±–ª–µ–º–∏ GitHub
  const githubMatch = uri.match(/^github:\/\/repos\/([^/]+)\/([^/]+)\/issues\/(\d+)$/);
  if (githubMatch) {
    const [_, owner, repo, issueNumber] = githubMatch;
    const issue = await fetchGitHubIssue(owner, repo, parseInt(issueNumber));
    return {
      contents: [{
        uri,
        mimeType: "application/json",
        text: JSON.stringify(issue, null, 2)
      }]
    };
  }
  
  throw new Error(`Unknown resource URI: ${uri}`);
});
```
  
---

## 4. –ü–æ–¥—ñ—ó –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É —Å–µ—Ä–≤–µ—Ä–∞

–ü—Ä–∞–≤–∏–ª—å–Ω–∞ —Ä–æ–±–æ—Ç–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –∑–∞–±–µ–∑–ø–µ—á—É—î —á–∏—Å—Ç–µ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å–∞–º–∏.

### –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∂–∏—Ç—Ç—î–≤–∏–º —Ü–∏–∫–ª–æ–º –Ω–∞ Python

```python
from mcp.server import Server
from contextlib import asynccontextmanager

app = Server("lifecycle-server")

# –°–ø—ñ–ª—å–Ω–∏–π —Å—Ç–∞–Ω
db_connection = None
cache = None

@asynccontextmanager
async def lifespan(server: Server):
    """Manage server lifecycle."""
    global db_connection, cache
    
    # –ó–∞–ø—É—Å–∫
    print("üöÄ Server starting...")
    db_connection = await create_database_connection()
    cache = await create_cache_client()
    print("‚úÖ Resources initialized")
    
    yield  # –°–µ—Ä–≤–µ—Ä –ø—Ä–∞—Ü—é—î —Ç—É—Ç
    
    # –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–æ–±–æ—Ç–∏
    print("üõë Server shutting down...")
    await db_connection.close()
    await cache.close()
    print("‚úÖ Resources cleaned up")

app = Server("lifecycle-server", lifespan=lifespan)

@app.tool()
async def query_database(sql: str) -> str:
    """Use the shared database connection."""
    result = await db_connection.execute(sql)
    return str(result)
```
  
### –ñ–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª –Ω–∞ TypeScript

```typescript
import { Server } from "@modelcontextprotocol/sdk/server/index.js";

class ManagedServer {
  private server: Server;
  private dbConnection: DatabaseConnection | null = null;
  
  constructor() {
    this.server = new Server({
      name: "lifecycle-server",
      version: "1.0.0"
    });
    
    this.setupHandlers();
  }
  
  async start() {
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ä–µ—Å—É—Ä—Å–∏
    console.log("üöÄ Server starting...");
    this.dbConnection = await createDatabaseConnection();
    console.log("‚úÖ Database connected");
    
    // –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä
    await this.server.connect(transport);
  }
  
  async stop() {
    // –û—á–∏—Å—Ç–∏—Ç–∏ —Ä–µ—Å—É—Ä—Å–∏
    console.log("üõë Server shutting down...");
    if (this.dbConnection) {
      await this.dbConnection.close();
    }
    await this.server.close();
    console.log("‚úÖ Cleanup complete");
  }
  
  private setupHandlers() {
    this.server.setRequestHandler(CallToolSchema, async (request) => {
      // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ this.dbConnection –±–µ–∑–ø–µ—á–Ω–æ
      // ...
    });
  }
}

// –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑ –ø–ª–∞–≤–Ω–∏–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è–º —Ä–æ–±–æ—Ç–∏
const server = new ManagedServer();

process.on('SIGINT', async () => {
  await server.stop();
  process.exit(0);
});

await server.start();
```
  
---

## 5. –ö–µ—Ä—É–≤–∞–Ω–Ω—è –ª–æ–≥—É–≤–∞–Ω–Ω—è–º

MCP –ø—ñ–¥—Ç—Ä–∏–º—É—î —Å–µ—Ä–≤–µ—Ä–Ω—ñ —Ä—ñ–≤–Ω—ñ –ª–æ–≥—É–≤–∞–Ω–Ω—è, —è–∫—ñ –º–æ–∂—É—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ –∫–ª—ñ—î–Ω—Ç–∏.

### –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è —Ä—ñ–≤–Ω—ñ–≤ –ª–æ–≥—É–≤–∞–Ω–Ω—è

```python
from mcp.server import Server
from mcp.types import LoggingLevel
import logging

app = Server("logging-server")

# –í—ñ–¥–æ–±—Ä–∞–∑–∏—Ç–∏ —Ä—ñ–≤–Ω—ñ MCP –Ω–∞ —Ä—ñ–≤–Ω—ñ –∂—É—Ä–Ω–∞–ª—é–≤–∞–Ω–Ω—è Python
LEVEL_MAP = {
    LoggingLevel.DEBUG: logging.DEBUG,
    LoggingLevel.INFO: logging.INFO,
    LoggingLevel.WARNING: logging.WARNING,
    LoggingLevel.ERROR: logging.ERROR,
}

logger = logging.getLogger("mcp-server")

@app.set_logging_level()
async def set_logging_level(level: LoggingLevel) -> None:
    """Handle client request to change logging level."""
    python_level = LEVEL_MAP.get(level, logging.INFO)
    logger.setLevel(python_level)
    logger.info(f"Logging level set to {level}")

@app.tool()
async def debug_operation(data: str) -> str:
    """Tool with various logging levels."""
    logger.debug(f"Processing data: {data}")
    
    try:
        result = process(data)
        logger.info(f"Successfully processed: {result}")
        return result
    except Exception as e:
        logger.error(f"Processing failed: {e}")
        raise
```
  
### –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∂—É—Ä–Ω–∞–ª—É –∫–ª—ñ—î–Ω—Ç—É

```python
@app.tool()
async def complex_operation(input: str, ctx) -> str:
    """Operation that logs to client."""
    
    # –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∂—É—Ä–Ω–∞–ª –∫–ª—ñ—î–Ω—Ç—É
    await ctx.send_log(
        level="info",
        message=f"Starting complex operation with input: {input}"
    )
    
    # –í–∏–∫–æ–Ω–∞—Ç–∏ —Ä–æ–±–æ—Ç—É...
    result = await do_work(input)
    
    await ctx.send_log(
        level="debug",
        message=f"Operation complete, result size: {len(result)}"
    )
    
    return result
```
  
---

## 6. –®–∞–±–ª–æ–Ω–∏ –æ–±—Ä–æ–±–∫–∏ –ø–æ–º–∏–ª–æ–∫

–ü–æ—Å–ª—ñ–¥–æ–≤–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ –ø–æ–∫—Ä–∞—â—É—î –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è —Ç–∞ –¥–æ—Å–≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

### –ö–æ–¥–∏ –ø–æ–º–∏–ª–æ–∫ MCP

```python
from mcp.types import McpError, ErrorCode

class ToolError(McpError):
    """Base class for tool errors."""
    pass

class ValidationError(ToolError):
    """Invalid input parameters."""
    def __init__(self, message: str):
        super().__init__(ErrorCode.INVALID_PARAMS, message)

class NotFoundError(ToolError):
    """Requested resource not found."""
    def __init__(self, resource: str):
        super().__init__(ErrorCode.INVALID_REQUEST, f"Not found: {resource}")

class PermissionError(ToolError):
    """Access denied."""
    def __init__(self, action: str):
        super().__init__(ErrorCode.INVALID_REQUEST, f"Permission denied: {action}")

class InternalError(ToolError):
    """Internal server error."""
    def __init__(self, message: str):
        super().__init__(ErrorCode.INTERNAL_ERROR, message)
```
  
### –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ –ø–æ–º–∏–ª–∫–∏

```python
@app.tool()
async def safe_operation(input: str) -> str:
    """Tool with comprehensive error handling."""
    
    # –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –≤—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ
    if not input:
        raise ValidationError("Input cannot be empty")
    
    if len(input) > 10000:
        raise ValidationError(f"Input too large: {len(input)} chars (max 10000)")
    
    try:
        # –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–æ–∑–≤–æ–ª–∏
        if not await check_permission(input):
            raise PermissionError(f"read {input}")
        
        # –í–∏–∫–æ–Ω–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—é
        result = await perform_operation(input)
        
        if result is None:
            raise NotFoundError(input)
        
        return result
        
    except ConnectionError as e:
        raise InternalError(f"Database connection failed: {e}")
    except TimeoutError as e:
        raise InternalError(f"Operation timed out: {e}")
    except Exception as e:
        # –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ –Ω–µ–æ—á—ñ–∫—É–≤–∞–Ω—ñ –ø–æ–º–∏–ª–∫–∏
        logger.exception(f"Unexpected error in safe_operation")
        raise InternalError(f"Unexpected error: {type(e).__name__}")
```
  
### –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ –Ω–∞ TypeScript

```typescript
import { McpError, ErrorCode } from "@modelcontextprotocol/sdk/types.js";

function validateInput(data: unknown): asserts data is ValidInput {
  if (typeof data !== "object" || data === null) {
    throw new McpError(
      ErrorCode.InvalidParams,
      "Input must be an object"
    );
  }
  // –ë—ñ–ª—å—à–µ –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫...
}

server.setRequestHandler(CallToolSchema, async (request) => {
  try {
    validateInput(request.params.arguments);
    
    const result = await performOperation(request.params.arguments);
    
    return {
      content: [{ type: "text", text: JSON.stringify(result) }]
    };
    
  } catch (error) {
    if (error instanceof McpError) {
      throw error;  // –í–∂–µ –ø–æ–º–∏–ª–∫–∞ MCP
    }
    
    // –ü–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ —ñ–Ω—à—ñ –ø–æ–º–∏–ª–∫–∏
    if (error instanceof NotFoundError) {
      throw new McpError(ErrorCode.InvalidRequest, error.message);
    }
    
    // –ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞
    console.error("Unexpected error:", error);
    throw new McpError(
      ErrorCode.InternalError,
      "An unexpected error occurred"
    );
  }
});
```
  
---

## –ï–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó (MCP 2025-11-25)

–¶—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –ø–æ–∑–Ω–∞—á–µ–Ω—ñ —è–∫ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ñ —É —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó:

### –ó–∞–≤–¥–∞–Ω–Ω—è (–¥–æ–≤–≥–æ—Ç—Ä–∏–≤–∞–ª—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó)

```python
# –ó–∞–≤–¥–∞–Ω–Ω—è –¥–æ–∑–≤–æ–ª—è—é—Ç—å –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ —Ç—Ä–∏–≤–∞–ª—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑—ñ —Å—Ç–∞–Ω–æ–º
@app.task()
async def training_task(model_id: str, data_path: str, ctx) -> str:
    """Long-running ML training task."""
    
    # –ü–æ–≤—ñ–¥–æ–º—Ç–µ, —â–æ –∑–∞–≤–¥–∞–Ω–Ω—è —Ä–æ–∑–ø–æ—á–∞—Ç–æ
    await ctx.report_status("running", "Initializing training...")
    
    # –¶–∏–∫–ª –Ω–∞–≤—á–∞–Ω–Ω—è
    for epoch in range(100):
        await train_epoch(model_id, data_path, epoch)
        await ctx.report_status(
            "running",
            f"Training epoch {epoch + 1}/100",
            progress=epoch + 1,
            total=100
        )
    
    await ctx.report_status("completed", "Training finished")
    return f"Model {model_id} trained successfully"
```
  
### –ê–Ω–æ—Ç–∞—Ü—ñ—ó —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤

```python
# –ê–Ω–æ—Ç–∞—Ü—ñ—ó –Ω–∞–¥–∞—é—Ç—å –º–µ—Ç–∞–¥–∞–Ω—ñ –ø—Ä–æ –ø–æ–≤–µ–¥—ñ–Ω–∫—É —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É
@app.tool(
    annotations={
        "destructive": False,      # –ù–µ –∑–º—ñ–Ω—é—î –¥–∞–Ω—ñ
        "idempotent": True,        # –ë–µ–∑–ø–µ—á–Ω–æ –ø–æ–≤—Ç–æ—Ä—é–≤–∞—Ç–∏
        "timeout_seconds": 30,     # –û—á—ñ–∫—É–≤–∞–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å
        "requires_approval": False # –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–µ —Å—Ö–≤–∞–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    }
)
async def safe_query(query: str) -> str:
    """A read-only database query tool."""
    return await execute_read_query(query)
```
  
---

## –©–æ –¥–∞–ª—ñ

- [–ú–æ–¥—É–ª—å 8 - –ö—Ä–∞—â—ñ –ø—Ä–∞–∫—Ç–∏–∫–∏](../../08-BestPractices/README.md)  
- [5.14 - –ü—Ä–æ—î–∫—Ç—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É](../mcp-contextengineering/README.md)  
- [–ñ—É—Ä–Ω–∞–ª –∑–º—ñ–Ω —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó MCP](https://spec.modelcontextprotocol.io/)  

---

## –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä–µ—Å—É—Ä—Å–∏

- [–°–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è MCP 2025-11-25](https://spec.modelcontextprotocol.io/specification/2025-11-25/)  
- [–ö–æ–¥–∏ –ø–æ–º–∏–ª–æ–∫ JSON-RPC 2.0](https://www.jsonrpc.org/specification#error_object)  
- [–ü—Ä–∏–∫–ª–∞–¥–∏ SDK –¥–ª—è Python](https://github.com/modelcontextprotocol/python-sdk/tree/main/examples)  
- [–ü—Ä–∏–∫–ª–∞–¥–∏ SDK –¥–ª—è TypeScript](https://github.com/modelcontextprotocol/typescript-sdk/tree/main/examples)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**–í—ñ–¥–º–æ–≤–∞ –≤—ñ–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ**:  
–¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç –±—É–ª–æ –ø–µ—Ä–µ–∫–ª–∞–¥–µ–Ω–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å–µ—Ä–≤—ñ—Å—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª–∞–¥—É [Co-op Translator](https://github.com/Azure/co-op-translator). –•–æ—á–∞ –º–∏ –ø—Ä–∞–≥–Ω–µ–º–æ –¥–æ —Ç–æ—á–Ω–æ—Å—Ç—ñ, –±—É–¥—å –ª–∞—Å–∫–∞, –º–∞–π—Ç–µ –Ω–∞ —É–≤–∞–∑—ñ, —â–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –ø–µ—Ä–µ–∫–ª–∞–¥–∏ –º–æ–∂—É—Ç—å –º—ñ—Å—Ç–∏—Ç–∏ –ø–æ–º–∏–ª–∫–∏ –∞–±–æ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç—ñ. –û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç —Ä—ñ–¥–Ω–æ—é –º–æ–≤–æ—é —Å–ª—ñ–¥ –≤–≤–∞–∂–∞—Ç–∏ –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω–∏–º –¥–∂–µ—Ä–µ–ª–æ–º. –î–ª—è –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—è –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–º –ª—é–¥—Å—å–∫–∏–º –ø–µ—Ä–µ–∫–ª–∞–¥–æ–º. –ú–∏ –Ω–µ –Ω–µ—Å–µ–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å –∑–∞ –±—É–¥—å-—è–∫—ñ –Ω–µ–ø–æ—Ä–æ–∑—É–º—ñ–Ω–Ω—è –∞–±–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ —Ç–ª—É–º–∞—á–µ–Ω–Ω—è, —â–æ –≤–∏–Ω–∏–∫–ª–∏ –≤–Ω–∞—Å–ª—ñ–¥–æ–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ü—å–æ–≥–æ –ø–µ—Ä–µ–∫–ª–∞–¥—É.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->