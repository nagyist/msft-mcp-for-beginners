# –î—ä–ª–±–æ–∫ –ø—Ä–µ–≥–ª–µ–¥ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏—Ç–µ –Ω–∞ MCP –ø—Ä–æ—Ç–æ–∫–æ–ª–∞

–¢–æ–∑–∏ –Ω–∞—Ä—ä—á–Ω–∏–∫ —Ä–∞–∑–≥–ª–µ–∂–¥–∞ —Ä–∞–∑—à–∏—Ä–µ–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ MCP –ø—Ä–æ—Ç–æ–∫–æ–ª–∞, –∫–æ–∏—Ç–æ –Ω–∞–¥—Ö–≤—ä—Ä–ª—è—Ç –æ—Å–Ω–æ–≤–Ω–∞—Ç–∞ —Ä–∞–±–æ—Ç–∞ —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –∏ —Ä–µ—Å—É—Ä—Å–∏. –†–∞–∑–±–∏—Ä–∞–Ω–µ—Ç–æ –Ω–∞ —Ç–µ–∑–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–∏ –ø–æ–º–∞–≥–∞ –¥–∞ –∏–∑–≥—Ä–∞–¥–∏—Ç–µ –ø–æ-–∑–¥—Ä–∞–≤–∏, —É–¥–æ–±–Ω–∏ –∑–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è –∏ –≥–æ—Ç–æ–≤–∏ –∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ MCP —Å—ä—Ä–≤—ä—Ä–∏.

## –û–±—Ö–≤–∞–Ω–∞—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏

1. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫–∞** - –û—Ç—á–∏—Ç–∞–Ω–µ –Ω–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫–∞ –ø—Ä–∏ –¥—ä–ª–≥–æ—Ç—Ä–∞–π–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏  
2. **–û—Ç–º—è–Ω–∞ –Ω–∞ –∑–∞—è–≤–∫–∏** - –ü–æ–∑–≤–æ–ª—è–≤–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∏—Ç–µ –¥–∞ –æ—Ç–º–µ–Ω—è—Ç –∑–∞—è–≤–∫–∏ –≤ –ø—Ä–æ—Ü–µ—Å –Ω–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ  
3. **–®–∞–±–ª–æ–Ω–∏ –∑–∞ —Ä–µ—Å—É—Ä—Å–∏** - –î–∏–Ω–∞–º–∏—á–Ω–∏ URI –∑–∞ —Ä–µ—Å—É—Ä—Å–∏ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏  
4. **–°—ä–±–∏—Ç–∏—è –≤ –∂–∏–∑–Ω–µ–Ω–∏—è —Ü–∏–∫—ä–ª –Ω–∞ —Å—ä—Ä–≤—ä—Ä–∞** - –ö–æ—Ä–µ–∫—Ç–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–ø–∏—Ä–∞–Ω–µ  
5. **–ö–æ–Ω—Ç—Ä–æ–ª –Ω–∞ –ª–æ–≥–≤–∞–Ω–µ—Ç–æ** - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞ –ª–æ–≥–≤–∞–Ω–µ—Ç–æ –æ—Ç —Å—Ç—Ä–∞–Ω–∞ –Ω–∞ —Å—ä—Ä–≤—ä—Ä–∞  
6. **–ú–æ–¥–µ–ª–∏ –∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –≥—Ä–µ—à–∫–∏** - –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–Ω–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏ –ø—Ä–∏ –≥—Ä–µ—à–∫–∏

---

## 1. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫–∞

–ü—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏, –∫–æ–∏—Ç–æ –æ—Ç–Ω–µ–º–∞—Ç –≤—Ä–µ–º–µ (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –¥–∞–Ω–Ω–∏, –∏–∑—Ç–µ–≥–ª—è–Ω–µ –Ω–∞ —Ñ–∞–π–ª–æ–≤–µ, API –ø–æ–≤–∏–∫–≤–∞–Ω–∏—è), —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ç–∞ –∑–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫–∞ –¥—ä—Ä–∂–∞—Ç –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∏—Ä–∞–Ω–∏.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∏

```mermaid
sequenceDiagram
    participant Client
    participant Server
    
    Client->>Server: –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏/–∏–∑–≤–∏–∫–≤–∞–Ω–µ (–¥—ä–ª–≥–∞ –æ–ø–µ—Ä–∞—Ü–∏—è)
    Server-->>Client: –∏–∑–≤–µ—Å—Ç–∏–µ: –ø—Ä–æ–≥—Ä–µ—Å 10%
    Server-->>Client: –∏–∑–≤–µ—Å—Ç–∏–µ: –ø—Ä–æ–≥—Ä–µ—Å 50%
    Server-->>Client: –∏–∑–≤–µ—Å—Ç–∏–µ: –ø—Ä–æ–≥—Ä–µ—Å 90%
    Server->>Client: —Ä–µ–∑—É–ª—Ç–∞—Ç (–∑–∞–≤—ä—Ä—à–µ–Ω–æ)
```
### –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ Python

```python
from mcp.server import Server, NotificationOptions
from mcp.types import ProgressNotification
import asyncio

app = Server("progress-server")

@app.tool()
async def process_large_file(file_path: str, ctx) -> str:
    """Process a large file with progress updates."""
    
    # –í–∑–µ–º–µ—Ç–µ —Ä–∞–∑–º–µ—Ä–∞ –Ω–∞ —Ñ–∞–π–ª–∞ –∑–∞ –∏–∑—á–∏—Å–ª—è–≤–∞–Ω–µ –Ω–∞ –ø—Ä–æ–≥—Ä–µ—Å–∞
    file_size = os.path.getsize(file_path)
    processed = 0
    
    with open(file_path, 'rb') as f:
        while chunk := f.read(8192):
            # –û–±—Ä–∞–±–æ—Ç–µ—Ç–µ —á–∞—Å—Ç –æ—Ç —Ñ–∞–π–ª–∞
            await process_chunk(chunk)
            processed += len(chunk)
            
            # –ò–∑–ø—Ä–∞—Ç–µ—Ç–µ –∏–∑–≤–µ—Å—Ç–∏–µ –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å
            progress = (processed / file_size) * 100
            await ctx.send_notification(
                ProgressNotification(
                    progressToken=ctx.request_id,
                    progress=progress,
                    total=100,
                    message=f"Processing: {progress:.1f}%"
                )
            )
    
    return f"Processed {file_size} bytes"

@app.tool()
async def batch_operation(items: list[str], ctx) -> str:
    """Process multiple items with progress."""
    
    results = []
    total = len(items)
    
    for i, item in enumerate(items):
        result = await process_item(item)
        results.append(result)
        
        # –î–æ–∫–ª–∞–¥–≤–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å–∞ —Å–ª–µ–¥ –≤—Å–µ–∫–∏ –µ–ª–µ–º–µ–Ω—Ç
        await ctx.send_notification(
            ProgressNotification(
                progressToken=ctx.request_id,
                progress=i + 1,
                total=total,
                message=f"Processed {i + 1}/{total}: {item}"
            )
        )
    
    return f"Completed {total} items"
```

### –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ TypeScript

```typescript
import { Server } from "@modelcontextprotocol/sdk/server/index.js";

server.setRequestHandler(CallToolSchema, async (request, extra) => {
  const { name, arguments: args } = request.params;
  
  if (name === "process_data") {
    const items = args.items as string[];
    const results = [];
    
    for (let i = 0; i < items.length; i++) {
      const result = await processItem(items[i]);
      results.push(result);
      
      // –ò–∑–ø—Ä–∞—Ç–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞ –Ω–∞–ø—Ä–µ–¥—ä–∫
      await extra.sendNotification({
        method: "notifications/progress",
        params: {
          progressToken: request.id,
          progress: i + 1,
          total: items.length,
          message: `Processing item ${i + 1}/${items.length}`
        }
      });
    }
    
    return { content: [{ type: "text", text: JSON.stringify(results) }] };
  }
});
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ (Python)

```python
async def handle_progress(notification):
    """Handle progress notifications from server."""
    params = notification.params
    print(f"Progress: {params.progress}/{params.total} - {params.message}")

# –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
session.on_notification("notifications/progress", handle_progress)

# –ò–∑–≤–∏–∫–∞–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (–∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ –ø—Ä–æ–≥—Ä–µ—Å–∞ —â–µ –ø—Ä–∏—Å—Ç–∏–≥–∞—Ç —á—Ä–µ–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞)
result = await session.call_tool("process_large_file", {"file_path": "/data/large.csv"})
```

---

## 2. –û—Ç–º—è–Ω–∞ –Ω–∞ –∑–∞—è–≤–∫–∏

–ü–æ–∑–≤–æ–ª–µ—Ç–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∏—Ç–µ –¥–∞ –æ—Ç–º–µ–Ω—è—Ç –∑–∞—è–≤–∫–∏, –∫–æ–∏—Ç–æ –≤–µ—á–µ –Ω–µ —Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∏ –∏–ª–∏ –æ—Ç–Ω–µ–º–∞—Ç —Ç–≤—ä—Ä–¥–µ –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ.

### –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ Python

```python
from mcp.server import Server
from mcp.types import CancelledError
import asyncio

app = Server("cancellable-server")

@app.tool()
async def long_running_search(query: str, ctx) -> str:
    """Search that can be cancelled."""
    
    results = []
    
    try:
        for page in range(100):  # –¢—ä—Ä—Å–µ–Ω–µ –ø—Ä–µ–∑ –º–Ω–æ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∏
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ –µ –ø–æ–∏—Å–∫–∞–Ω–∞ –æ—Ç–º—è–Ω–∞
            if ctx.is_cancelled:
                raise CancelledError("Search cancelled by user")
            
            # –°–∏–º—É–ª–∏—Ä–∞–Ω–µ –Ω–∞ —Ç—ä—Ä—Å–µ–Ω–µ –≤ —Å—Ç—Ä–∞–Ω–∏—Ü–∞
            page_results = await search_page(query, page)
            results.extend(page_results)
            
            # –ú–∞–ª–∫–∞ –ø–∞—É–∑–∞ –ø–æ–∑–≤–æ–ª—è–≤–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞ –æ—Ç–º—è–Ω–∞
            await asyncio.sleep(0.1)
            
    except CancelledError:
        # –í—Ä—ä—â–∞–Ω–µ –Ω–∞ —á–∞—Å—Ç–∏—á–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏
        return f"Cancelled. Found {len(results)} results before cancellation."
    
    return f"Found {len(results)} total results"

@app.tool()
async def download_file(url: str, ctx) -> str:
    """Download with cancellation support."""
    
    async with aiohttp.ClientSession() as session:
        async with session.get(url) as response:
            total_size = int(response.headers.get('content-length', 0))
            downloaded = 0
            chunks = []
            
            async for chunk in response.content.iter_chunked(8192):
                if ctx.is_cancelled:
                    return f"Download cancelled at {downloaded}/{total_size} bytes"
                
                chunks.append(chunk)
                downloaded += len(chunk)
            
            return f"Downloaded {downloaded} bytes"
```

### –†–µ–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞ –æ—Ç–º—è–Ω–∞

```python
class CancellableContext:
    """Context object that tracks cancellation state."""
    
    def __init__(self, request_id: str):
        self.request_id = request_id
        self._cancelled = asyncio.Event()
        self._cancel_reason = None
    
    @property
    def is_cancelled(self) -> bool:
        return self._cancelled.is_set()
    
    def cancel(self, reason: str = "Cancelled"):
        self._cancel_reason = reason
        self._cancelled.set()
    
    async def check_cancelled(self):
        """Raise if cancelled, otherwise continue."""
        if self.is_cancelled:
            raise CancelledError(self._cancel_reason)
    
    async def sleep_or_cancel(self, seconds: float):
        """Sleep that can be interrupted by cancellation."""
        try:
            await asyncio.wait_for(
                self._cancelled.wait(),
                timeout=seconds
            )
            raise CancelledError(self._cancel_reason)
        except asyncio.TimeoutError:
            pass  # –ù–æ—Ä–º–∞–ª–Ω–æ –∏–∑—á–∞–∫–≤–∞–Ω–µ, –ø—Ä–æ–¥—ä–ª–∂–∏
```

### –û—Ç–º—è–Ω–∞ –æ—Ç —Å—Ç—Ä–∞–Ω–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞

```python
import asyncio

async def search_with_timeout(session, query, timeout=30):
    """Search with automatic cancellation on timeout."""
    
    task = asyncio.create_task(
        session.call_tool("long_running_search", {"query": query})
    )
    
    try:
        result = await asyncio.wait_for(task, timeout=timeout)
        return result
    except asyncio.TimeoutError:
        # –ó–∞—è–≤–∫–∞ –∑–∞ –∞–Ω—É–ª–∏—Ä–∞–Ω–µ
        await session.send_notification({
            "method": "notifications/cancelled",
            "params": {"requestId": task.request_id, "reason": "Timeout"}
        })
        return "Search timed out"
```

---

## 3. –®–∞–±–ª–æ–Ω–∏ –∑–∞ —Ä–µ—Å—É—Ä—Å–∏

–®–∞–±–ª–æ–Ω–∏—Ç–µ –∑–∞ —Ä–µ—Å—É—Ä—Å–∏ –ø–æ–∑–≤–æ–ª—è–≤–∞—Ç –¥–∏–Ω–∞–º–∏—á–Ω–æ —Å—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ URI —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏, –ø–æ–ª–µ–∑–Ω–æ –∑–∞ API-—Ç–∞ –∏ –±–∞–∑–∏ –¥–∞–Ω–Ω–∏.

### –î–µ—Ñ–∏–Ω–∏—Ä–∞–Ω–µ –Ω–∞ —à–∞–±–ª–æ–Ω–∏

```python
from mcp.server import Server
from mcp.types import ResourceTemplate

app = Server("template-server")

@app.list_resource_templates()
async def list_templates() -> list[ResourceTemplate]:
    """Return available resource templates."""
    return [
        ResourceTemplate(
            uriTemplate="db://users/{user_id}",
            name="User Profile",
            description="Fetch user profile by ID",
            mimeType="application/json"
        ),
        ResourceTemplate(
            uriTemplate="api://weather/{city}/{date}",
            name="Weather Data",
            description="Historical weather for city and date",
            mimeType="application/json"
        ),
        ResourceTemplate(
            uriTemplate="file://{path}",
            name="File Content",
            description="Read file at given path",
            mimeType="text/plain"
        )
    ]

@app.read_resource()
async def read_resource(uri: str) -> str:
    """Read resource, expanding template parameters."""
    
    # –ê–Ω–∞–ª–∏–∑–∏—Ä–∞–π—Ç–µ URI, –∑–∞ –¥–∞ –∏–∑–≤–ª–µ—á–µ—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏—Ç–µ
    if uri.startswith("db://users/"):
        user_id = uri.split("/")[-1]
        return await fetch_user(user_id)
    
    elif uri.startswith("api://weather/"):
        parts = uri.replace("api://weather/", "").split("/")
        city, date = parts[0], parts[1]
        return await fetch_weather(city, date)
    
    elif uri.startswith("file://"):
        path = uri.replace("file://", "")
        return await read_file(path)
    
    raise ValueError(f"Unknown resource URI: {uri}")
```

### –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ TypeScript

```typescript
server.setRequestHandler(ListResourceTemplatesSchema, async () => {
  return {
    resourceTemplates: [
      {
        uriTemplate: "github://repos/{owner}/{repo}/issues/{issue_number}",
        name: "GitHub Issue",
        description: "Fetch a specific GitHub issue",
        mimeType: "application/json"
      },
      {
        uriTemplate: "db://tables/{table}/rows/{id}",
        name: "Database Row",
        description: "Fetch a row from a database table",
        mimeType: "application/json"
      }
    ]
  };
});

server.setRequestHandler(ReadResourceSchema, async (request) => {
  const uri = request.params.uri;
  
  // –ê–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ URI –∑–∞ GitHub –ø—Ä–æ–±–ª–µ–º
  const githubMatch = uri.match(/^github:\/\/repos\/([^/]+)\/([^/]+)\/issues\/(\d+)$/);
  if (githubMatch) {
    const [_, owner, repo, issueNumber] = githubMatch;
    const issue = await fetchGitHubIssue(owner, repo, parseInt(issueNumber));
    return {
      contents: [{
        uri,
        mimeType: "application/json",
        text: JSON.stringify(issue, null, 2)
      }]
    };
  }
  
  throw new Error(`Unknown resource URI: ${uri}`);
});
```

---

## 4. –°—ä–±–∏—Ç–∏—è –≤ –∂–∏–∑–Ω–µ–Ω–∏—è —Ü–∏–∫—ä–ª –Ω–∞ —Å—ä—Ä–≤—ä—Ä–∞

–ö–æ—Ä–µ–∫—Ç–Ω–æ—Ç–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –∏ —Å–ø–∏—Ä–∞–Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–∞ —á–∏—Å—Ç–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ä–µ—Å—É—Ä—Å–∏—Ç–µ.

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –∂–∏–∑–Ω–µ–Ω–∏—è —Ü–∏–∫—ä–ª –≤ Python

```python
from mcp.server import Server
from contextlib import asynccontextmanager

app = Server("lifecycle-server")

# –°–ø–æ–¥–µ–ª–µ–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ
db_connection = None
cache = None

@asynccontextmanager
async def lifespan(server: Server):
    """Manage server lifecycle."""
    global db_connection, cache
    
    # –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ
    print("üöÄ Server starting...")
    db_connection = await create_database_connection()
    cache = await create_cache_client()
    print("‚úÖ Resources initialized")
    
    yield  # –°—ä—Ä–≤—ä—Ä—ä—Ç —Ä–∞–±–æ—Ç–∏ —Ç—É–∫
    
    # –ò–∑–∫–ª—é—á–≤–∞–Ω–µ
    print("üõë Server shutting down...")
    await db_connection.close()
    await cache.close()
    print("‚úÖ Resources cleaned up")

app = Server("lifecycle-server", lifespan=lifespan)

@app.tool()
async def query_database(sql: str) -> str:
    """Use the shared database connection."""
    result = await db_connection.execute(sql)
    return str(result)
```

### –ñ–∏–∑–Ω–µ–Ω —Ü–∏–∫—ä–ª –≤ TypeScript

```typescript
import { Server } from "@modelcontextprotocol/sdk/server/index.js";

class ManagedServer {
  private server: Server;
  private dbConnection: DatabaseConnection | null = null;
  
  constructor() {
    this.server = new Server({
      name: "lifecycle-server",
      version: "1.0.0"
    });
    
    this.setupHandlers();
  }
  
  async start() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ —Ä–µ—Å—É—Ä—Å–∏
    console.log("üöÄ Server starting...");
    this.dbConnection = await createDatabaseConnection();
    console.log("‚úÖ Database connected");
    
    // –°—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Å—ä—Ä–≤—ä—Ä–∞
    await this.server.connect(transport);
  }
  
  async stop() {
    // –ü–æ—á–∏—Å—Ç–≤–∞–Ω–µ –Ω–∞ —Ä–µ—Å—É—Ä—Å–∏—Ç–µ
    console.log("üõë Server shutting down...");
    if (this.dbConnection) {
      await this.dbConnection.close();
    }
    await this.server.close();
    console.log("‚úÖ Cleanup complete");
  }
  
  private setupHandlers() {
    this.server.setRequestHandler(CallToolSchema, async (request) => {
      // –ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ this.dbConnection –±–µ–∑–æ–ø–∞—Å–Ω–æ
      // ...
    });
  }
}

// –ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ —Å –ø–ª–∞–≤–Ω–æ –∏–∑–∫–ª—é—á–≤–∞–Ω–µ
const server = new ManagedServer();

process.on('SIGINT', async () => {
  await server.stop();
  process.exit(0);
});

await server.start();
```

---

## 5. –ö–æ–Ω—Ç—Ä–æ–ª –Ω–∞ –ª–æ–≥–≤–∞–Ω–µ—Ç–æ

MCP –ø–æ–¥–¥—ä—Ä–∂–∞ –Ω–∏–≤–∞ –Ω–∞ –ª–æ–≥–≤–∞–Ω–µ –æ—Ç —Å—Ç—Ä–∞–Ω–∞ –Ω–∞ —Å—ä—Ä–≤—ä—Ä–∞, –∫–æ–∏—Ç–æ –∫–ª–∏–µ–Ω—Ç–∏—Ç–µ –º–æ–≥–∞—Ç –¥–∞ —É–ø—Ä–∞–≤–ª—è–≤–∞—Ç.

### –ò–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –Ω–∏–≤–∞ –Ω–∞ –ª–æ–≥–≤–∞–Ω–µ

```python
from mcp.server import Server
from mcp.types import LoggingLevel
import logging

app = Server("logging-server")

# –°—ä–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–∞ –Ω–∏–≤–∞—Ç–∞ MCP —Å –Ω–∏–≤–∞—Ç–∞ –Ω–∞ –ª–æ–≥–≤–∞–Ω–µ –≤ Python
LEVEL_MAP = {
    LoggingLevel.DEBUG: logging.DEBUG,
    LoggingLevel.INFO: logging.INFO,
    LoggingLevel.WARNING: logging.WARNING,
    LoggingLevel.ERROR: logging.ERROR,
}

logger = logging.getLogger("mcp-server")

@app.set_logging_level()
async def set_logging_level(level: LoggingLevel) -> None:
    """Handle client request to change logging level."""
    python_level = LEVEL_MAP.get(level, logging.INFO)
    logger.setLevel(python_level)
    logger.info(f"Logging level set to {level}")

@app.tool()
async def debug_operation(data: str) -> str:
    """Tool with various logging levels."""
    logger.debug(f"Processing data: {data}")
    
    try:
        result = process(data)
        logger.info(f"Successfully processed: {result}")
        return result
    except Exception as e:
        logger.error(f"Processing failed: {e}")
        raise
```

### –ò–∑–ø—Ä–∞—â–∞–Ω–µ –Ω–∞ –ª–æ–≥ —Å—ä–æ–±—â–µ–Ω–∏—è –∫—ä–º –∫–ª–∏–µ–Ω—Ç–∞

```python
@app.tool()
async def complex_operation(input: str, ctx) -> str:
    """Operation that logs to client."""
    
    # –ò–∑–ø—Ä–∞—Ç–µ—Ç–µ –∏–∑–≤–µ—Å—Ç–∏–µ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–µ–Ω —Ñ–∞–π–ª –∫—ä–º –∫–ª–∏–µ–Ω—Ç–∞
    await ctx.send_log(
        level="info",
        message=f"Starting complex operation with input: {input}"
    )
    
    # –ò–∑–ø—ä–ª–Ω–µ—Ç–µ —Ä–∞–±–æ—Ç–∞...
    result = await do_work(input)
    
    await ctx.send_log(
        level="debug",
        message=f"Operation complete, result size: {len(result)}"
    )
    
    return result
```

---

## 6. –ú–æ–¥–µ–ª–∏ –∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –≥—Ä–µ—à–∫–∏

–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–Ω–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –≥—Ä–µ—à–∫–∏ –ø–æ–¥–æ–±—Ä—è–≤–∞ –¥–µ–±—ä–≥–≤–∞–Ω–µ—Ç–æ –∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–æ—Ç–æ –∏–∑–∂–∏–≤—è–≤–∞–Ω–µ.

### MCP –∫–æ–¥–æ–≤–µ –∑–∞ –≥—Ä–µ—à–∫–∏

```python
from mcp.types import McpError, ErrorCode

class ToolError(McpError):
    """Base class for tool errors."""
    pass

class ValidationError(ToolError):
    """Invalid input parameters."""
    def __init__(self, message: str):
        super().__init__(ErrorCode.INVALID_PARAMS, message)

class NotFoundError(ToolError):
    """Requested resource not found."""
    def __init__(self, resource: str):
        super().__init__(ErrorCode.INVALID_REQUEST, f"Not found: {resource}")

class PermissionError(ToolError):
    """Access denied."""
    def __init__(self, action: str):
        super().__init__(ErrorCode.INVALID_REQUEST, f"Permission denied: {action}")

class InternalError(ToolError):
    """Internal server error."""
    def __init__(self, message: str):
        super().__init__(ErrorCode.INTERNAL_ERROR, message)
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–∞–Ω–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏ –ø—Ä–∏ –≥—Ä–µ—à–∫–∏

```python
@app.tool()
async def safe_operation(input: str) -> str:
    """Tool with comprehensive error handling."""
    
    # –í–∞–ª–∏–¥–∏—Ä–∞–Ω–µ –Ω–∞ –≤—Ö–æ–¥–∞
    if not input:
        raise ValidationError("Input cannot be empty")
    
    if len(input) > 10000:
        raise ValidationError(f"Input too large: {len(input)} chars (max 10000)")
    
    try:
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è—Ç–∞
        if not await check_permission(input):
            raise PermissionError(f"read {input}")
        
        # –ò–∑–≤—ä—Ä—à–≤–∞–Ω–µ –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è
        result = await perform_operation(input)
        
        if result is None:
            raise NotFoundError(input)
        
        return result
        
    except ConnectionError as e:
        raise InternalError(f"Database connection failed: {e}")
    except TimeoutError as e:
        raise InternalError(f"Operation timed out: {e}")
    except Exception as e:
        # –ó–∞–ø–∏—Å–≤–∞–Ω–µ –Ω–∞ –Ω–µ–æ—á–∞–∫–≤–∞–Ω–∏ –≥—Ä–µ—à–∫–∏ –≤ –∂—É—Ä–Ω–∞–ª
        logger.exception(f"Unexpected error in safe_operation")
        raise InternalError(f"Unexpected error: {type(e).__name__}")
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –≥—Ä–µ—à–∫–∏ –≤ TypeScript

```typescript
import { McpError, ErrorCode } from "@modelcontextprotocol/sdk/types.js";

function validateInput(data: unknown): asserts data is ValidInput {
  if (typeof data !== "object" || data === null) {
    throw new McpError(
      ErrorCode.InvalidParams,
      "Input must be an object"
    );
  }
  // –ü–æ–≤–µ—á–µ –≤–∞–ª–∏–¥–∞—Ü–∏—è...
}

server.setRequestHandler(CallToolSchema, async (request) => {
  try {
    validateInput(request.params.arguments);
    
    const result = await performOperation(request.params.arguments);
    
    return {
      content: [{ type: "text", text: JSON.stringify(result) }]
    };
    
  } catch (error) {
    if (error instanceof McpError) {
      throw error;  // –í–µ—á–µ –µ –≥—Ä–µ—à–∫–∞ –æ—Ç MCP
    }
    
    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –¥—Ä—É–≥–∏ –≥—Ä–µ—à–∫–∏
    if (error instanceof NotFoundError) {
      throw new McpError(ErrorCode.InvalidRequest, error.message);
    }
    
    // –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞ –≥—Ä–µ—à–∫–∞
    console.error("Unexpected error:", error);
    throw new McpError(
      ErrorCode.InternalError,
      "An unexpected error occurred"
    );
  }
});
```

---

## –ï–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏ (MCP 2025-11-25)

–¢–µ–∑–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∞ –º–∞—Ä–∫–∏—Ä–∞–Ω–∏ –∫–∞—Ç–æ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª–Ω–∏ –≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è—Ç–∞:

### –ó–∞–¥–∞—á–∏ (–¥—ä–ª–≥–æ—Ç—Ä–∞–π–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏)

```python
# –ó–∞–¥–∞—á–∏—Ç–µ –ø–æ–∑–≤–æ–ª—è–≤–∞—Ç –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ –¥—ä–ª–≥–æ—Ç—Ä–∞–π–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å—ä—Å —Å—ä—Å—Ç–æ—è–Ω–∏–µ
@app.task()
async def training_task(model_id: str, data_path: str, ctx) -> str:
    """Long-running ML training task."""
    
    # –û—Ç—á–µ—Ç –∑–∞ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –∑–∞–¥–∞—á–∞—Ç–∞
    await ctx.report_status("running", "Initializing training...")
    
    # –¶–∏–∫—ä–ª –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ
    for epoch in range(100):
        await train_epoch(model_id, data_path, epoch)
        await ctx.report_status(
            "running",
            f"Training epoch {epoch + 1}/100",
            progress=epoch + 1,
            total=100
        )
    
    await ctx.report_status("completed", "Training finished")
    return f"Model {model_id} trained successfully"
```

### –ê–Ω–æ—Ç–∞—Ü–∏–∏ –Ω–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏—Ç–µ

```python
# –ê–Ω–æ—Ç–∞—Ü–∏–∏—Ç–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—è—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω–∏ –∑–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ—Ç–æ –Ω–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
@app.tool(
    annotations={
        "destructive": False,      # –ù–µ –ø—Ä–æ–º–µ–Ω—è –¥–∞–Ω–Ω–∏—Ç–µ
        "idempotent": True,        # –ë–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ –æ–ø–∏—Ç–≤–∞–Ω–µ
        "timeout_seconds": 30,     # –û—á–∞–∫–≤–∞–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª–Ω–∞ –ø—Ä–æ–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ—Å—Ç
        "requires_approval": False # –ù–µ —Å–µ –∏–∑–∏—Å–∫–≤–∞ –æ–¥–æ–±—Ä–µ–Ω–∏–µ –æ—Ç –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è
    }
)
async def safe_query(query: str) -> str:
    """A read-only database query tool."""
    return await execute_read_query(query)
```

---

## –ö–∞–∫–≤–æ —Å–ª–µ–¥–≤–∞

- [–ú–æ–¥—É–ª 8 - –î–æ–±—Ä–∏ –ø—Ä–∞–∫—Ç–∏–∫–∏](../../08-BestPractices/README.md)  
- [5.14 - –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ –∏–Ω–∂–µ–Ω–µ—Ä—Å—Ç–≤–æ](../mcp-contextengineering/README.md)  
- [–ñ—É—Ä–Ω–∞–ª –Ω–∞ –ø—Ä–æ–º–µ–Ω–∏—Ç–µ –≤ MCP —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è—Ç–∞](https://spec.modelcontextprotocol.io/)

---

## –î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ —Ä–µ—Å—É—Ä—Å–∏

- [MCP –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è 2025-11-25](https://spec.modelcontextprotocol.io/specification/2025-11-25/)  
- [JSON-RPC 2.0 –ö–æ–¥–æ–≤–µ –∑–∞ –≥—Ä–µ—à–∫–∏](https://www.jsonrpc.org/specification#error_object)  
- [–ü—Ä–∏–º–µ—Ä–∏ –∑–∞ Python SDK](https://github.com/modelcontextprotocol/python-sdk/tree/main/examples)  
- [–ü—Ä–∏–º–µ—Ä–∏ –∑–∞ TypeScript SDK](https://github.com/modelcontextprotocol/typescript-sdk/tree/main/examples)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**–û—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç**:
–¢–æ–∑–∏ –¥–æ–∫—É–º–µ–Ω—Ç –µ –ø—Ä–µ–≤–µ–¥–µ–Ω —Å –ø–æ–º–æ—â—Ç–∞ –Ω–∞ AI –ø—Ä–µ–≤–æ–¥–∞—á–µ—Å–∫–∞ —É—Å–ª—É–≥–∞ [Co-op Translator](https://github.com/Azure/co-op-translator). –í—ä–ø—Ä–µ–∫–∏ —á–µ —Å–µ —Å—Ç—Ä–µ–º–∏–º –∫—ä–º —Ç–æ—á–Ω–æ—Å—Ç, –º–æ–ª—è, –∏–º–∞–π—Ç–µ –ø—Ä–µ–¥–≤–∏–¥, —á–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–∞–Ω–∏—Ç–µ –ø—Ä–µ–≤–æ–¥–∏ –º–æ–≥–∞—Ç –¥–∞ —Å—ä–¥—ä—Ä–∂–∞—Ç –≥—Ä–µ—à–∫–∏ –∏–ª–∏ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏. –û—Ä–∏–≥–∏–Ω–∞–ª–Ω–∏—è—Ç –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ –Ω–µ–≥–æ–≤–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª–µ–Ω –µ–∑–∏–∫ —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–µ —Å—á–∏—Ç–∞ –∑–∞ –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–µ–Ω –∏–∑—Ç–æ—á–Ω–∏–∫. –ó–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–µ –ø—Ä–µ–ø–æ—Ä—ä—á–≤–∞ –ø—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–µ–Ω —á–æ–≤–µ—à–∫–∏ –ø—Ä–µ–≤–æ–¥. –ù–µ –Ω–æ—Å–∏–º –æ—Ç–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç –∑–∞ –∫–∞–∫–≤–∏—Ç–æ –∏ –¥–∞ –µ –Ω–µ–¥–æ—Ä–∞–∑—É–º–µ–Ω–∏—è –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª–Ω–∏ —Ç—ä–ª–∫—É–≤–∞–Ω–∏—è, –ø—Ä–æ–∏–∑—Ç–∏—á–∞—â–∏ –æ—Ç –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ—Ç–æ –Ω–∞ —Ç–æ–∑–∏ –ø—Ä–µ–≤–æ–¥.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->