# AI ро╡рпЗро▓рпИрокрпНрокро╛роЯрпБроХро│рпИ рокро╛родрпБроХро╛роХрпНроХрпБродро▓рпН: рооро╛роЯро▓рпН роЪрпВро┤ро▓рпН роирпЖро▒ро┐роорпБро▒рпИ роЪрпЗро╡рпИропроХроЩрпНроХро│рпБроХрпНроХрпБ Entra ID роЕроЩрпНроХрпАроХро╛ро░роорпН

## роЕро▒ро┐роорпБроХроорпН
роЙроЩрпНроХро│рпН рооро╛роЯро▓рпН роЪрпВро┤ро▓рпН роирпЖро▒ро┐роорпБро▒рпИ (MCP) роЪрпЗро╡рпИропроХродрпНродрпИ рокро╛родрпБроХро╛рокрпНрокродрпБ роЙроЩрпНроХро│рпН ро╡рпАроЯрпНроЯро┐ройрпН роорпБройрпНрокроХрпНроХ роХродро╡рпИ рокрпВроЯрпНроЯрпБро╡родрпБ рокрпЛро▓ роорпБроХрпНроХро┐ропрооро╛ройродрпБ. MCP роЪрпЗро╡рпИропроХродрпНродрпИ родро┐ро▒роирпНродро╡ро┐роЯрпБро╡родрпБ роЙроЩрпНроХро│рпН роХро░рпБро╡ро┐роХро│рпН рооро▒рпНро▒рпБроорпН родро░ро╡рпБроХро│рпИ роЕройрпБроородро┐ропро▒рпНро▒ роЕрогрпБроХро▓рпБроХрпНроХрпБ ро╡рпЖро│ро┐рокрпНрокроЯрпБродрпНродрпБроХро┐ро▒родрпБ, роЗродрпБ рокро╛родрпБроХро╛рокрпНрокрпБ роорпАро▒ро▓рпНроХро│рпБроХрпНроХрпБ ро╡ро┤ро┐ро╡роХрпБроХрпНроХрпБроорпН. Microsoft Entra ID роТро░рпБ ро╡ро▓рпБро╡ро╛рой роорпЗроХ роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓ро╛рой роЕроЯрпИропро╛ро│роорпН рооро▒рпНро▒рпБроорпН роЕрогрпБроХро▓рпН роорпЗро▓ро╛рогрпНроорпИ родрпАро░рпНро╡рпИ ро╡ро┤роЩрпНроХрпБроХро┐ро▒родрпБ, роЙроЩрпНроХро│рпН MCP роЪрпЗро╡рпИропроХродрпНродрпБроЯройрпН родрпКроЯро░рпНрокрпБ роХрпКро│рпНро│ роЕройрпБроородро┐ропро│ро┐роХрпНроХрокрпНрокроЯрпНроЯ рокропройро░рпНроХро│рпН рооро▒рпНро▒рпБроорпН рокропройрпНрокро╛роЯрпБроХро│рпН роороЯрпНроЯрпБроорпЗ роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНрод роЙродро╡рпБроХро┐ро▒родрпБ. роЗроирпНрод рокро┐ро░ро┐ро╡ро┐ро▓рпН, Entra ID роЕроЩрпНроХрпАроХро╛ро░родрпНродрпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ роЙроЩрпНроХро│рпН AI ро╡рпЗро▓рпИрокрпНрокро╛роЯрпБроХро│рпИ роОрокрпНрокроЯро┐ рокро╛родрпБроХро╛роХрпНроХро▓ро╛роорпН роОройрпНрокродрпИ роирпАроЩрпНроХро│рпН роХро▒рпНро▒рпБроХрпНроХрпКро│рпНро╡рпАро░рпНроХро│рпН.

## роХро▒рпНро▒ро▓рпН роирпЛроХрпНроХроЩрпНроХро│рпН
роЗроирпНрод рокро┐ро░ро┐ро╡ро┐ройрпН роорпБроЯро┐ро╡ро┐ро▓рпН, роирпАроЩрпНроХро│рпН:

- MCP роЪрпЗро╡рпИропроХроЩрпНроХро│рпИ рокро╛родрпБроХро╛рокрпНрокродро┐ройрпН роорпБроХрпНроХро┐ропродрпНродрпБро╡родрпНродрпИ рокрпБро░ро┐роирпНродрпБроХрпКро│рпНро│ро▓ро╛роорпН.
- Microsoft Entra ID рооро▒рпНро▒рпБроорпН OAuth 2.0 роЕроЩрпНроХрпАроХро╛ро░родрпНродро┐ройрпН роЕроЯро┐рокрпНрокроЯрпИроХро│рпИ ро╡ро┐ро│роХрпНроХро▓ро╛роорпН.
- рокрпКродрпБро╡ро╛рой рооро▒рпНро▒рпБроорпН ро░роХроЪро┐ропрооро╛рой роХро┐ро│рпИропройрпНроЯрпБроХро│рпБроХрпНроХрпБ роЗроЯрпИропро┐ро▓ро╛рой ро╡рпЗро▒рпБрокро╛роЯрпНроЯрпИ роЕро▒ро┐ропро▓ро╛роорпН.
- роЙро│рпНро│рпВро░рпН (рокрпКродрпБ роХро┐ро│рпИропройрпНроЯрпН) рооро▒рпНро▒рпБроорпН родрпКро▓рпИродрпВро░ (ро░роХроЪро┐роп роХро┐ро│рпИропройрпНроЯрпН) MCP роЪрпЗро╡рпИропроХ роЪрпВро┤ро▓рпНроХро│ро┐ро▓рпН Entra ID роЕроЩрпНроХрпАроХро╛ро░родрпНродрпИ роЪрпЖропро▓рпНрокроЯрпБродрпНродро▓ро╛роорпН.
- AI ро╡рпЗро▓рпИрокрпНрокро╛роЯрпБроХро│рпИ роЙро░рпБро╡ро╛роХрпНроХрпБроорпНрокрпЛродрпБ рокро╛родрпБроХро╛рокрпНрокрпБ роЪро┐ро▒роирпНрод роироЯрпИроорпБро▒рпИроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродро▓ро╛роорпН.

## рокро╛родрпБроХро╛рокрпНрокрпБ рооро▒рпНро▒рпБроорпН MCP

роирпАроЩрпНроХро│рпН роЙроЩрпНроХро│рпН ро╡рпАроЯрпНроЯро┐ройрпН роорпБройрпНрокроХрпНроХ роХродро╡рпИ родро┐ро▒роирпНродро╡ро┐роЯ рооро╛роЯрпНроЯрпАро░рпНроХро│рпН рокрпЛро▓, роЙроЩрпНроХро│рпН MCP роЪрпЗро╡рпИропроХродрпНродрпИ ропро╛ро░рпБроорпН роЕрогрпБроХ роорпБроЯро┐ропро╛родро╡ро╛ро▒рпБ родро┐ро▒роирпНродро╡ро┐роЯ роХрпВроЯро╛родрпБ. роЙроЩрпНроХро│рпН AI ро╡рпЗро▓рпИрокрпНрокро╛роЯрпБроХро│рпИ рокро╛родрпБроХро╛рокрпНрокродрпБ ро╡ро▓рпБро╡ро╛рой, роироорпНрокроХрооро╛рой рооро▒рпНро▒рпБроорпН рокро╛родрпБроХро╛рокрпНрокро╛рой рокропройрпНрокро╛роЯрпБроХро│рпИ роЙро░рпБро╡ро╛роХрпНроХрпБро╡родро▒рпНроХрпБ роЕро╡роЪро┐ропрооро╛ройродрпБ. роЗроирпНрод роЕродрпНродро┐ропро╛ропроорпН Microsoft Entra ID роР MCP роЪрпЗро╡рпИропроХроЩрпНроХро│рпИ рокро╛родрпБроХро╛роХрпНроХ рокропройрпНрокроЯрпБродрпНродрпБро╡родрпБ рокро▒рпНро▒ро┐ роЕро▒ро┐роорпБроХрокрпНрокроЯрпБродрпНродрпБроорпН, роЙроЩрпНроХро│рпН роХро░рпБро╡ро┐роХро│рпН рооро▒рпНро▒рпБроорпН родро░ро╡рпБроХро│рпБроЯройрпН родрпКроЯро░рпНрокрпБ роХрпКро│рпНро│ роЕройрпБроородро┐ропро│ро┐роХрпНроХрокрпНрокроЯрпНроЯ рокропройро░рпНроХро│рпН рооро▒рпНро▒рпБроорпН рокропройрпНрокро╛роЯрпБроХро│рпН роороЯрпНроЯрпБроорпЗ роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНродрпБроорпН.

## MCP роЪрпЗро╡рпИропроХроЩрпНроХро│рпБроХрпНроХрпБ рокро╛родрпБроХро╛рокрпНрокрпБ роПройрпН роорпБроХрпНроХро┐ропроорпН

роЙроЩрпНроХро│рпН MCP роЪрпЗро╡рпИропроХродрпНродро┐ро▓рпН рооро┐ройрпНройроЮрпНроЪро▓рпНроХро│рпИ роЕройрпБрокрпНрок роЕро▓рпНро▓родрпБ ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН родро░ро╡рпБродрпНродрпКроХрпБрокрпНрокрпИ роЕрогрпБроХ роТро░рпБ роХро░рпБро╡ро┐ роЙро│рпНро│родрпБ роОройрпНро▒рпБ роХро▒рпНрокройрпИ роЪрпЖропрпНропрпБроЩрпНроХро│рпН. рокро╛родрпБроХро╛роХрпНроХрокрпНрокроЯро╛род роЪрпЗро╡рпИропроХроорпН роОройрпНро▒ро╛ро▓рпН ропро╛ро░рпБроорпН роЕроирпНрод роХро░рпБро╡ро┐ропрпИ рокропройрпНрокроЯрпБродрпНрод роорпБроЯро┐ропрпБроорпН, роЗродрпБ роЕройрпБроородро┐ропро▒рпНро▒ родро░ро╡ро┐ройрпИ роЕрогрпБроХро▓рпН, ро╕рпНрокро╛роорпН роЕро▓рпНро▓родрпБ рокро┐ро▒ родрпАро╡ро┐ро░ роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпБроХрпНроХрпБ ро╡ро┤ро┐ро╡роХрпБроХрпНроХрпБроорпН.

роЕроЩрпНроХрпАроХро╛ро░родрпНродрпИ роЪрпЖропро▓рпНрокроЯрпБродрпНродрпБро╡родройрпН роорпВро▓роорпН, роЙроЩрпНроХро│рпН роЪрпЗро╡рпИропроХродрпНродро┐ро▒рпНроХрпБ ро╡ро░рпБроорпН роТро╡рпНро╡рпКро░рпБ роХрпЛро░ро┐роХрпНроХрпИропрпБроорпН роЪро░ро┐рокро╛ро░рпНроХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ, роХрпЛро░ро┐роХрпНроХрпИропрпИроЪрпН роЪрпЖропрпНропрпБроорпН рокропройро░рпН роЕро▓рпНро▓родрпБ рокропройрпНрокро╛роЯрпНроЯро┐ройрпН роЕроЯрпИропро╛ро│родрпНродрпИ роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНродрпБроХро┐ро▒родрпБ. роЗродрпБ роЙроЩрпНроХро│рпН AI ро╡рпЗро▓рпИрокрпНрокро╛роЯрпБроХро│рпИ рокро╛родрпБроХро╛роХрпНроХрпБроорпН роорпБродро▓рпН рооро▒рпНро▒рпБроорпН рооро┐роХ роорпБроХрпНроХро┐ропрооро╛рой рокроЯро┐ропро╛роХрпБроорпН.

## Microsoft Entra ID роЕро▒ро┐роорпБроХроорпН

[**Microsoft Entra ID**](https://adoption.microsoft.com/microsoft-security/entra/) роОройрпНрокродрпБ роорпЗроХ роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓ро╛рой роЕроЯрпИропро╛ро│роорпН рооро▒рпНро▒рпБроорпН роЕрогрпБроХро▓рпН роорпЗро▓ро╛рогрпНроорпИ роЪрпЗро╡рпИ. роЙроЩрпНроХро│рпН рокропройрпНрокро╛роЯрпБроХро│рпБроХрпНроХрпБ роТро░рпБ роЙро▓роХро│ро╛ро╡ро┐роп рокро╛родрпБроХро╛рокрпНрокрпБ роХро╛ро╡ро▓ро╛ро│ро┐ рокрпЛро▓ роЗродрпИ роиро┐ройрпИроХрпНроХро▓ро╛роорпН. роЗродрпБ рокропройро░рпН роЕроЯрпИропро╛ро│роЩрпНроХро│рпИ (роЕроЩрпНроХрпАроХро╛ро░роорпН) роЪро░ро┐рокро╛ро░рпНрокрпНрокродро▒рпНроХрпБроорпН роЕро╡ро░рпНроХро│рпН роОройрпНрой роЪрпЖропрпНроп роЕройрпБроородро┐роХрпНроХрокрпНрокроЯрпБроХро┐ро▒ро╛ро░рпНроХро│рпН роОройрпНрокродрпИ (роЕроЩрпНроХрпАроХро╛ро░роорпН) родрпАро░рпНрооро╛ройро┐рокрпНрокродро▒рпНроХрпБроорпН роЪро┐роХрпНроХро▓ро╛рой роЪрпЖропро▓рпНроорпБро▒рпИропрпИ роХрпИропро╛ро│рпБроХро┐ро▒родрпБ.

Entra ID роРрокрпН рокропройрпНрокроЯрпБродрпНродрпБро╡родройрпН роорпВро▓роорпН, роирпАроЩрпНроХро│рпН:

- рокропройро░рпНроХро│рпБроХрпНроХрпБ рокро╛родрпБроХро╛рокрпНрокро╛рой роЙро│рпНроирпБро┤рпИро╡рпИ роЪрпЖропро▓рпНрокроЯрпБродрпНродро▓ро╛роорпН.
- APIроХрпНроХро│рпН рооро▒рпНро▒рпБроорпН роЪрпЗро╡рпИроХро│рпИ рокро╛родрпБроХро╛роХрпНроХро▓ро╛роорпН.
- роорпИроп роЗроЯродрпНродро┐ро▓рпН роЕрогрпБроХро▓рпН роХрпКро│рпНроХрпИроХро│рпИ роиро┐ро░рпНро╡роХро┐роХрпНроХро▓ро╛роорпН.

MCP роЪрпЗро╡рпИропроХроЩрпНроХро│рпБроХрпНроХрпБ, Entra ID роЙроЩрпНроХро│рпН роЪрпЗро╡рпИропроХродрпНродро┐ройрпН родро┐ро▒ройрпНроХро│рпИ ропро╛ро░рпН роЕрогрпБроХ роорпБроЯро┐ропрпБроорпН роОройрпНрокродрпИ роиро┐ро░рпНро╡роХро┐роХрпНроХ роТро░рпБ ро╡ро▓рпБро╡ро╛рой рооро▒рпНро▒рпБроорпН рокро░ро╡ро▓ро╛роХ роироорпНрокроХрооро╛рой родрпАро░рпНро╡рпИ ро╡ро┤роЩрпНроХрпБроХро┐ро▒родрпБ.

---

## роороирпНродро┐ро░родрпНродрпИрокрпН рокрпБро░ро┐роирпНродрпБроХрпКро│рпНро│рпБродро▓рпН: Entra ID роЕроЩрпНроХрпАроХро╛ро░роорпН роОрокрпНрокроЯро┐ ро╡рпЗро▓рпИ роЪрпЖропрпНроХро┐ро▒родрпБ

Entra ID **OAuth 2.0** рокрпЛройрпНро▒ родро┐ро▒роирпНрод родро░роиро┐ро▓рпИроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ роЕроЩрпНроХрпАроХро╛ро░родрпНродрпИ роХрпИропро╛ро│рпБроХро┐ро▒родрпБ. ро╡ро┐ро╡ро░роЩрпНроХро│рпН роЪро┐роХрпНроХро▓ро╛роХ роЗро░рпБроХрпНроХро▓ро╛роорпН, роЖройро╛ро▓рпН роорпБроХрпНроХро┐роп роХро░рпБродрпНродрпБ роОро│ро┐роорпИропро╛ройродрпБ рооро▒рпНро▒рпБроорпН роТро░рпБ роТрокрпНрокрпБроорпИропрпБроЯройрпН рокрпБро░ро┐роирпНродрпБроХрпКро│рпНро│ро▓ро╛роорпН.

### OAuth 2.0 роХрпНроХрпБ роТро░рпБ роорпЖройрпНроорпИропро╛рой роЕро▒ро┐роорпБроХроорпН: ро╡ро╛ро▓рпЖроЯрпН роХрпА

OAuth 2.0 роР роЙроЩрпНроХро│рпН роХро╛ро░рпБроХрпНроХро╛рой ро╡ро╛ро▓рпЖроЯрпН роЪрпЗро╡рпИропро╛роХ роиро┐ройрпИроХрпНроХро╡рпБроорпН. роирпАроЩрпНроХро│рпН роТро░рпБ роЙрогро╡роХродрпНродро┐ро▒рпНроХрпБ ро╡ро░рпБроорпНрокрпЛродрпБ, ро╡ро╛ро▓рпЖроЯрпНроЯрпБроХрпНроХрпБ роЙроЩрпНроХро│рпН рооро╛ро╕рпНроЯро░рпН роХрпАропрпИ роХрпКроЯрпБроХрпНроХ рооро╛роЯрпНроЯрпАро░рпНроХро│рпН. роЕродро▒рпНроХрпБ рокродро┐ро▓ро╛роХ, роирпАроЩрпНроХро│рпН роТро░рпБ **ро╡ро╛ро▓рпЖроЯрпН роХрпА** роХрпКроЯрпБроХрпНроХро┐ро▒рпАро░рпНроХро│рпН, роЗродрпБ ро╡ро░рпИропро▒рпБроХрпНроХрокрпНрокроЯрпНроЯ роЕройрпБроородро┐роХро│рпИ роХрпКрогрпНроЯрпБро│рпНро│родрпБтАФроЗродрпБ роХро╛ро░рпИ родрпКроЯроЩрпНроХро╡рпБроорпН роХродро╡рпБроХро│рпИ рокрпВроЯрпНроЯро╡рпБроорпН роорпБроЯро┐ропрпБроорпН, роЖройро╛ро▓рпН роЯро┐ро░роЩрпНроХрпН роЕро▓рпНро▓родрпБ роХрпНро│ро╡рпН роХроорпНрокро╛ро░рпНроЯрпНроорпЖрогрпНроЯрпНроЯрпИ родро┐ро▒роХрпНроХ роорпБроЯро┐ропро╛родрпБ.

роЗроирпНрод роТрокрпНрокрпБроорпИропро┐ро▓рпН:

- **роирпАроЩрпНроХро│рпН** **рокропройро░рпН**.
- **роЙроЩрпНроХро│рпН роХро╛ро░рпН** **MCP роЪрпЗро╡рпИропроХроорпН** роЕродройрпН роородро┐рокрпНрокрпБрооро┐роХрпНроХ роХро░рпБро╡ро┐роХро│рпН рооро▒рпНро▒рпБроорпН родро░ро╡рпБроХро│рпБроЯройрпН.
- **ро╡ро╛ро▓рпЖроЯрпН** **Microsoft Entra ID**.
- **рокро╛ро░рпНроХрпНроХро┐роЩрпН роЕроЯрпЖрогрпНроЯройрпНроЯрпН** **MCP роХро┐ро│рпИропройрпНроЯрпН** (роЪрпЗро╡рпИропроХродрпНродрпИ роЕрогрпБроХ роорпБропро▒рпНроЪро┐роХрпНроХрпБроорпН рокропройрпНрокро╛роЯрпБ).
- **ро╡ро╛ро▓рпЖроЯрпН роХрпА** **роЕрогрпБроХро▓рпН роЯрпЛроХрпНроХройрпН**.

роЕрогрпБроХро▓рпН роЯрпЛроХрпНроХройрпН роОройрпНрокродрпБ Entra ID роЙро│рпНроирпБро┤рпИроирпНрод рокро┐ро▒роХрпБ MCP роХро┐ро│рпИропройрпНроЯрпН рокрпЖро▒рпБроорпН роТро░рпБ рокро╛родрпБроХро╛рокрпНрокро╛рой роЙро░рпИ. роХро┐ро│рпИропройрпНроЯрпН роЗроирпНрод роЯрпЛроХрпНроХройрпИ MCP роЪрпЗро╡рпИропроХродрпНродрпБроХрпНроХрпБ роТро╡рпНро╡рпКро░рпБ роХрпЛро░ро┐роХрпНроХрпИропро┐ро▓рпБроорпН ро╡ро┤роЩрпНроХрпБроХро┐ро▒родрпБ. роЪрпЗро╡рпИропроХроорпН роЯрпЛроХрпНроХройрпИ роЪро░ро┐рокро╛ро░рпНродрпНродрпБ роХрпЛро░ро┐роХрпНроХрпИ роЪроЯрпНроЯрокрпВро░рпНро╡рооро╛ройродрпБ рооро▒рпНро▒рпБроорпН роХро┐ро│рпИропройрпНроЯрпБроХрпНроХрпБ родрпЗро╡рпИропро╛рой роЕройрпБроородро┐роХро│рпН роЙро│рпНро│рой роОройрпНрокродрпИ роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНрод роорпБроЯро┐ропрпБроорпН, роЙроЩрпНроХро│рпН роЙрогрпНроорпИропро╛рой роЪро╛ройрпНро▒рпБроХро│рпИ (роЙроЩрпНроХро│рпН роХроЯро╡рпБроЪрпНроЪрпКро▓рпН рокрпЛройрпНро▒ро╡рпИ) роХрпИропро╛ро│ро╛рооро▓рпН.

### роЕроЩрпНроХрпАроХро╛ро░родрпНродро┐ройрпН роУроЯрпНроЯроорпН

роЗродрпБ роироЯрпИроорпБро▒рпИропро┐ро▓рпН роОрокрпНрокроЯро┐ ро╡рпЗро▓рпИ роЪрпЖропрпНроХро┐ро▒родрпБ:

```mermaid
sequenceDiagram
    actor User as ЁЯСд User
    participant Client as ЁЯЦея╕П MCP Client
    participant Entra as ЁЯФР Microsoft Entra ID
    participant Server as ЁЯФз MCP Server

    Client->>+User: Please sign in to continue.
    User->>+Entra: Enters credentials (username/password).
    Entra-->>Client: Here is your access token.
    User-->>-Client: (Returns to the application)

    Client->>+Server: I need to use a tool. Here is my access token.
    Server->>+Entra: Is this access token valid?
    Entra-->>-Server: Yes, it is.
    Server-->>-Client: Token is valid. Here is the result of the tool.
```

### Microsoft Authentication Library (MSAL) роЕро▒ро┐роорпБроХроорпН

роХрпБро▒ро┐ропрпАроЯрпНроЯро┐ро▓рпН роЪрпЖро▓рпНро▓рпБроорпН роорпБройрпН, роорпБроХрпНроХро┐ропрооро╛рой роТро░рпБ роХрпВро▒рпИ роЕро▒ро┐роорпБроХрокрпНрокроЯрпБродрпНродрпБро╡родрпБ роорпБроХрпНроХро┐ропроорпН: **Microsoft Authentication Library (MSAL)**.

MSAL роОройрпНрокродрпБ Microsoft роЙро░рпБро╡ро╛роХрпНроХро┐роп роТро░рпБ роирпВро▓роХроорпН, роЗродрпБ роЯрпЖро╡ро▓рокрпНрокро░рпНроХро│рпБроХрпНроХрпБ роЕроЩрпНроХрпАроХро╛ро░родрпНродрпИ роХрпИропро╛ро│ рооро┐роХро╡рпБроорпН роОро│ро┐родро╛роХрпНроХрпБроХро┐ро▒родрпБ. рокро╛родрпБроХро╛рокрпНрокрпБ роЯрпЛроХрпНроХройрпНроХро│рпИ роХрпИропро╛ро│рпБродро▓рпН, роЙро│рпНроирпБро┤рпИро╡рпИ роиро┐ро░рпНро╡роХро┐родрпНродро▓рпН рооро▒рпНро▒рпБроорпН роЕрооро░рпНро╡рпБроХро│рпИ рокрпБродрпБрокрпНрокро┐родрпНродро▓рпН рокрпЛройрпНро▒ роЪро┐роХрпНроХро▓ро╛рой роХрпБро▒ро┐ропрпАроЯрпНроЯрпИ роирпАроЩрпНроХро│рпН роОро┤рпБрод ро╡рпЗрогрпНроЯро┐роп роЕро╡роЪро┐ропрооро┐ро▓рпНро▓ро╛рооро▓рпН MSAL роЗроирпНрод роЪрпБроорпИропрпИ роХрпИропро╛ро│рпБроХро┐ро▒родрпБ.

MSAL роРрокрпН рокропройрпНрокроЯрпБродрпНродрпБро╡родрпБ рооро┐роХро╡рпБроорпН рокро░ро┐роирпНродрпБро░рпИроХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ, роПройрпЖройро┐ро▓рпН:

- **роЗродрпБ рокро╛родрпБроХро╛рокрпНрокро╛ройродрпБ:** роЗродрпБ родрпКро┤ро┐ро▓рпНродрпБро▒рпИ родро░роиро┐ро▓рпИроХро│рпН рооро▒рпНро▒рпБроорпН рокро╛родрпБроХро╛рокрпНрокрпБ роЪро┐ро▒роирпНрод роироЯрпИроорпБро▒рпИроХро│рпИ роЪрпЖропро▓рпНрокроЯрпБродрпНродрпБроХро┐ро▒родрпБ, роЙроЩрпНроХро│рпН роХрпБро▒ро┐ропрпАроЯрпНроЯро┐ро▓рпН рокро╛родро┐рокрпНрокрпБ роПро▒рпНрокроЯрпБроорпН роЕрокро╛ропродрпНродрпИ роХрпБро▒рпИроХрпНроХро┐ро▒родрпБ.
- **роЗродрпБ ро╡ро│ро░рпНроЪрпНроЪро┐ропрпИ роОро│ро┐родро╛роХрпНроХрпБроХро┐ро▒родрпБ:** роЗродрпБ OAuth 2.0 рооро▒рпНро▒рпБроорпН OpenID Connect роирпЖро▒ро┐роорпБро▒рпИроХро│ро┐ройрпН роЪро┐роХрпНроХро▓рпНроХро│рпИ роЕроХро▒рпНро▒рпБроХро┐ро▒родрпБ, роЙроЩрпНроХро│рпН рокропройрпНрокро╛роЯрпНроЯро┐ро▓рпН ро╡ро▓рпБро╡ро╛рой роЕроЩрпНроХрпАроХро╛ро░родрпНродрпИ роЪро┐ро▓ ро╡ро░ро┐роХро│ро┐ройрпН роХрпБро▒ро┐ропрпАроЯрпНроЯрпБроЯройрпН роЪрпЗро░рпНроХрпНроХ роЕройрпБроородро┐роХрпНроХро┐ро▒родрпБ.
- **роЗродрпБ рокро░ро╛рооро░ро┐роХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ:** Microsoft рокрпБродро┐роп рокро╛родрпБроХро╛рокрпНрокрпБ роЕроЪрпНроЪрпБро▒рпБродрпНродро▓рпНроХро│рпН рооро▒рпНро▒рпБроорпН родро│ рооро╛ро▒рпНро▒роЩрпНроХро│рпИродрпН родрпАро░рпНроХрпНроХ MSAL роРроЪрпН роЪрпЖропро▓рпНрокроЯрпБродрпНродрпБроХро┐ро▒родрпБ рооро▒рпНро▒рпБроорпН рокрпБродрпБрокрпНрокро┐роХрпНроХро┐ро▒родрпБ.

MSAL рокро▓рпНро╡рпЗро▒рпБ роорпКро┤ро┐роХро│рпН рооро▒рпНро▒рпБроорпН рокропройрпНрокро╛роЯрпНроЯрпБ роХроЯрпНроЯроорпИрокрпНрокрпБроХро│рпИ роЖродро░ро┐роХрпНроХро┐ро▒родрпБ, .NET, JavaScript/TypeScript, Python, Java, Go рооро▒рпНро▒рпБроорпН iOS рооро▒рпНро▒рпБроорпН Android рокрпЛройрпНро▒ роорпКрокрпИро▓рпН родро│роЩрпНроХро│рпИ роЙро│рпНро│роЯроХрпНроХро┐ропродрпБ. роЗродрпБ роЙроЩрпНроХро│рпН роорпБро┤рпБ родрпКро┤ро┐ро▓рпНроирпБроЯрпНрок роЕроЯрпБроХрпНроХро┐ро▓рпН роТро░рпЗ роиро┐ро▓рпИропро╛рой роЕроЩрпНроХрпАроХро╛ро░ роорпБро▒рпИроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНрод роЕройрпБроородро┐роХрпНроХро┐ро▒родрпБ.

MSAL рокро▒рпНро▒ро┐ роорпЗро▓рпБроорпН роЕро▒ро┐роп, роЕродро┐роХро╛ро░рокрпНрокрпВро░рпНро╡ [MSAL роХрогрпНрогрпЛроЯрпНроЯ роЖро╡рогродрпНродрпИ](https://learn.microsoft.com/entra/identity-platform/msal-overview) рокро╛ро░рпНроХрпНроХро▓ро╛роорпН.

---

## роЙроЩрпНроХро│рпН MCP роЪрпЗро╡рпИропроХродрпНродрпИ Entra ID роорпВро▓роорпН рокро╛родрпБроХро╛роХрпНроХрпБродро▓рпН: рокроЯро┐рокрпНрокроЯро┐ропро╛роХ ро╡ро┤ро┐роХро╛роЯрпНроЯрпБродро▓рпН

роЗрокрпНрокрпЛродрпБ, Entra ID роРрокрпН рокропройрпНрокроЯрпБродрпНродро┐ роЙро│рпНро│рпВро░рпН MCP роЪрпЗро╡рпИропроХродрпНродрпИ (`stdio` роорпВро▓роорпН родрпКроЯро░рпНрокрпБ роХрпКро│рпНро│рпБроорпН) роОрокрпНрокроЯро┐ рокро╛родрпБроХро╛роХрпНроХро▓ро╛роорпН роОройрпНрокродрпИрокрпН рокро╛ро░рпНрокрпНрокрпЛроорпН. роЗроирпНрод роОроЯрпБродрпНродрпБроХрпНроХро╛роЯрпНроЯро┐ро▓рпН **рокрпКродрпБ роХро┐ро│рпИропройрпНроЯрпН** рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯрпБроХро┐ро▒родрпБ, роЗродрпБ рокропройро░ро┐ройрпН роХрогро┐ройро┐ропро┐ро▓рпН роЗропроЩрпНроХрпБроорпН рокропройрпНрокро╛роЯрпБроХро│рпБроХрпНроХрпБ, роЯрпЖро╕рпНроХрпНроЯро╛рокрпН рокропройрпНрокро╛роЯрпБ роЕро▓рпНро▓родрпБ роЙро│рпНро│рпВро░рпН роорпЗроорпНрокро╛роЯрпНроЯрпБ роЪрпЗро╡рпИропроХроорпН рокрпЛройрпНро▒ро╡ро▒рпНро▒рпБроХрпНроХрпБ рокрпКро░рпБродрпНродрооро╛ройродрпБ.

### роЪрпВро┤ро▓рпН 1: роЙро│рпНро│рпВро░рпН MCP роЪрпЗро╡рпИропроХродрпНродрпИ рокро╛родрпБроХро╛роХрпНроХрпБродро▓рпН (рокрпКродрпБ роХро┐ро│рпИропройрпНроЯрпБроЯройрпН)

роЗроирпНрод роЪрпВро┤ро▓ро┐ро▓рпН, `stdio` роорпВро▓роорпН роЙро│рпНро│рпВро░рпН MCP роЪрпЗро╡рпИропроХроорпН роЗропроЩрпНроХрпБроХро┐ро▒родрпБ, рооро▒рпНро▒рпБроорпН Microsoft Graph API роЗро▓рпН роЗро░рпБроирпНродрпБ рокропройро░ро┐ройрпН роЪрпБропро╡ро┐ро╡ро░родрпН родроХро╡ро▓рпИ рокрпЖро▒рпБроорпН роТро░рпБ роХро░рпБро╡ро┐ роороЯрпНроЯрпБроорпЗ роЙро│рпНро│родрпБ.

#### 1. Entra ID роЗро▓рпН рокропройрпНрокро╛роЯрпНроЯрпИ роЕроорпИродрпНродро▓рпН

роХрпБро▒ро┐ропрпАроЯрпНроЯрпИ роОро┤рпБродрпБро╡родро▒рпНроХрпБ роорпБройрпН, Microsoft Entra ID роЗро▓рпН роЙроЩрпНроХро│рпН рокропройрпНрокро╛роЯрпНроЯрпИ рокродро┐ро╡рпБ роЪрпЖропрпНроп ро╡рпЗрогрпНроЯрпБроорпН. роЗродрпБ Entra ID роХрпНроХрпБ роЙроЩрпНроХро│рпН рокропройрпНрокро╛роЯрпНроЯрпИрокрпН рокро▒рпНро▒ро┐ родрпЖро░ро┐ро╡ро┐роХрпНроХро┐ро▒родрпБ рооро▒рпНро▒рпБроорпН роЕроЩрпНроХрпАроХро╛ро░ роЪрпЗро╡рпИропрпИрокрпН рокропройрпНрокроЯрпБродрпНрод роЕройрпБроородро┐ роЕро│ро┐роХрпНроХро┐ро▒родрпБ.

1. **[Microsoft Entra рокрпЛро░рпНроЯро▓рпН](https://entra.microsoft.com/)**роХрпНроХрпБ роЪрпЖро▓рпНро▓ро╡рпБроорпН.
2. **App registrations**роХрпНроХрпБ роЪрпЖройрпНро▒рпБ **New registration** роР роХро┐ро│ро┐роХрпН роЪрпЖропрпНропро╡рпБроорпН.
3. роЙроЩрпНроХро│рпН рокропройрпНрокро╛роЯрпНроЯро┐ро▒рпНроХрпБ роТро░рпБ рокрпЖропро░рпИ роХрпКроЯрпБроХрпНроХро╡рпБроорпН (роО.роХро╛., "My Local MCP Server").
4. **Supported account types**роХрпНроХрпБ **Accounts in this organizational directory only** роР родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН.
5. роЗроирпНрод роОроЯрпБродрпНродрпБроХрпНроХро╛роЯрпНроЯрпБроХрпНроХрпБ **Redirect URI** роР роХро╛ро▓ро┐ропро╛роХ ро╡ро┐роЯро▓ро╛роорпН.
6. **Register** роР роХро┐ро│ро┐роХрпН роЪрпЖропрпНропро╡рпБроорпН.

рокродро┐ро╡рпБ роЪрпЖропрпНропрокрпНрокроЯрпНроЯ рокро┐ро▒роХрпБ, **Application (client) ID** рооро▒рпНро▒рпБроорпН **Directory (tenant) ID** роР роХро╡ройро┐роХрпНроХро╡рпБроорпН. роЗро╡рпИ роЙроЩрпНроХро│рпН роХрпБро▒ро┐ропрпАроЯрпНроЯро┐ро▓рпН родрпЗро╡рпИрокрпНрокроЯрпБроорпН.

#### 2. роХрпБро▒ро┐ропрпАроЯрпБ: роТро░рпБ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ

роЕроЩрпНроХрпАроХро╛ро░родрпНродрпИ роХрпИропро╛ро│рпБроорпН роХрпБро▒ро┐ропрпАроЯрпНроЯро┐ройрпН роорпБроХрпНроХро┐роп рокроХрпБродро┐роХро│рпИрокрпН рокро╛ро░рпНрокрпНрокрпЛроорпН. роЗроирпНрод роОроЯрпБродрпНродрпБроХрпНроХро╛роЯрпНроЯро┐ройрпН роорпБро┤рпБ роХрпБро▒ро┐ропрпАроЯрпБ [Entra ID - Local - WAM](https://github.com/Azure-Samples/mcp-auth-servers/tree/main/src/entra-id-local-wam) роХрпЛрокрпНрокроХродрпНродро┐ро▓рпН [mcp-auth-servers GitHub repository](https://github.com/Azure-Samples/mcp-auth-servers) роЗро▓рпН роХро┐роЯрпИроХрпНроХро┐ро▒родрпБ.

**`AuthenticationService.cs`**

роЗроирпНрод ро╡роХрпБрокрпНрокрпБ Entra ID роЙроЯройрпН родрпКроЯро░рпНрокрпИ роХрпИропро╛ро│ рокрпКро▒рпБрокрпНрокро╛роХ роЙро│рпНро│родрпБ.

- **`CreateAsync`**: роЗродрпБ MSAL (Microsoft Authentication Library) роЗро▓рпН роЗро░рпБроирпНродрпБ `PublicClientApplication` роР роЖро░роорпНрокро┐роХрпНроХро┐ро▒родрпБ. роЗродрпБ роЙроЩрпНроХро│рпН рокропройрпНрокро╛роЯрпНроЯро┐ройрпН `clientId` рооро▒рпНро▒рпБроорпН `tenantId` роЙроЯройрпН роЕроорпИроХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ.
- **`WithBroker`**: роЗродрпБ роТро░рпБ broker роР (Windows Web Account Manager рокрпЛройрпНро▒) рокропройрпНрокроЯрпБродрпНрод роЕройрпБроородро┐роХрпНроХро┐ро▒родрпБ, роЗродрпБ рокро╛родрпБроХро╛рокрпНрокро╛рой рооро▒рпНро▒рпБроорпН роОро│ро┐родро╛рой single sign-on роЕройрпБрокро╡родрпНродрпИ ро╡ро┤роЩрпНроХрпБроХро┐ро▒родрпБ.
- **`AcquireTokenAsync`**: роЗродрпБ роорпБроХрпНроХро┐ропрооро╛рой роорпБро▒рпИ. роЗродрпБ роорпБродро▓ро┐ро▓рпН роТро░рпБ роЯрпЛроХрпНроХройрпИ роЕроорпИродро┐ропро╛роХ рокрпЖро▒ роорпБропро▒рпНроЪро┐роХрпНроХро┐ро▒родрпБ (рокропройро░рпБроХрпНроХрпБ роПро▒рпНроХройро╡рпЗ роЪрпЖро▓рпНро▓рпБрокроЯро┐ропро╛роХрпБроорпН роЕрооро░рпНро╡рпБ роЗро░рпБроирпНродро╛ро▓рпН роорпАрогрпНроЯрпБроорпН роЙро│рпНроирпБро┤рпИроп ро╡рпЗрогрпНроЯро┐роп роЕро╡роЪро┐ропрооро┐ро▓рпНро▓рпИ). роЕроорпИродро┐ропро╛рой роЯрпЛроХрпНроХройрпИрокрпН рокрпЖро▒ роорпБроЯро┐ропро╛ро╡ро┐роЯрпНроЯро╛ро▓рпН, рокропройро░рпИ роЗроЯрпИроорпБроХрооро╛роХ роЙро│рпНроирпБро┤рпИропрпБрооро╛ро▒рпБ роХрпЗроЯрпНроХрпБроорпН.

```csharp
// Simplified for clarity
public static async Task<AuthenticationService> CreateAsync(ILogger<AuthenticationService> logger)
{
    var msalClient = PublicClientApplicationBuilder
        .Create(_clientId) // Your Application (client) ID
        .WithAuthority(AadAuthorityAudience.AzureAdMyOrg)
        .WithTenantId(_tenantId) // Your Directory (tenant) ID
        .WithBroker(new BrokerOptions(BrokerOptions.OperatingSystems.Windows))
        .Build();

    // ... cache registration ...

    return new AuthenticationService(logger, msalClient);
}

public async Task<string> AcquireTokenAsync()
{
    try
    {
        // Try silent authentication first
        var accounts = await _msalClient.GetAccountsAsync();
        var account = accounts.FirstOrDefault();

        AuthenticationResult? result = null;

        if (account != null)
        {
            result = await _msalClient.AcquireTokenSilent(_scopes, account).ExecuteAsync();
        }
        else
        {
            // If no account, or silent fails, go interactive
            result = await _msalClient.AcquireTokenInteractive(_scopes).ExecuteAsync();
        }

        return result.AccessToken;
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "An error occurred while acquiring the token.");
        throw; // Optionally rethrow the exception for higher-level handling
    }
}
```

**`Program.cs`**

роЗродрпБ MCP роЪрпЗро╡рпИропроХродрпНродрпИ роЕроорпИроХрпНроХро┐ро▒родрпБ рооро▒рпНро▒рпБроорпН роЕроЩрпНроХрпАроХро╛ро░ роЪрпЗро╡рпИропрпИ роТро░рпБроЩрпНроХро┐рогрпИроХрпНроХро┐ро▒родрпБ.

- **`AddSingleton<AuthenticationService>`**: роЗродрпБ `AuthenticationService` роР dependency injection container роЙроЯройрпН рокродро┐ро╡рпБ роЪрпЖропрпНроХро┐ро▒родрпБ, роЗродрпБ рокропройрпНрокро╛роЯрпНроЯро┐ройрпН рокро┐ро▒ рокроХрпБродро┐роХро│ро╛ро▓рпН (роО.роХро╛., роОроЩрпНроХро│рпН роХро░рпБро╡ро┐) рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯро▓ро╛роорпН.
- **`GetUserDetailsFromGraph` tool**: роЗроирпНрод роХро░рпБро╡ро┐ `AuthenticationService` роЗройрпН роТро░рпБ роЙродро╛ро░рогродрпНродрпИ родрпЗро╡рпИрокрпНрокроЯрпБроХро┐ро▒родрпБ. роЗродрпБ роОродрпИропрпБроорпН роЪрпЖропрпНропрпБроорпН роорпБройрпН, `authService.AcquireTokenAsync()` роР роЕро┤рпИроХрпНроХро┐ро▒родрпБ роЪрпЖро▓рпНро▓рпБрокроЯро┐ропро╛роХрпБроорпН роЕрогрпБроХро▓рпН роЯрпЛроХрпНроХройрпИрокрпН рокрпЖро▒. роЕроЩрпНроХрпАроХро╛ро░роорпН ро╡рпЖро▒рпНро▒ро┐роХро░рооро╛роХ роЗро░рпБроирпНродро╛ро▓рпН, Microsoft Graph API роР роЕро┤рпИроХрпНроХ роЯрпЛроХрпНроХройрпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ рокропройро░ро┐ройрпН ро╡ро┐ро╡ро░роЩрпНроХро│рпИ MCP роХро┐ро│рпИропройрпНроЯрпБроХрпНроХрпБ родро┐ро░рпБрокрпНрокро┐ роЕройрпБрокрпНрокрпБроХро┐ро▒родрпБ.

```csharp
// Simplified for clarity
[McpServerTool(Name = "GetUserDetailsFromGraph")]
public static async Task<string> GetUserDetailsFromGraph(
    AuthenticationService authService)
{
    try
    {
        // This will trigger the authentication flow
        var accessToken = await authService.AcquireTokenAsync();

        // Use the token to create a GraphServiceClient
        var graphClient = new GraphServiceClient(
            new BaseBearerTokenAuthenticationProvider(new TokenProvider(authService)));

        var user = await graphClient.Me.GetAsync();

        return System.Text.Json.JsonSerializer.Serialize(user);
    }
    catch (Exception ex)
    {
        return $"Error: {ex.Message}";
    }
}
```

#### 3. роЗродрпБ роЕройрпИродрпНродрпБроорпН роТройрпНро▒ро╛роХ роОрокрпНрокроЯро┐ ро╡рпЗро▓рпИ роЪрпЖропрпНроХро┐ро▒родрпБ

1. MCP роХро┐ро│рпИропройрпНроЯрпН `GetUserDetailsFromGraph` роХро░рпБро╡ро┐ропрпИрокрпН рокропройрпНрокроЯрпБродрпНрод роорпБропро▒рпНроЪро┐роХрпНроХрпБроорпНрокрпЛродрпБ, роХро░рпБро╡ро┐ роорпБродро▓ро┐ро▓рпН `AcquireTokenAsync` роР роЕро┤рпИроХрпНроХро┐ро▒родрпБ.
2. `AcquireTokenAsync` MSAL роирпВро▓роХродрпНродрпИ роЪрпЖро▓рпНро▓рпБрокроЯро┐ропро╛роХрпБроорпН роЯрпЛроХрпНроХройрпИроЪрпН роЪро░ро┐рокро╛ро░рпНроХрпНроХродрпН родрпВрогрпНроЯрпБроХро┐ро▒родрпБ.
3. роЯрпЛроХрпНроХройрпН роХро┐роЯрпИроХрпНроХро╡ро┐ро▓рпНро▓рпИ роОройрпНро▒ро╛ро▓рпН, MSAL, broker роорпВро▓роорпН, рокропройро░рпИ Entra ID роХрогроХрпНроХрпБроЯройрпН роЙро│рпНроирпБро┤рпИропрпБрооро╛ро▒рпБ роХрпЗроЯрпНроХрпБроорпН.
4. рокропройро░рпН роЙро│рпНроирпБро┤рпИроирпНрод рокро┐ро▒роХрпБ, Entra ID роТро░рпБ роЕрогрпБроХро▓рпН роЯрпЛроХрпНроХройрпИ ро╡ро┤роЩрпНроХрпБроХро┐ро▒родрпБ.
5. роХро░рпБро╡ро┐ роЯрпЛроХрпНроХройрпИрокрпН рокрпЖро▒рпБроХро┐ро▒родрпБ рооро▒рпНро▒рпБроорпН Microsoft Graph API роР роЕро┤рпИроХрпНроХ рокро╛родрпБроХро╛рокрпНрокро╛рой роЕро┤рпИрокрпНрокрпИроЪрпН роЪрпЖропрпНроХро┐ро▒родрпБ.
6. рокропройро░ро┐ройрпН ро╡ро┐ро╡ро░роЩрпНроХро│рпН MCP роХро┐ро│рпИропройрпНроЯрпБроХрпНроХрпБ родро┐ро░рпБрокрпНрокро┐ роЕройрпБрокрпНрокрокрпНрокроЯрпБроХро┐ро▒родрпБ.

роЗроирпНрод роЪрпЖропро▓рпНроорпБро▒рпИ, роЕроЩрпНроХрпАроХро╛ро░роорпН роЪрпЖропрпНропрокрпНрокроЯрпНроЯ рокропройро░рпНроХро│рпН роороЯрпНроЯрпБроорпЗ роХро░рпБро╡ро┐ропрпИрокрпН рокропройрпНрокроЯрпБродрпНрод роорпБроЯро┐ропрпБроорпН роОройрпНрокродрпИ роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНродрпБроХро┐ро▒родрпБ, роЙроЩрпНроХро│рпН роЙро│рпНро│рпВро░рпН MCP роЪрпЗро╡рпИропроХродрпНродрпИ родро┐ро▒роорпНрокроЯ рокро╛родрпБроХро╛роХрпНроХро┐ро▒родрпБ.

### роЪрпВро┤ро▓рпН 2: родрпКро▓рпИродрпВро░ MCP роЪрпЗро╡рпИропроХродрпНродрпИ рокро╛родрпБроХро╛роХрпНроХрпБродро▓рпН (ро░роХроЪро┐роп роХро┐ро│рпИропройрпНроЯрпБроЯройрпН)

роЙроЩрпНроХро│рпН MCP роЪрпЗро╡рпИропроХроорпН роТро░рпБ родрпКро▓рпИродрпВро░ роЗропроирпНродро┐ро░родрпНродро┐ро▓рпН (роорпЗроХ роЪрпЗро╡рпИропроХроорпН рокрпЛройрпНро▒) роЗропроЩрпНроХрпБроорпНрокрпЛродрпБ рооро▒рпНро▒рпБроорпН HTTP Streaming рокрпЛройрпНро▒ роирпЖро▒ро┐роорпБро▒рпИропро┐ройрпН роорпВро▓роорпН родрпКроЯро░рпНрокрпБ роХрпКро│рпНро│рпБроорпНрокрпЛродрпБ, рокро╛родрпБроХро╛рокрпНрокрпБ родрпЗро╡рпИроХро│рпН ро╡рпЗро▒рпБрокроЯрпБроХро┐ройрпНро▒рой. роЗроирпНрод роЪрпВро┤ро▓ро┐ро▓рпН, **ро░роХроЪро┐роп роХро┐ро│рпИропройрпНроЯрпН** рооро▒рпНро▒рпБроорпН **Authorization Code Flow** роР рокропройрпНрокроЯрпБродрпНрод ро╡рпЗрогрпНроЯрпБроорпН. роЗродрпБ роТро░рпБ рокро╛родрпБроХро╛рокрпНрокро╛рой роорпБро▒рпИ, роПройрпЖройро┐ро▓рпН рокропройрпНрокро╛роЯрпНроЯро┐ройрпН ро░роХроЪро┐ропроЩрпНроХро│рпН роЙро▓ро╛ро╡ро┐ропро┐ро▓рпН ро╡рпЖро│ро┐рокрпНрокроЯрпБродрпНродрокрпНрокроЯрпБро╡родро┐ро▓рпНро▓рпИ.

роЗроирпНрод роОроЯрпБродрпНродрпБроХрпНроХро╛роЯрпНроЯро┐ро▓рпН TypeScript роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓ро╛рой MCP роЪрпЗро╡рпИропроХроорпН рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯрпБроХро┐ро▒родрпБ, роЗродрпБ HTTP роХрпЛро░ро┐роХрпНроХрпИроХро│рпИ роХрпИропро╛ро│ Express.js роР рокропройрпНрокроЯрпБродрпНродрпБроХро┐ро▒родрпБ.

#### 1. Entra ID роЗро▓рпН рокропройрпНрокро╛роЯрпНроЯрпИ роЕроорпИродрпНродро▓рпН

рокрпКродрпБ роХро┐ро│рпИропройрпНроЯро┐ро▓рпН роЙро│рпНро│ роЕроорпИрокрпНрокрпБ рокрпЛройрпНро▒родрпБ, роЖройро╛ро▓рпН роТро░рпБ роорпБроХрпНроХро┐роп ро╡рпЗро▒рпБрокро╛роЯрпБ роЙро│рпНро│родрпБ: роирпАроЩрпНроХро│рпН роТро░рпБ **client secret** роЙро░рпБро╡ро╛роХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.

1. **[Microsoft Entra рокрпЛро░рпНроЯро▓рпН](https://entra.microsoft.com/)**роХрпНроХрпБ роЪрпЖро▓рпНро▓ро╡рпБроорпН.
2. роЙроЩрпНроХро│рпН рокропройрпНрокро╛роЯрпНроЯрпБ рокродро┐ро╡ро┐ро▓рпН **Certificates & secrets** родро╛ро╡ро▓рпБроХрпНроХрпБ роЪрпЖро▓рпНро▓ро╡рпБроорпН.
3. **New client secret** роР роХро┐ро│ро┐роХрпН роЪрпЖропрпНродрпБ, роТро░рпБ ро╡ро┐ро│роХрпНроХродрпНродрпИ роХрпКроЯрпБродрпНродрпБ **Add** роР роХро┐ро│ро┐роХрпН роЪрпЖропрпНропро╡рпБроорпН.
4. **роорпБроХрпНроХро┐ропроорпН:** ро░роХроЪро┐роп роородро┐рокрпНрокрпИ роЙроЯройроЯро┐ропро╛роХ роироХро▓рпЖроЯрпБроХрпНроХро╡рпБроорпН. роЕродрпИ роорпАрогрпНроЯрпБроорпН рокро╛ро░рпНроХрпНроХ роорпБроЯро┐ропро╛родрпБ.
5. роирпАроЩрпНроХро│рпН роТро░рпБ **Redirect URI** роР роЕроорпИроХрпНроХро╡рпБроорпН ро╡рпЗрогрпНроЯрпБроорпН. **Authentication** родро╛ро╡ро▓рпБроХрпНроХрпБ роЪрпЖро▓рпНро▓ро╡рпБроорпН, **Add a platform** роР роХро┐ро│ро┐роХрпН роЪрпЖропрпНропро╡рпБроорпН, **Web** роР родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН, рооро▒рпНро▒рпБроорпН роЙроЩрпНроХро│рпН рокропройрпНрокро╛роЯрпНроЯро┐ро▒рпНроХро╛рой redirect URI роР роЙро│рпНро│ро┐роЯро╡рпБроорпН (роО.роХро╛., `http://localhost:3001/auth/callback`).

> **тЪая╕П роорпБроХрпНроХро┐роп рокро╛родрпБроХро╛рокрпНрокрпБ роХрпБро▒ро┐рокрпНрокрпБроХро│рпН:** роЙро▒рпНрокродрпНродро┐ рокропройрпНрокро╛роЯрпБроХро│рпБроХрпНроХрпБ, Microsoft **Managed Identity** роЕро▓рпНро▓родрпБ **Workload Identity Federation** рокрпЛройрпНро▒ **secretless authentication** роорпБро▒рпИроХро│рпИ client secrets роР ро╡ро┐роЯ рооро┐роХро╡рпБроорпН рокро░ро┐роирпНродрпБро░рпИроХрпНроХро┐ро▒родрпБ. Client secrets рокро╛родрпБроХро╛рокрпНрокрпБ роЕрокро╛ропроЩрпНроХро│рпИ роПро▒рпНрокроЯрпБродрпНродрпБроорпН, роПройрпЖройро┐ро▓рпН роЕро╡рпИ ро╡рпЖро│ро┐рокрпНрокроЯрпБродрпНродрокрпНрокроЯро╡рпЛ роЕро▓рпНро▓родрпБ роЖрокродрпНродрпБроХрпНроХрпБро│рпНро│ро╛роХро╡рпЛ роЗро░рпБроХрпНроХро▓ро╛роорпН. Managed identities роЙроЩрпНроХро│рпН роХрпБро▒ро┐ропрпАроЯрпБ роЕро▓рпНро▓родрпБ роХроЯрпНроЯроорпИрокрпНрокро┐ро▓рпН роЪро╛ройрпНро▒рпБроХро│рпИ роЪрпЗрооро┐роХрпНроХ родрпЗро╡рпИропро┐ро▓рпНро▓ро╛рооро▓рпН рокро╛родрпБроХро╛рокрпНрокро╛рой роЕрогрпБроХро▓рпИ ро╡ро┤роЩрпНроХрпБроХро┐ро▒родрпБ.
>
> Managed identities рооро▒рпНро▒рпБроорпН роЕро╡ро▒рпНро▒рпИ роОрокрпНрокроЯро┐ роЪрпЖропро▓рпНрокроЯрпБродрпНродрпБро╡родрпБ рокро▒рпНро▒ро┐ роорпЗро▓рпБроорпН родроХро╡ро▓рпБроХрпНроХрпБ, [Managed identities for Azure resources overview](https://learn.microsoft.com/entra/identity/managed-identities-azure-resources/overview) роР рокро╛ро░рпНроХрпНроХро╡рпБроорпН.

#### 2. роХрпБро▒ро┐ропрпАроЯрпБ: роТро░рпБ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ

роЗроирпНрод роОроЯрпБродрпНродрпБроХрпНроХро╛роЯрпНроЯро┐ро▓рпН роЕрооро░рпНро╡рпБ роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓ро╛рой роЕрогрпБроХрпБроорпБро▒рпИ рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯрпБроХро┐ро▒родрпБ. рокропройро░рпН роЕроЩрпНроХрпАроХро░ро┐роХрпНроХрпБроорпНрокрпЛродрпБ, роЪрпЗро╡рпИропроХроорпН роЕрогрпБроХро▓рпН роЯрпЛроХрпНроХройрпН рооро▒рпНро▒рпБроорпН refresh token роР роТро░рпБ session роЗро▓рпН роЪрпЗрооро┐роХрпНроХро┐ро▒родрпБ рооро▒рпНро▒рпБроорпН рокропройро░рпБроХрпНроХрпБ session token роР ро╡ро┤роЩрпНроХрпБроХро┐ро▒родрпБ. роЗроирпНрод session token рокро┐ройрпНройро░рпН родрпКроЯро░рпНроирпНродрпБ роХрпЛро░ро┐роХрпНроХрпИроХро│рпБроХрпНроХрпБ рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯрпБроХро┐ро▒родрпБ. роЗроирпНрод роОроЯрпБродрпНродрпБроХрпНроХро╛роЯрпНроЯро┐ройрпН роорпБро┤рпБ роХрпБро▒ро┐ропрпАроЯрпБ [Entra ID - Confidential client](https://github.com/Azure-Samples/mcp-auth-servers/tree/main/src/entra-id-cca-session) роХрпЛрокрпНрокроХродрпНродро┐ро▓рпН [mcp-auth-servers GitHub repository](https://github.com/Azure-Samples/mcp-auth-servers) роЗро▓рпН роХро┐роЯрпИроХрпНроХро┐ро▒родрпБ.

**`Server.ts`**

роЗроирпНрод роХрпЛрокрпНрокрпБ Express роЪрпЗро╡рпИропроХродрпНродрпИ рооро▒рпНро▒рпБроорпН MCP рокрпЛроХрпНроХрпБро╡ро░родрпНродрпБ роЕроЯрпБроХрпНроХрпБ роЕроорпИроХрпНроХро┐ро▒родрпБ.

- **`requireBearerAuth`**: роЗродрпБ `/sse` рооро▒рпНро▒рпБроорпН `/message` роорпБроЯрпБроХрпНроХроЩрпНроХро│рпИ рокро╛родрпБроХро╛роХрпНроХрпБроорпН middleware роЖроХрпБроорпН. роЗродрпБ роХрпЛро░ро┐роХрпНроХрпИропро┐ройрпН `Authorization` родро▓рпИрокрпНрокро┐ро▓рпН роЪрпЖро▓рпНро▓рпБрокроЯро┐ропро╛роХрпБроорпН bearer token роР роЪро░ро┐рокро╛ро░рпНроХрпНроХро┐ро▒родрпБ.
- **`EntraIdServerAuthProvider`**: роЗродрпБ `McpServerAuthorizationProvider` роЗроЯрпИроорпБроХродрпНродрпИ роЪрпЖропро▓рпНрокроЯрпБродрпНродрпБроорпН родройро┐рокрпНрокропройрпН ро╡роХрпБрокрпНрокрпБ. роЗродрпБ OAuth 2.0 роУроЯрпНроЯродрпНродрпИ роХрпИропро╛ро│ рокрпКро▒рпБрокрпНрокро╛роХ роЙро│рпНро│родрпБ.
- **`/auth/callback`**: роЗроирпНрод роорпБроЯрпБроХрпНроХроорпН рокропройро░рпН роЕроЩрпНроХрпАроХро░ро┐родрпНрод рокро┐ро▒роХрпБ Entra ID роЗро▓рпН роЗро░рпБроирпНродрпБ redirect роР роХрпИропро╛ро│рпБроХро┐ро▒родрпБ. роЗродрпБ authorization code роР access token рооро▒рпНро▒рпБроорпН refresh token роХрпНроХрпБ рооро╛ро▒рпНро▒рпБроХро┐ро▒родрпБ.

```typescript
// Simplified for clarity
const app = express();
const { server } = createServer();
const provider = new EntraIdServerAuthProvider();

// Protect the SSE endpoint
app.get("/sse", requireBearerAuth({
  provider,
  requiredScopes: ["User.Read"]
}), async (req, res) => {
  // ... connect to the transport ...
});

// Protect the message endpoint
app.post("/message", requireBearerAuth({
  provider,
  requiredScopes: ["User.Read"]
}), async (req, res) => {
  // ... handle the message ...
});

// Handle the OAuth 2.0 callback
app.get("/auth/callback", (req, res) => {
  provider.handleCallback(req.query.code, req.query.state)
    .then(result => {
      // ... handle success or failure ...
    });
});
```

**`Tools.ts`**

роЗроирпНрод роХрпЛрокрпНрокрпБ MCP роЪрпЗро╡рпИропроХроорпН ро╡ро┤роЩрпНроХрпБроорпН роХро░рпБро╡ро┐роХро│рпИ ро╡ро░рпИропро▒рпБроХрпНроХро┐ро▒родрпБ.
2. рокропройро░рпН родроЩрпНроХро│рпН Entra ID роХрогроХрпНроХрпБроЯройрпН роЙро│рпНроирпБро┤рпИроХро┐ро▒ро╛ро░рпН.  
3. Entra ID рокропройро░рпИ `/auth/callback` роорпБроЯрпБроХрпНроХродрпНродро┐ро▓рпН роЕройрпБроородро┐ роХрпБро▒ро┐ропрпАроЯрпБ (authorization code) роЙроЯройрпН родро┐ро░рпБрокрпНрокро┐ роЕройрпБрокрпНрокрпБроХро┐ро▒родрпБ.  
4. роЪро░рпНро╡ро░рпН роХрпБро▒ро┐ропрпАроЯрпНроЯрпИ роЕрогрпБроХро▓рпН роЯрпЛроХрпНроХройрпН рооро▒рпНро▒рпБроорпН рокрпБродрпБрокрпНрокро┐рокрпНрокрпБ роЯрпЛроХрпНроХройро╛роХ рооро╛ро▒рпНро▒ро┐, роЕро╡ро▒рпНро▒рпИ роЪрпЗрооро┐родрпНродрпБ, роТро░рпБ роЕрооро░рпНро╡рпБ роЯрпЛроХрпНроХройрпИ роЙро░рпБро╡ро╛роХрпНроХро┐, роЕродрпИ роХро┐ро│рпИропрогрпНроЯрпБроХрпНроХрпБ роЕройрпБрокрпНрокрпБроХро┐ро▒родрпБ.  
5. роХро┐ро│рпИропрогрпНроЯрпН роЗрокрпНрокрпЛродрпБ роЗроирпНрод роЕрооро░рпНро╡рпБ роЯрпЛроХрпНроХройрпИ `Authorization` родро▓рпИрокрпНрокро┐ро▓рпН MCP роЪро░рпНро╡ро░рпБроХрпНроХрпБ роОродро┐ро░рпНроХро╛ро▓ роХрпЛро░ро┐роХрпНроХрпИроХро│рпБроХрпНроХрпБ рокропройрпНрокроЯрпБродрпНродро▓ро╛роорпН.  
6. `getUserDetails` роХро░рпБро╡ро┐ роЕро┤рпИроХрпНроХрокрпНрокроЯрпБроорпН рокрпЛродрпБ, роЕродрпБ роЕрооро░рпНро╡рпБ роЯрпЛроХрпНроХройрпИ рокропройрпНрокроЯрпБродрпНродро┐ Entra ID роЕрогрпБроХро▓рпН роЯрпЛроХрпНроХройрпИ родрпЗроЯро┐, Microsoft Graph API-ропрпИ роЕро┤рпИроХрпНроХро┐ро▒родрпБ.  

роЗроирпНрод роЪрпЖропро▓рпНроорпБро▒рпИ рокрпКродрпБро╡ро╛рой роХро┐ро│рпИропрогрпНроЯрпН роЪрпЖропро▓рпНроорпБро▒рпИропрпИ ро╡ро┐роЯ роЪро┐роХрпНроХро▓ро╛ройродрпБ, роЖройро╛ро▓рпН роЗрогрпИропродрпНродрпБроЯройрпН родрпКроЯро░рпНрокрпБроЯрпИроп роорпБроЯрпБроХрпНроХроЩрпНроХро│рпБроХрпНроХрпБ роЕро╡роЪро┐ропрооро╛ройродрпБ. родрпКро▓рпИ MCP роЪро░рпНро╡ро░рпНроХро│рпН рокрпКродрпБро╡ро╛рой роЗрогрпИропродрпНродро┐ро▓рпН роЕрогрпБроХроХрпНроХрпВроЯро┐ропро╡рпИ роОройрпНрокродро╛ро▓рпН, роЕройрпБроородро┐ропро┐ро▓рпНро▓ро╛род роЕрогрпБроХро▓рпН рооро▒рпНро▒рпБроорпН роЪро╛родрпНродро┐ропрооро╛рой родро╛роХрпНроХрпБродро▓рпНроХро│рпИродрпН родроЯрпБроХрпНроХ ро╡ро▓рпБро╡ро╛рой рокро╛родрпБроХро╛рокрпНрокрпБ роироЯро╡роЯро┐роХрпНроХрпИроХро│рпН родрпЗро╡рпИрокрпНрокроЯрпБроХро┐ро▒родрпБ.  

## рокро╛родрпБроХро╛рокрпНрокрпБ роЪро┐ро▒роирпНрод роироЯрпИроорпБро▒рпИроХро│рпН  

- **роОрокрпНрокрпЛродрпБроорпН HTTPS рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН**: роХро┐ро│рпИропрогрпНроЯрпН рооро▒рпНро▒рпБроорпН роЪро░рпНро╡ро░рпБроХрпНроХрпБ роЗроЯрпИропро┐ро▓ро╛рой родрпКроЯро░рпНрокрпИ роХрпБро▒ро┐ропро╛роХрпНроХроорпН роЪрпЖропрпНродрпБ, роЯрпЛроХрпНроХройрпНроХро│рпН роороЯроХрпНроХрокрпНрокроЯрпБро╡родрпИродрпН родроЯрпБроХрпНроХро╡рпБроорпН.  
- **рокро╛родрпНродро┐ро░ роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓ро╛рой роЕрогрпБроХро▓рпН роХроЯрпНроЯрпБрокрпНрокро╛роЯрпБ (RBAC) роЪрпЖропро▓рпНрокроЯрпБродрпНродро╡рпБроорпН**: рокропройро░рпН роЕроЩрпНроХрпАроХро░ро┐роХрпНроХрокрпНрокроЯрпНроЯро╡ро░ро╛ роОройрпНрокродрпИ роороЯрпНроЯрпБроорпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро╛рооро▓рпН, роЕро╡ро░рпНроХро│рпН роОройрпНрой роЪрпЖропрпНроп роЕройрпБроородро┐роХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│ройро░рпН роОройрпНрокродрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН. Entra ID-ро▓рпН рокро╛родрпНродро┐ро░роЩрпНроХро│рпИ ро╡ро░рпИропро▒рпБродрпНродрпБ, MCP роЪро░рпНро╡ро░ро┐ро▓рпН роЕро╡ро▒рпНро▒рпИроЪрпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро▓ро╛роорпН.  
- **роХрогрпНроХро╛рогро┐родрпНродрпБ, роЖропрпНро╡рпБ роЪрпЖропрпНропро╡рпБроорпН**: роЕройрпИродрпНродрпБ роЕроЩрпНроХрпАроХро╛ро░ роиро┐роХро┤рпНро╡рпБроХро│рпИропрпБроорпН рокродро┐ро╡рпБ роЪрпЖропрпНродрпБ, роЪроирпНродрпЗроХродрпНродро┐ро▒рпНроХро┐роЯрооро╛рой роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпИ роХрогрпНроЯро▒ро┐роирпНродрпБ рокродро┐ро▓ро│ро┐роХрпНроХро╡рпБроорпН.  
- **ро╡ро┐роХро┐род ро╡ро░роорпНрокрпБ рооро▒рпНро▒рпБроорпН родроЯрпИроЪрпЖропрпНродро▓рпН роХрпИропро╛ро│ро╡рпБроорпН**: Microsoft Graph рооро▒рпНро▒рпБроорпН рокро┐ро▒ API-роХрпНроХро│рпН родро╡ро▒ро╛роХ рокропройрпНрокроЯрпБродрпНродрпБро╡родрпИродрпН родроЯрпБроХрпНроХ ро╡ро┐роХро┐род ро╡ро░роорпНрокрпБроХро│рпИ роЪрпЖропро▓рпНрокроЯрпБродрпНродрпБроХро┐ройрпНро▒рой. MCP роЪро░рпНро╡ро░ро┐ро▓рпН HTTP 429 (рооро┐роХро╡рпБроорпН роЕродро┐роХрооро╛рой роХрпЛро░ро┐роХрпНроХрпИроХро│рпН) рокродро┐ро▓рпНроХро│рпИ роиройрпНроХрпБ роХрпИропро╛ро│, рокро░роирпНрод рокро┐ройрпНройроЯрпИро╡рпБроХро│рпН рооро▒рпНро▒рпБроорпН роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐ роЪрпЖропрпНропрпБроорпН родро╛ро░рпНроорпАроХродрпНродрпИ роЪрпЖропро▓рпНрокроЯрпБродрпНродро╡рпБроорпН. API роЕро┤рпИрокрпНрокрпБроХро│рпИ роХрпБро▒рпИроХрпНроХ, роЕроЯро┐роХрпНроХроЯро┐ роЕрогрпБроХрокрпНрокроЯрпБроорпН родро░ро╡рпБроХро│рпИ роХро╛роЯрпНроЪро┐ропро┐роЯро╡рпБроорпН.  
- **роЯрпЛроХрпНроХройрпН роЪрпЗрооро┐рокрпНрокрпИ рокро╛родрпБроХро╛роХрпНроХро╡рпБроорпН**: роЕрогрпБроХро▓рпН роЯрпЛроХрпНроХройрпНроХро│рпН рооро▒рпНро▒рпБроорпН рокрпБродрпБрокрпНрокро┐рокрпНрокрпБ роЯрпЛроХрпНроХройрпНроХро│рпИ рокро╛родрпБроХро╛рокрпНрокро╛роХ роЪрпЗрооро┐роХрпНроХро╡рпБроорпН. роЙро│рпНро│рпВро░рпН рокропройрпНрокро╛роЯрпБроХро│рпБроХрпНроХрпБ, роЕроорпИрокрпНрокро┐ройрпН рокро╛родрпБроХро╛рокрпНрокро╛рой роЪрпЗрооро┐рокрпНрокрпБ роорпБро▒рпИроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН. роЪро░рпНро╡ро░рпН рокропройрпНрокро╛роЯрпБроХро│рпБроХрпНроХрпБ, роХрпБро▒ро┐ропро╛роХрпНроХрокрпНрокроЯрпНроЯ роЪрпЗрооро┐рокрпНрокрпБ роЕро▓рпНро▓родрпБ Azure Key Vault рокрпЛройрпНро▒ рокро╛родрпБроХро╛рокрпНрокро╛рой роорпБроХрпНроХро┐роп роорпЗро▓ро╛рогрпНроорпИ роЪрпЗро╡рпИроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН.  
- **роЯрпЛроХрпНроХройрпН роХро╛ро▓ро╛ро╡родро┐ропро╛ройродрпИ роХрпИропро╛ро│ро╡рпБроорпН**: роЕрогрпБроХро▓рпН роЯрпЛроХрпНроХройрпНроХро│рпБроХрпНроХрпБ ро╡ро░рпИропро▒рпБроХрпНроХрокрпНрокроЯрпНроЯ роЖропрпБро│рпН роЙро│рпНро│родрпБ. роорпАрогрпНроЯрпБроорпН роЕроЩрпНроХрпАроХро╛ро░роорпН роЪрпЖропрпНропро╛рооро▓рпН, рокропройро░рпН роЕройрпБрокро╡родрпНродрпИродрпН родрпКроЯро░, рокрпБродрпБрокрпНрокро┐рокрпНрокрпБ роЯрпЛроХрпНроХройрпНроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ родро╛ройро┐ропроЩрпНроХро┐ роЯрпЛроХрпНроХройрпН рокрпБродрпБрокрпНрокро┐рокрпНрокрпИ роЪрпЖропро▓рпНрокроЯрпБродрпНродро╡рпБроорпН.  
- **Azure API Management рокропройрпНрокроЯрпБродрпНродрпБро╡родрпБ рокро▒рпНро▒ро┐ ропрпЛроЪро┐роХрпНроХро╡рпБроорпН**: MCP роЪро░рпНро╡ро░ро┐ро▓рпН роирпЗро░роЯро┐ропро╛роХ рокро╛родрпБроХро╛рокрпНрокрпИ роЪрпЖропро▓рпНрокроЯрпБродрпНродрпБро╡родрпБ роирпБрогрпБроХрпНроХрооро╛рой роХроЯрпНроЯрпБрокрпНрокро╛роЯрпНроЯрпИ ро╡ро┤роЩрпНроХро┐ройро╛ро▓рпБроорпН, Azure API Management рокрпЛройрпНро▒ API Gateway-роХрпНроХро│рпН роЕроЩрпНроХрпАроХро╛ро░роорпН, роЕройрпБроородро┐, ро╡ро┐роХро┐род ро╡ро░роорпНрокрпБ рооро▒рпНро▒рпБроорпН роХрогрпНроХро╛рогро┐рокрпНрокрпБ рокрпЛройрпНро▒ рокро▓ рокро╛родрпБроХро╛рокрпНрокрпБ роХро╡ро▓рпИроХро│рпИ родро╛ройро╛роХ роХрпИропро╛ро│ роорпБроЯро┐ропрпБроорпН. роЗро╡рпИ роЙроЩрпНроХро│рпН роХро┐ро│рпИропрогрпНроЯрпНроХро│рпН рооро▒рпНро▒рпБроорпН MCP роЪро░рпНро╡ро░рпНроХро│рпБроХрпНроХрпБ роЗроЯрпИропрпЗ роорпИропрокрпНрокроЯрпБродрпНродрокрпНрокроЯрпНроЯ рокро╛родрпБроХро╛рокрпНрокрпБ роЕроЯрпБроХрпНроХрпБ ро╡ро┤роЩрпНроХрпБроХро┐ройрпНро▒рой. MCP-роХрпНроХрпБ API Gateway-роХрпНроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБро╡родрпБ рокро▒рпНро▒ро┐роп роорпЗро▓рпБроорпН ро╡ро┐ро╡ро░роЩрпНроХро│рпБроХрпНроХрпБ, [Azure API Management Your Auth Gateway For MCP Servers](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690) рокро╛ро░рпНроХрпНроХро╡рпБроорпН.  

## роорпБроХрпНроХро┐роп роХрпБро▒ро┐рокрпНрокрпБроХро│рпН  

- роЙроЩрпНроХро│рпН MCP роЪро░рпНро╡ро░рпИ рокро╛родрпБроХро╛рокрпНрокро╛роХ ро╡рпИродрпНродро┐ро░рпБрокрпНрокродрпБ роЙроЩрпНроХро│рпН родро░ро╡рпБроХро│рпН рооро▒рпНро▒рпБроорпН роХро░рпБро╡ро┐роХро│рпИрокрпН рокро╛родрпБроХро╛роХрпНроХ роорпБроХрпНроХро┐ропрооро╛ройродрпБ.  
- Microsoft Entra ID роЕроЩрпНроХрпАроХро╛ро░роорпН рооро▒рпНро▒рпБроорпН роЕройрпБроородро┐роХрпНроХро╛рой ро╡ро▓рпБро╡ро╛рой рооро▒рпНро▒рпБроорпН роЕро│ро╡ро│ро╛ро╡ро┐роп родрпАро░рпНро╡рпИ ро╡ро┤роЩрпНроХрпБроХро┐ро▒родрпБ.  
- роЙро│рпНро│рпВро░рпН рокропройрпНрокро╛роЯрпБроХро│рпБроХрпНроХрпБ **рокрпКродрпБ роХро┐ро│рпИропрогрпНроЯрпН** рооро▒рпНро▒рпБроорпН родрпКро▓рпИ роЪро░рпНро╡ро░рпНроХро│рпБроХрпНроХрпБ **роХроЯро╡рпБроЪрпНроЪрпКро▒рпНроХро│рпБроЯройрпН роХрпВроЯро┐роп роХро┐ро│рпИропрогрпНроЯрпН** рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН.  
- **Authorization Code Flow** роОройрпНрокродрпБ ро╡ро▓рпИ рокропройрпНрокро╛роЯрпБроХро│рпБроХрпНроХрпБ рооро┐роХро╡рпБроорпН рокро╛родрпБроХро╛рокрпНрокро╛рой ро╡ро┐ро░рпБрокрпНрокроорпН.  

## рокропро┐ро▒рпНроЪро┐  

1. роирпАроЩрпНроХро│рпН роЙро░рпБро╡ро╛роХрпНроХроХрпНроХрпВроЯро┐роп MCP роЪро░рпНро╡ро░рпИ рокро▒рпНро▒ро┐ ропрпЛроЪро┐роХрпНроХро╡рпБроорпН. роЕродрпБ роЙро│рпНро│рпВро░рпН роЪро░рпНро╡ро░ро╛ роЕро▓рпНро▓родрпБ родрпКро▓рпИ роЪро░рпНро╡ро░ро╛?  
2. роЙроЩрпНроХро│рпН рокродро┐ро▓ро┐ройрпН роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓рпН, роирпАроЩрпНроХро│рпН рокрпКродрпБро╡ро╛рой роЕро▓рпНро▓родрпБ роХроЯро╡рпБроЪрпНроЪрпКро▒рпНроХро│рпБроЯройрпН роХрпВроЯро┐роп роХро┐ро│рпИропрогрпНроЯрпН рокропройрпНрокроЯрпБродрпНродрпБро╡рпАро░рпНроХро│ро╛?  
3. Microsoft Graph-роХрпНроХрпБ роОродро┐ро░ро╛роХ роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпИроЪрпН роЪрпЖропрпНроп роЙроЩрпНроХро│рпН MCP роЪро░рпНро╡ро░рпН роОроирпНрод роЕройрпБроородро┐ропрпИ роХрпЛро░рпБроорпН?  

## роЪрпЖропро▓рпНроорпБро▒рпИ рокропро┐ро▒рпНроЪро┐роХро│рпН  

### рокропро┐ро▒рпНроЪро┐ 1: Entra ID-ро▓рпН роТро░рпБ рокропройрпНрокро╛роЯрпНроЯрпИ рокродро┐ро╡рпБ роЪрпЖропрпНропро╡рпБроорпН  
Microsoft Entra рокрпЛро░рпНроЯро▓рпБроХрпНроХрпБ роЪрпЖро▓рпНро▓ро╡рпБроорпН.  
роЙроЩрпНроХро│рпН MCP роЪро░рпНро╡ро░рпБроХрпНроХро╛рой рокрпБродро┐роп рокропройрпНрокро╛роЯрпНроЯрпИ рокродро┐ро╡рпБ роЪрпЖропрпНропро╡рпБроорпН.  
Application (client) ID рооро▒рпНро▒рпБроорпН Directory (tenant) ID-роР рокродро┐ро╡рпБ роЪрпЖропрпНропро╡рпБроорпН.  

### рокропро┐ро▒рпНроЪро┐ 2: роЙро│рпНро│рпВро░рпН MCP роЪро░рпНро╡ро░рпИ рокро╛родрпБроХро╛роХрпНроХро╡рпБроорпН (рокрпКродрпБ роХро┐ро│рпИропрогрпНроЯрпН)  
- рокропройро░рпН роЕроЩрпНроХрпАроХро╛ро░родрпНродро┐ро▒рпНроХро╛рой MSAL (Microsoft Authentication Library) роР роТро░рпБроЩрпНроХро┐рогрпИроХрпНроХ роХрпБро▒ро┐ропрпАроЯрпНроЯрпБ роЙродро╛ро░рогродрпНродрпИрокрпН рокро┐ройрпНрокро▒рпНро▒ро╡рпБроорпН.  
- Microsoft Graph-ро▓рпН роЗро░рпБроирпНродрпБ рокропройро░рпН ро╡ро┐ро╡ро░роЩрпНроХро│рпИ рокрпЖро▒рпБроорпН MCP роХро░рпБро╡ро┐ропрпИ роЕро┤рпИродрпНродрпБ роЕроЩрпНроХрпАроХро╛ро░ роЪрпЖропро▓рпНроорпБро▒рпИропрпИ роЪрпЛродро┐роХрпНроХро╡рпБроорпН.  

### рокропро┐ро▒рпНроЪро┐ 3: родрпКро▓рпИ MCP роЪро░рпНро╡ро░рпИ рокро╛родрпБроХро╛роХрпНроХро╡рпБроорпН (роХроЯро╡рпБроЪрпНроЪрпКро▒рпНроХро│рпБроЯройрпН роХрпВроЯро┐роп роХро┐ро│рпИропрогрпНроЯрпН)  
- Entra ID-ро▓рпН роТро░рпБ Confidential Client-роР рокродро┐ро╡рпБ роЪрпЖропрпНродрпБ, роТро░рпБ Client Secret роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН.  
- Authorization Code Flow роР рокропройрпНрокроЯрпБродрпНрод роЙроЩрпНроХро│рпН Express.js MCP роЪро░рпНро╡ро░рпИ роЕроорпИроХрпНроХро╡рпБроорпН.  
- рокро╛родрпБроХро╛роХрпНроХрокрпНрокроЯрпНроЯ роорпБроЯрпБроХрпНроХроЩрпНроХро│рпИ роЪрпЛродро┐родрпНродрпБ, роЯрпЛроХрпНроХройрпН роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓ро╛рой роЕрогрпБроХро▓рпИ роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНродро╡рпБроорпН.  

### рокропро┐ро▒рпНроЪро┐ 4: рокро╛родрпБроХро╛рокрпНрокрпБ роЪро┐ро▒роирпНрод роироЯрпИроорпБро▒рпИроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН  
- роЙроЩрпНроХро│рпН роЙро│рпНро│рпВро░рпН роЕро▓рпНро▓родрпБ родрпКро▓рпИ роЪро░рпНро╡ро░рпБроХрпНроХрпБ HTTPS-роР роЗропроХрпНроХро╡рпБроорпН.  
- роЙроЩрпНроХро│рпН роЪро░рпНро╡ро░рпН ро▓ро╛роЬро┐роХрпНроХро┐ро▓рпН рокро╛родрпНродро┐ро░ роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓ро╛рой роЕрогрпБроХро▓рпН роХроЯрпНроЯрпБрокрпНрокро╛роЯрпНроЯрпИ (RBAC) роЪрпЖропро▓рпНрокроЯрпБродрпНродро╡рпБроорпН.  
- роЯрпЛроХрпНроХройрпН роХро╛ро▓ро╛ро╡родро┐ропро╛ройродрпИ роХрпИропро╛ро│ро╡рпБроорпН рооро▒рпНро▒рпБроорпН роЯрпЛроХрпНроХройрпН роЪрпЗрооро┐рокрпНрокрпИ рокро╛родрпБроХро╛роХрпНроХро╡рпБроорпН.  

## ро╡ро│роЩрпНроХро│рпН  

1. **MSAL роХрогрпНрогрпЛроЯрпНроЯ роЖро╡рогроЩрпНроХро│рпН**  
   Microsoft Authentication Library (MSAL) рокро▓ родро│роЩрпНроХро│ро┐ро▓рпН рокро╛родрпБроХро╛рокрпНрокро╛рой роЯрпЛроХрпНроХройрпН рокрпЖро▒рпБродро▓рпИ роОро╡рпНро╡ро╛ро▒рпБ роЪрпЖропро▓рпНрокроЯрпБродрпНродрпБроХро┐ро▒родрпБ роОройрпНрокродрпИ роЕро▒ро┐роХ:  
   [MSAL Overview on Microsoft Learn](https://learn.microsoft.com/en-gb/entra/msal/overview)  

2. **Azure-Samples/mcp-auth-servers GitHub Repository**  
   роЕроЩрпНроХрпАроХро╛ро░ роЪрпЖропро▓рпНроорпБро▒рпИроХро│рпИ ро╡ро┐ро│роХрпНроХрпБроорпН MCP роЪро░рпНро╡ро░рпНроХро│ро┐ройрпН роХрпБро▒ро┐ропрпАроЯрпНроЯрпБ роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпН:  
   [Azure-Samples/mcp-auth-servers on GitHub](https://github.com/Azure-Samples/mcp-auth-servers)  

3. **Azure ро╡ро│роЩрпНроХро│рпБроХрпНроХро╛рой роорпЗро▓ро╛рогрпНроорпИ роЕроЯрпИропро╛ро│роЩрпНроХро│рпН роХрогрпНрогрпЛроЯрпНроЯроорпН**  
   роЕроорпИрокрпНрокрпБ роЕро▓рпНро▓родрпБ рокропройро░рпН роТродрпБроХрпНроХрокрпНрокроЯрпНроЯ роорпЗро▓ро╛рогрпНроорпИ роЕроЯрпИропро╛ро│роЩрпНроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ ро░роХроЪро┐ропроЩрпНроХро│рпИ роирпАроХрпНроХрпБро╡родрпБ роОрокрпНрокроЯро┐ роОройрпНрокродрпИрокрпН рокрпБро░ро┐роирпНродрпБроХрпКро│рпНро│ро╡рпБроорпН:  
   [Managed Identities Overview on Microsoft Learn](https://learn.microsoft.com/en-us/entra/identity/managed-identities-azure-resources/)  

4. **Azure API Management: MCP роЪро░рпНро╡ро░рпНроХро│рпБроХрпНроХро╛рой роЙроЩрпНроХро│рпН роЕроЩрпНроХрпАроХро╛ро░ ро╡ро╛ропро┐ро▓рпН**  
   MCP роЪро░рпНро╡ро░рпНроХро│рпБроХрпНроХро╛рой рокро╛родрпБроХро╛рокрпНрокро╛рой OAuth2 ро╡ро╛ропро┐ро▓ро╛роХ APIM роР рокропройрпНрокроЯрпБродрпНродрпБро╡родрпБ рокро▒рпНро▒ро┐роп ро╡ро┐ро░ро┐ро╡ро╛рой ро╡ро┐ро│роХрпНроХроорпН:  
   [Azure API Management Your Auth Gateway For MCP Servers](https://techcommunity.microsoft.com/blog/integrationsonazureblog/azure-api-management-your-auth-gateway-for-mcp-servers/4402690)  

5. **Microsoft Graph роЕройрпБроородро┐роХро│рпН роХрпБро▒ро┐рокрпНрокрпБ**  
   Microsoft Graph-роХрпНроХрпБ роТродрпБроХрпНроХрокрпНрокроЯрпНроЯ рооро▒рпНро▒рпБроорпН рокропройрпНрокро╛роЯрпНроЯрпБ роЕройрпБроородро┐роХро│ро┐ройрпН ро╡ро┐ро░ро┐ро╡ро╛рой рокроЯрпНроЯро┐ропро▓рпН:  
   [Microsoft Graph Permissions Reference](https://learn.microsoft.com/zh-tw/graph/permissions-reference)  

## роХро▒рпНро▒ро▓рпН роорпБроЯро┐ро╡рпБроХро│рпН  
роЗроирпНрод рокро┐ро░ро┐ро╡рпИ роорпБроЯро┐родрпНрод рокро┐ро▒роХрпБ, роирпАроЩрпНроХро│рпН:  

- MCP роЪро░рпНро╡ро░рпНроХро│рпН рооро▒рпНро▒рпБроорпН AI ро╡рпЗро▓рпИрокрпНрокро╛роЯрпБроХро│рпБроХрпНроХрпБ роЕроЩрпНроХрпАроХро╛ро░роорпН роПройрпН роорпБроХрпНроХро┐ропрооро╛ройродрпБ роОройрпНрокродрпИ ро╡ро┐ро│роХрпНроХ роорпБроЯро┐ропрпБроорпН.  
- роЙро│рпНро│рпВро░рпН рооро▒рпНро▒рпБроорпН родрпКро▓рпИ MCP роЪро░рпНро╡ро░рпН роЪрпВро┤ро▓рпНроХро│рпБроХрпНроХрпБ Entra ID роЕроЩрпНроХрпАроХро╛ро░родрпНродрпИ роЕроорпИродрпНродрпБ, роХроЯрпНроЯроорпИроХрпНроХ роорпБроЯро┐ропрпБроорпН.  
- роЙроЩрпНроХро│рпН роЪро░рпНро╡ро░ро┐ройрпН рокро┐ро░роЪро╛ро░родрпНродро┐ройрпН роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓рпН роЪро░ро┐ропро╛рой роХро┐ро│рпИропрогрпНроЯрпН ро╡роХрпИропрпИ (рокрпКродрпБ роЕро▓рпНро▓родрпБ Confidential) родрпЗро░рпНро╡рпБ роЪрпЖропрпНроп роорпБроЯро┐ропрпБроорпН.  
- роЯрпЛроХрпНроХройрпН роЪрпЗрооро┐рокрпНрокрпБ рооро▒рпНро▒рпБроорпН рокро╛родрпНродро┐ро░ роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓ро╛рой роЕроЩрпНроХрпАроХро╛ро░роорпН рокрпЛройрпНро▒ рокро╛родрпБроХро╛рокрпНрокро╛рой роХрпБро▒ро┐ропрпАроЯрпНроЯрпБ роироЯрпИроорпБро▒рпИроХро│рпИ роЪрпЖропро▓рпНрокроЯрпБродрпНрод роорпБроЯро┐ропрпБроорпН.  
- MCP роЪро░рпНро╡ро░рпН рооро▒рпНро▒рпБроорпН роЕродройрпН роХро░рпБро╡ро┐роХро│рпИ роЕройрпБроородро┐ропро┐ро▓рпНро▓ро╛род роЕрогрпБроХро▓ро┐ро▓ро┐ро░рпБроирпНродрпБ родройрпНройроорпНрокро┐роХрпНроХрпИропрпБроЯройрпН рокро╛родрпБроХро╛роХрпНроХ роорпБроЯро┐ропрпБроорпН.  

## роЕроЯрпБродрпНродродрпБ  

- [5.13 рооро╛роЯро▓рпН роЪрпВро┤ро▓рпН роирпЖро▒ро┐роорпБро▒рпИ (MCP) Azure AI Foundry роЙроЯройрпН роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБ](../mcp-foundry-agent-integration/README.md)  

---

**роЕро▒ро┐ро╡ро┐рокрпНрокрпБ**:  
роЗроирпНрод роЖро╡рогроорпН [Co-op Translator](https://github.com/Azure/co-op-translator) роОройрпНро▒ AI роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБ роЪрпЗро╡рпИропрпИ рокропройрпНрокроЯрпБродрпНродро┐ роорпКро┤ро┐рокрпЖропро░рпНроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБ. роиро╛роЩрпНроХро│рпН родрпБро▓рпНро▓ро┐ропродрпНродро┐ро▒рпНроХро╛роХ роорпБропро▒рпНроЪро┐роХрпНроХро┐ро▒рпЛроорпН, роЖройро╛ро▓рпН родро╛ройро┐ропроЩрпНроХро┐ роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБроХро│ро┐ро▓рпН рокро┐ро┤рпИроХро│рпН роЕро▓рпНро▓родрпБ родро╡ро▒рпБроХро│рпН роЗро░рпБроХрпНроХроХрпНроХрпВроЯрпБроорпН роОройрпНрокродрпИ роХро╡ройродрпНродро┐ро▓рпН роХрпКро│рпНро│ро╡рпБроорпН. роЕродройрпН роЪрпКроирпНрод роорпКро┤ро┐ропро┐ро▓рпН роЙро│рпНро│ роорпВро▓ роЖро╡рогроорпН роЕродро┐роХро╛ро░рокрпНрокрпВро░рпНро╡ роЖродро╛ро░рооро╛роХ роХро░рпБродрокрпНрокроЯ ро╡рпЗрогрпНроЯрпБроорпН. роорпБроХрпНроХро┐ропрооро╛рой родроХро╡ро▓рпНроХро│рпБроХрпНроХрпБ, родрпКро┤ро┐ро▓рпНроорпБро▒рпИ рооройро┐род роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБ рокро░ро┐роирпНродрпБро░рпИроХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ. роЗроирпНрод роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБро╡родро╛ро▓рпН роПро▒рпНрокроЯрпБроорпН роОроирпНрод родро╡ро▒ро╛рой рокрпБро░ро┐родро▓рпНроХро│рпБроХрпНроХрпБроорпН роЕро▓рпНро▓родрпБ родро╡ро▒ро╛рой ро╡ро┐ро│роХрпНроХроЩрпНроХро│рпБроХрпНроХрпБроорпН роиро╛роЩрпНроХро│рпН рокрпКро▒рпБрокрпНрокро▓рпНро▓.