# –î–µ—Ç–∞—ô–∞–Ω –ø—Ä–µ–≥–ª–µ–¥ —Ñ—É–Ω–∫—Ü–∏—ò–∞ MCP –ø—Ä–æ—Ç–æ–∫–æ–ª–∞

–û–≤–∞—ò –≤–æ–¥–∏—á –∏—Å—Ç—Ä–∞–∂—É—ò–µ –Ω–∞–ø—Ä–µ–¥–Ω–µ —Ñ—É–Ω–∫—Ü–∏—ò–µ MCP –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –∫–æ—ò–µ –ø—Ä–µ–≤–∞–∑–∏–ª–∞–∑–µ –æ—Å–Ω–æ–≤–Ω–æ —Ä—É–∫–æ–≤–∞—ö–µ –∞–ª–∞—Ç–∫–∞–º–∞ –∏ —Ä–µ—Å—É—Ä—Å–∏–º–∞. –†–∞–∑—É–º–µ–≤–∞—ö–µ –æ–≤–∏—Ö —Ñ—É–Ω–∫—Ü–∏—ò–∞ –ø–æ–º–∞–∂–µ –≤–∞–º –¥–∞ –Ω–∞–ø—Ä–∞–≤–∏—Ç–µ —Ä–æ–±—É—Å–Ω–∏—ò–µ, –ø—Ä–∏—ò–∞—Ç–Ω–∏—ò–µ –∑–∞ –∫–æ—Ä–∏—Å–Ω–∏–∫–µ –∏ —Å–ø—Ä–µ–º–Ω–µ –∑–∞ –ø—Ä–æ–¥—É–∫—Ü–∏—ò—É MCP —Å–µ—Ä–≤–µ—Ä–µ.

## –û–±—É—Ö–≤–∞—õ–µ–Ω–µ —Ñ—É–Ω–∫—Ü–∏—ò–µ

1. **–û–±–∞–≤–µ—à—Ç–µ—ö–∞ –æ –Ω–∞–ø—Ä–µ—Ç–∫—É** - –ò–∑–≤–µ—à—Ç–∞–≤–∞—ö–µ –æ –Ω–∞–ø—Ä–µ—Ç–∫—É –∑–∞ –¥—É–≥–æ—Ç—Ä–∞—ò–Ω–µ –æ–ø–µ—Ä–∞—Ü–∏—ò–µ  
2. **–û—Ç–∫–∞–∑–∏–≤–∞—ö–µ –∑–∞—Ö—Ç–µ–≤–∞** - –û–º–æ–≥—É—õ–∞–≤–∞ –∫–ª–∏—ò–µ–Ω—Ç–∏–º–∞ –¥–∞ –æ—Ç–∫–∞–∂—É —Ç—Ä–µ–Ω—É—Ç–Ω–µ –∑–∞—Ö—Ç–µ–≤–µ  
3. **–®–∞–±–ª–æ–Ω–∏ —Ä–µ—Å—É—Ä—Å–∞** - –î–∏–Ω–∞–º–∏—á–∫–∏ URI —Ä–µ—Å—É—Ä—Å–∞ —Å–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–º–∞  
4. **–î–æ–≥–∞—í–∞—ò–∏ –∂–∏–≤–æ—Ç–Ω–æ–≥ —Ü–∏–∫–ª—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞** - –ü—Ä–∞–≤–∏–ª–Ω–∞ –∏–Ω–∏—Ü–∏—ò–∞–ª–∏–∑–∞—Ü–∏—ò–∞ –∏ –∏—Å–∫—ô—É—á–µ—ö–µ  
5. **–ö–æ–Ω—Ç—Ä–æ–ª–∞ –ª–æ–≥–æ–≤–∞—ö–∞** - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—ò–∞ –ª–æ–≥–æ–≤–∞—ö–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏ —Å–µ—Ä–≤–µ—Ä–∞  
6. **–û–±—Ä–∞—Å—Ü–∏ —Ä—É–∫–æ–≤–∞—ö–∞ –≥—Ä–µ—à–∫–∞–º–∞** - –ö–æ–Ω–∑–∏—Å—Ç–µ–Ω—Ç–Ω–∏ –æ–¥–≥–æ–≤–æ—Ä–∏ –Ω–∞ –≥—Ä–µ—à–∫–µ

---

## 1. –û–±–∞–≤–µ—à—Ç–µ—ö–∞ –æ –Ω–∞–ø—Ä–µ—Ç–∫—É

–ó–∞ –æ–ø–µ—Ä–∞—Ü–∏—ò–µ –∫–æ—ò–µ —Ç—Ä–∞—ò—É (–æ–±—Ä–∞–¥–∞ –ø–æ–¥–∞—Ç–∞–∫–∞, –ø—Ä–µ—É–∑–∏–º–∞—ö–µ —Ñ–∞—ò–ª–æ–≤–∞, API –ø–æ–∑–∏–≤–∏), –æ–±–∞–≤–µ—à—Ç–µ—ö–∞ –æ –Ω–∞–ø—Ä–µ—Ç–∫—É –¥—Ä–∂–µ –∫–æ—Ä–∏—Å–Ω–∏–∫–µ –∏–Ω—Ñ–æ—Ä–º–∏—Å–∞–Ω–∏–º.

### –ö–∞–∫–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—à–µ

```mermaid
sequenceDiagram
    participant Client
    participant Server
    
    Client->>Server: tools/call (–¥—É–≥–∞ –æ–ø–µ—Ä–∞—Ü–∏—ò–∞)
    Server-->>Client: –æ–±–∞–≤–µ—à—Ç–µ—ö–µ: –Ω–∞–ø—Ä—Ä–µ–¥–∞–∫ 10%
    Server-->>Client: –æ–±–∞–≤–µ—à—Ç–µ—ö–µ: –Ω–∞–ø—Ä—Ä–µ–¥–∞–∫ 50%
    Server-->>Client: –æ–±–∞–≤–µ—à—Ç–µ—ö–µ: –Ω–∞–ø—Ä—Ä–µ–¥–∞–∫ 90%
    Server->>Client: —Ä–µ–∑—É–ª—Ç–∞—Ç (–∑–∞–≤—Ä—à–µ–Ω–æ)
```  
### Python –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—ò–∞

```python
from mcp.server import Server, NotificationOptions
from mcp.types import ProgressNotification
import asyncio

app = Server("progress-server")

@app.tool()
async def process_large_file(file_path: str, ctx) -> str:
    """Process a large file with progress updates."""
    
    # –î–æ–±–∏—ò –≤–µ–ª–∏—á–∏–Ω—É –¥–∞—Ç–æ—Ç–µ–∫–µ –∑–∞ –∏–∑—Ä–∞—á—É–Ω–∞–≤–∞—ö–µ –Ω–∞–ø—Ä–µ—Ç–∫–∞
    file_size = os.path.getsize(file_path)
    processed = 0
    
    with open(file_path, 'rb') as f:
        while chunk := f.read(8192):
            # –û–±—Ä–∞–¥–∏ –¥–µ–æ
            await process_chunk(chunk)
            processed += len(chunk)
            
            # –ü–æ—à–∞—ô–∏ –æ–±–∞–≤–µ—à—Ç–µ—ö–µ –æ –Ω–∞–ø—Ä–µ—Ç–∫—É
            progress = (processed / file_size) * 100
            await ctx.send_notification(
                ProgressNotification(
                    progressToken=ctx.request_id,
                    progress=progress,
                    total=100,
                    message=f"Processing: {progress:.1f}%"
                )
            )
    
    return f"Processed {file_size} bytes"

@app.tool()
async def batch_operation(items: list[str], ctx) -> str:
    """Process multiple items with progress."""
    
    results = []
    total = len(items)
    
    for i, item in enumerate(items):
        result = await process_item(item)
        results.append(result)
        
        # –ü—Ä–∏—ò–∞–≤–∏ –Ω–∞–ø—Ä–µ–¥–∞–∫ –Ω–∞–∫–æ–Ω —Å–≤–∞–∫–æ–≥ –ø—Ä–µ–¥–º–µ—Ç–∞
        await ctx.send_notification(
            ProgressNotification(
                progressToken=ctx.request_id,
                progress=i + 1,
                total=total,
                message=f"Processed {i + 1}/{total}: {item}"
            )
        )
    
    return f"Completed {total} items"
```
  
### TypeScript –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—ò–∞

```typescript
import { Server } from "@modelcontextprotocol/sdk/server/index.js";

server.setRequestHandler(CallToolSchema, async (request, extra) => {
  const { name, arguments: args } = request.params;
  
  if (name === "process_data") {
    const items = args.items as string[];
    const results = [];
    
    for (let i = 0; i < items.length; i++) {
      const result = await processItem(items[i]);
      results.push(result);
      
      // –ü–æ—à–∞—ô–∏ –æ–±–∞–≤–µ—à—Ç–µ—ö–µ –æ –Ω–∞–ø—Ä–µ—Ç–∫—É
      await extra.sendNotification({
        method: "notifications/progress",
        params: {
          progressToken: request.id,
          progress: i + 1,
          total: items.length,
          message: `Processing item ${i + 1}/${items.length}`
        }
      });
    }
    
    return { content: [{ type: "text", text: JSON.stringify(results) }] };
  }
});
```
  
### –†—É–∫–æ–≤–æ–¥–µ—ö–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏ –∫–ª–∏—ò–µ–Ω—Ç–∞ (Python)

```python
async def handle_progress(notification):
    """Handle progress notifications from server."""
    params = notification.params
    print(f"Progress: {params.progress}/{params.total} - {params.message}")

# –†–µ–≥–∏—Å—Ç—Ä—É—ò –æ–±—Ä–∞—í–∏–≤–∞—á
session.on_notification("notifications/progress", handle_progress)

# –ü–æ–∑–æ–≤–∏ –∞–ª–∞—Ç (–∞–∂—É—Ä–∏—Ä–∞—ö–∞ –Ω–∞–ø—Ä–µ—Ç–∫–∞ —õ–µ —Å—Ç–∏–∑–∞—Ç–∏ –ø—Ä–µ–∫–æ –æ–±—Ä–∞—í–∏–≤–∞—á–∞)
result = await session.call_tool("process_large_file", {"file_path": "/data/large.csv"})
```
  
---

## 2. –û—Ç–∫–∞–∑–∏–≤–∞—ö–µ –∑–∞—Ö—Ç–µ–≤–∞

–û–º–æ–≥—É—õ–∏—Ç–µ –∫–ª–∏—ò–µ–Ω—Ç–∏–º–∞ –¥–∞ –æ—Ç–∫–∞–∂—É –∑–∞—Ö—Ç–µ–≤–µ –∫–æ—ò–∏ –≤–∏—à–µ –Ω–∏—Å—É –ø–æ—Ç—Ä–µ–±–Ω–∏ –∏–ª–∏ –∫–æ—ò–∏ –ø—Ä–µ–¥—É–≥–æ —Ç—Ä–∞—ò—É.

### Python –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—ò–∞

```python
from mcp.server import Server
from mcp.types import CancelledError
import asyncio

app = Server("cancellable-server")

@app.tool()
async def long_running_search(query: str, ctx) -> str:
    """Search that can be cancelled."""
    
    results = []
    
    try:
        for page in range(100):  # –ü—Ä–µ—Ç—Ä–∞–∂–∏ –∫—Ä–æ–∑ –º–Ω–æ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞
            # –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞ –ª–∏ —ò–µ –∑–∞—Ç—Ä–∞–∂–µ–Ω–æ –æ—Ç–∫–∞–∑–∏–≤–∞—ö–µ
            if ctx.is_cancelled:
                raise CancelledError("Search cancelled by user")
            
            # –°–∏–º—É–ª–∏—Ä–∞ –ø—Ä–µ—Ç—Ä–∞–≥—É —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            page_results = await search_page(query, page)
            results.extend(page_results)
            
            # –ú–∞–ª–æ –æ–¥–ª–∞–≥–∞—ö–µ –æ–º–æ–≥—É—õ–∞–≤–∞ –ø—Ä–æ–≤–µ—Ä–µ –æ—Ç–∫–∞–∑–∏–≤–∞—ö–∞
            await asyncio.sleep(0.1)
            
    except CancelledError:
        # –í—Ä–∞—Ç–∏ –¥–µ–ª–∏–º–∏—á–Ω–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–µ
        return f"Cancelled. Found {len(results)} results before cancellation."
    
    return f"Found {len(results)} total results"

@app.tool()
async def download_file(url: str, ctx) -> str:
    """Download with cancellation support."""
    
    async with aiohttp.ClientSession() as session:
        async with session.get(url) as response:
            total_size = int(response.headers.get('content-length', 0))
            downloaded = 0
            chunks = []
            
            async for chunk in response.content.iter_chunked(8192):
                if ctx.is_cancelled:
                    return f"Download cancelled at {downloaded}/{total_size} bytes"
                
                chunks.append(chunk)
                downloaded += len(chunk)
            
            return f"Downloaded {downloaded} bytes"
```
  
### –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—ò–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –æ—Ç–∫–∞–∑–∏–≤–∞—ö–∞

```python
class CancellableContext:
    """Context object that tracks cancellation state."""
    
    def __init__(self, request_id: str):
        self.request_id = request_id
        self._cancelled = asyncio.Event()
        self._cancel_reason = None
    
    @property
    def is_cancelled(self) -> bool:
        return self._cancelled.is_set()
    
    def cancel(self, reason: str = "Cancelled"):
        self._cancel_reason = reason
        self._cancelled.set()
    
    async def check_cancelled(self):
        """Raise if cancelled, otherwise continue."""
        if self.is_cancelled:
            raise CancelledError(self._cancel_reason)
    
    async def sleep_or_cancel(self, seconds: float):
        """Sleep that can be interrupted by cancellation."""
        try:
            await asyncio.wait_for(
                self._cancelled.wait(),
                timeout=seconds
            )
            raise CancelledError(self._cancel_reason)
        except asyncio.TimeoutError:
            pass  # –ù–æ—Ä–º–∞–ª–Ω–æ –∏—Å—Ç–µ–∫–ª–æ –≤—Ä–µ–º–µ, –Ω–∞—Å—Ç–∞–≤–∏—Ç–µ
```
  
### –û—Ç–∫–∞–∑–∏–≤–∞—ö–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏ –∫–ª–∏—ò–µ–Ω—Ç–∞

```python
import asyncio

async def search_with_timeout(session, query, timeout=30):
    """Search with automatic cancellation on timeout."""
    
    task = asyncio.create_task(
        session.call_tool("long_running_search", {"query": query})
    )
    
    try:
        result = await asyncio.wait_for(task, timeout=timeout)
        return result
    except asyncio.TimeoutError:
        # –ó–∞—Ö—Ç–µ–≤ –∑–∞ –æ—Ç–∫–∞–∑–∏–≤–∞—ö–µ
        await session.send_notification({
            "method": "notifications/cancelled",
            "params": {"requestId": task.request_id, "reason": "Timeout"}
        })
        return "Search timed out"
```
  
---

## 3. –®–∞–±–ª–æ–Ω–∏ —Ä–µ—Å—É—Ä—Å–∞

–®–∞–±–ª–æ–Ω–∏ —Ä–µ—Å—É—Ä—Å–∞ –æ–º–æ–≥—É—õ–∞–≤–∞—ò—É –¥–∏–Ω–∞–º–∏—á–∫—É –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—ò—É URI-–∞ —Å–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–º–∞, –∫–æ—Ä–∏—Å–Ω–æ –∑–∞ API-—ò–µ –∏ –±–∞–∑–µ –ø–æ–¥–∞—Ç–∞–∫–∞.

### –î–µ—Ñ–∏–Ω–∏—Å–∞—ö–µ —à–∞–±–ª–æ–Ω–∞

```python
from mcp.server import Server
from mcp.types import ResourceTemplate

app = Server("template-server")

@app.list_resource_templates()
async def list_templates() -> list[ResourceTemplate]:
    """Return available resource templates."""
    return [
        ResourceTemplate(
            uriTemplate="db://users/{user_id}",
            name="User Profile",
            description="Fetch user profile by ID",
            mimeType="application/json"
        ),
        ResourceTemplate(
            uriTemplate="api://weather/{city}/{date}",
            name="Weather Data",
            description="Historical weather for city and date",
            mimeType="application/json"
        ),
        ResourceTemplate(
            uriTemplate="file://{path}",
            name="File Content",
            description="Read file at given path",
            mimeType="text/plain"
        )
    ]

@app.read_resource()
async def read_resource(uri: str) -> str:
    """Read resource, expanding template parameters."""
    
    # –ê–Ω–∞–ª–∏–∑–∏—Ä–∞—ò URI –¥–∞ –±–∏ –∏–∑–≤—É–∫–∞–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ
    if uri.startswith("db://users/"):
        user_id = uri.split("/")[-1]
        return await fetch_user(user_id)
    
    elif uri.startswith("api://weather/"):
        parts = uri.replace("api://weather/", "").split("/")
        city, date = parts[0], parts[1]
        return await fetch_weather(city, date)
    
    elif uri.startswith("file://"):
        path = uri.replace("file://", "")
        return await read_file(path)
    
    raise ValueError(f"Unknown resource URI: {uri}")
```
  
### TypeScript –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—ò–∞

```typescript
server.setRequestHandler(ListResourceTemplatesSchema, async () => {
  return {
    resourceTemplates: [
      {
        uriTemplate: "github://repos/{owner}/{repo}/issues/{issue_number}",
        name: "GitHub Issue",
        description: "Fetch a specific GitHub issue",
        mimeType: "application/json"
      },
      {
        uriTemplate: "db://tables/{table}/rows/{id}",
        name: "Database Row",
        description: "Fetch a row from a database table",
        mimeType: "application/json"
      }
    ]
  };
});

server.setRequestHandler(ReadResourceSchema, async (request) => {
  const uri = request.params.uri;
  
  // –ü–∞—Ä—Å–∏—Ä–∞—ò URI GitHub –ø—Ä–æ–±–ª–µ–º–∞
  const githubMatch = uri.match(/^github:\/\/repos\/([^/]+)\/([^/]+)\/issues\/(\d+)$/);
  if (githubMatch) {
    const [_, owner, repo, issueNumber] = githubMatch;
    const issue = await fetchGitHubIssue(owner, repo, parseInt(issueNumber));
    return {
      contents: [{
        uri,
        mimeType: "application/json",
        text: JSON.stringify(issue, null, 2)
      }]
    };
  }
  
  throw new Error(`Unknown resource URI: ${uri}`);
});
```
  
---

## 4. –î–æ–≥–∞—í–∞—ò–∏ –∂–∏–≤–æ—Ç–Ω–æ–≥ —Ü–∏–∫–ª—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞

–ü—Ä–∞–≤–∏–ª–Ω–æ —Ä—É–∫–æ–≤–∞—ö–µ –∏–Ω–∏—Ü–∏—ò–∞–ª–∏–∑–∞—Ü–∏—ò–æ–º –∏ –∏—Å–∫—ô—É—á–µ—ö–µ–º –æ–±–µ–∑–±–µ—í—É—ò–µ —á–∏—Å—Ç–æ —É–ø—Ä–∞–≤—ô–∞—ö–µ —Ä–µ—Å—É—Ä—Å–∏–º–∞.

### –£–ø—Ä–∞–≤—ô–∞—ö–µ –∂–∏–≤–æ—Ç–Ω–∏–º —Ü–∏–∫–ª—É—Å–æ–º —É Python-—É

```python
from mcp.server import Server
from contextlib import asynccontextmanager

app = Server("lifecycle-server")

# –ó–∞—ò–µ–¥–Ω–∏—á–∫–æ —Å—Ç–∞—ö–µ
db_connection = None
cache = None

@asynccontextmanager
async def lifespan(server: Server):
    """Manage server lifecycle."""
    global db_connection, cache
    
    # –ü–æ–∫—Ä–µ—Ç–∞—ö–µ
    print("üöÄ Server starting...")
    db_connection = await create_database_connection()
    cache = await create_cache_client()
    print("‚úÖ Resources initialized")
    
    yield  # –°–µ—Ä–≤–µ—Ä —Ä–∞–¥–∏ –æ–≤–¥–µ
    
    # –ò—Å–∫—ô—É—á–∏–≤–∞—ö–µ
    print("üõë Server shutting down...")
    await db_connection.close()
    await cache.close()
    print("‚úÖ Resources cleaned up")

app = Server("lifecycle-server", lifespan=lifespan)

@app.tool()
async def query_database(sql: str) -> str:
    """Use the shared database connection."""
    result = await db_connection.execute(sql)
    return str(result)
```
  
### –ñ–∏–≤–æ—Ç–Ω–∏ —Ü–∏–∫–ª—É—Å —É TypeScript-—É

```typescript
import { Server } from "@modelcontextprotocol/sdk/server/index.js";

class ManagedServer {
  private server: Server;
  private dbConnection: DatabaseConnection | null = null;
  
  constructor() {
    this.server = new Server({
      name: "lifecycle-server",
      version: "1.0.0"
    });
    
    this.setupHandlers();
  }
  
  async start() {
    // –ò–Ω–∏—Ü–∏—ò–∞–ª–∏–∑—É—ò —Ä–µ—Å—É—Ä—Å–µ
    console.log("üöÄ Server starting...");
    this.dbConnection = await createDatabaseConnection();
    console.log("‚úÖ Database connected");
    
    // –ü–æ–∫—Ä–µ–Ω–∏ —Å–µ—Ä–≤–µ—Ä
    await this.server.connect(transport);
  }
  
  async stop() {
    // –û—á–∏—Å—Ç–∏ —Ä–µ—Å—É—Ä—Å–µ
    console.log("üõë Server shutting down...");
    if (this.dbConnection) {
      await this.dbConnection.close();
    }
    await this.server.close();
    console.log("‚úÖ Cleanup complete");
  }
  
  private setupHandlers() {
    this.server.setRequestHandler(CallToolSchema, async (request) => {
      // –ë–µ–∑–±–µ–¥–Ω–æ –∫–æ—Ä–∏—Å—Ç–∏ this.dbConnection
      // ...
    });
  }
}

// –ö–æ—Ä–∏—à—õ–µ—ö–µ —Å–∞ –±–ª–∞–≥–∏–º –∏—Å–∫—ô—É—á–∏–≤–∞—ö–µ–º
const server = new ManagedServer();

process.on('SIGINT', async () => {
  await server.stop();
  process.exit(0);
});

await server.start();
```
  
---

## 5. –ö–æ–Ω—Ç—Ä–æ–ª–∞ –ª–æ–≥–æ–≤–∞—ö–∞

MCP –ø–æ–¥—Ä–∂–∞–≤–∞ –Ω–∏–≤–æ–µ –ª–æ–≥–æ–≤–∞—ö–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∫–æ—ò–µ –∫–ª–∏—ò–µ–Ω—Ç–∏ –º–æ–≥—É –∫–æ–Ω—Ç—Ä–æ–ª–∏—Å–∞—Ç–∏.

### –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—ò–∞ –Ω–∏–≤–æ–∞ –ª–æ–≥–æ–≤–∞—ö–∞

```python
from mcp.server import Server
from mcp.types import LoggingLevel
import logging

app = Server("logging-server")

# –ú–∞–ø–∏—Ä–∞—ò—Ç–µ MCP –Ω–∏–≤–æ–µ –Ω–∞ Python logging –Ω–∏–≤–æ–µ
LEVEL_MAP = {
    LoggingLevel.DEBUG: logging.DEBUG,
    LoggingLevel.INFO: logging.INFO,
    LoggingLevel.WARNING: logging.WARNING,
    LoggingLevel.ERROR: logging.ERROR,
}

logger = logging.getLogger("mcp-server")

@app.set_logging_level()
async def set_logging_level(level: LoggingLevel) -> None:
    """Handle client request to change logging level."""
    python_level = LEVEL_MAP.get(level, logging.INFO)
    logger.setLevel(python_level)
    logger.info(f"Logging level set to {level}")

@app.tool()
async def debug_operation(data: str) -> str:
    """Tool with various logging levels."""
    logger.debug(f"Processing data: {data}")
    
    try:
        result = process(data)
        logger.info(f"Successfully processed: {result}")
        return result
    except Exception as e:
        logger.error(f"Processing failed: {e}")
        raise
```
  
### –°–ª–∞—ö–µ –ø–æ—Ä—É–∫–∞ –ª–æ–≥–∞ –∫–∞ –∫–ª–∏—ò–µ–Ω—Ç—É

```python
@app.tool()
async def complex_operation(input: str, ctx) -> str:
    """Operation that logs to client."""
    
    # –ü–æ—à–∞—ô–∏ –æ–±–∞–≤–µ—à—Ç–µ—ö–µ –æ –¥–Ω–µ–≤–Ω–∏–∫—É –∫–ª–∏—ò–µ–Ω—Ç—É
    await ctx.send_log(
        level="info",
        message=f"Starting complex operation with input: {input}"
    )
    
    # –û–±–∞–≤—ô–∞—ö–µ —Ä–∞–¥–∞...
    result = await do_work(input)
    
    await ctx.send_log(
        level="debug",
        message=f"Operation complete, result size: {len(result)}"
    )
    
    return result
```
  
---

## 6. –û–±—Ä–∞—Å—Ü–∏ —Ä—É–∫–æ–≤–∞—ö–∞ –≥—Ä–µ—à–∫–∞–º–∞

–ö–æ–Ω–∑–∏—Å—Ç–µ–Ω—Ç–Ω–æ —Ä—É–∫–æ–≤–∞—ö–µ –≥—Ä–µ—à–∫–∞–º–∞ —É–Ω–∞–ø—Ä–µ—í—É—ò–µ –æ—Ç–∫–ª–∞—ö–∞—ö–µ –≥—Ä–µ—à–∞–∫–∞ –∏ –∫–æ—Ä–∏—Å–Ω–∏—á–∫–æ –∏—Å–∫—É—Å—Ç–≤–æ.

### MCP –∫–æ–¥–æ–≤–∏ –≥—Ä–µ—à–∞–∫–∞

```python
from mcp.types import McpError, ErrorCode

class ToolError(McpError):
    """Base class for tool errors."""
    pass

class ValidationError(ToolError):
    """Invalid input parameters."""
    def __init__(self, message: str):
        super().__init__(ErrorCode.INVALID_PARAMS, message)

class NotFoundError(ToolError):
    """Requested resource not found."""
    def __init__(self, resource: str):
        super().__init__(ErrorCode.INVALID_REQUEST, f"Not found: {resource}")

class PermissionError(ToolError):
    """Access denied."""
    def __init__(self, action: str):
        super().__init__(ErrorCode.INVALID_REQUEST, f"Permission denied: {action}")

class InternalError(ToolError):
    """Internal server error."""
    def __init__(self, message: str):
        super().__init__(ErrorCode.INTERNAL_ERROR, message)
```
  
### –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–∞–Ω–∏ –æ–¥–≥–æ–≤–æ—Ä–∏ –æ –≥—Ä–µ—à–∫–∞–º–∞

```python
@app.tool()
async def safe_operation(input: str) -> str:
    """Tool with comprehensive error handling."""
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—ò–∞ —É–Ω–æ—Å–∞
    if not input:
        raise ValidationError("Input cannot be empty")
    
    if len(input) > 10000:
        raise ValidationError(f"Input too large: {len(input)} chars (max 10000)")
    
    try:
        # –ü—Ä–æ–≤–µ—Ä–∞ –¥–æ–∑–≤–æ–ª–∞
        if not await check_permission(input):
            raise PermissionError(f"read {input}")
        
        # –ò–∑–≤—Ä—à–∏ –æ–ø–µ—Ä–∞—Ü–∏—ò—É
        result = await perform_operation(input)
        
        if result is None:
            raise NotFoundError(input)
        
        return result
        
    except ConnectionError as e:
        raise InternalError(f"Database connection failed: {e}")
    except TimeoutError as e:
        raise InternalError(f"Operation timed out: {e}")
    except Exception as e:
        # –ï–≤–∏–¥–µ–Ω—Ç–∏—Ä–∞—ò –Ω–µ–æ—á–µ–∫–∏–≤–∞–Ω–µ –≥—Ä–µ—à–∫–µ
        logger.exception(f"Unexpected error in safe_operation")
        raise InternalError(f"Unexpected error: {type(e).__name__}")
```
  
### –†—É–∫–æ–≤–∞—ö–µ –≥—Ä–µ—à–∫–∞–º–∞ —É TypeScript-—É

```typescript
import { McpError, ErrorCode } from "@modelcontextprotocol/sdk/types.js";

function validateInput(data: unknown): asserts data is ValidInput {
  if (typeof data !== "object" || data === null) {
    throw new McpError(
      ErrorCode.InvalidParams,
      "Input must be an object"
    );
  }
  // –í–∏—à–µ –≤–∞–ª–∏–¥–∞—Ü–∏—ò–µ...
}

server.setRequestHandler(CallToolSchema, async (request) => {
  try {
    validateInput(request.params.arguments);
    
    const result = await performOperation(request.params.arguments);
    
    return {
      content: [{ type: "text", text: JSON.stringify(result) }]
    };
    
  } catch (error) {
    if (error instanceof McpError) {
      throw error;  // –í–µ—õ MCP –≥—Ä–µ—à–∫–∞
    }
    
    // –ü—Ä–µ—Ç–≤–æ—Ä–∏ –¥—Ä—É–≥–µ –≥—Ä–µ—à–∫–µ
    if (error instanceof NotFoundError) {
      throw new McpError(ErrorCode.InvalidRequest, error.message);
    }
    
    // –ù–µ–ø–æ–∑–Ω–∞—Ç–∞ –≥—Ä–µ—à–∫–∞
    console.error("Unexpected error:", error);
    throw new McpError(
      ErrorCode.InternalError,
      "An unexpected error occurred"
    );
  }
});
```
  
---

## –ï–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª–Ω–µ —Ñ—É–Ω–∫—Ü–∏—ò–µ (MCP 2025-11-25)

–û–≤–µ —Ñ—É–Ω–∫—Ü–∏—ò–µ —Å—É –æ–∑–Ω–∞—á–µ–Ω–µ –∫–∞–æ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª–Ω–µ —É —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—ò–∏:

### –ó–∞–¥–∞—Ü–∏ (–¥—É–≥–æ—Ç—Ä–∞—ò–Ω–µ –æ–ø–µ—Ä–∞—Ü–∏—ò–µ)

```python
# –ó–∞–¥–∞—Ü–∏ –æ–º–æ–≥—É—õ–∞–≤–∞—ò—É –ø—Ä–∞—õ–µ—ö–µ –¥—É–≥–æ—Ç—Ä–∞—ò–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏—ò–∞ —Å–∞ —Å—Ç–∞—ö–µ–º
@app.task()
async def training_task(model_id: str, data_path: str, ctx) -> str:
    """Long-running ML training task."""
    
    # –ü—Ä–∏—ò–∞–≤–∏—Ç–∏ –¥–∞ —ò–µ –∑–∞–¥–∞—Ç–∞–∫ –∑–∞–ø–æ—á–µ–æ
    await ctx.report_status("running", "Initializing training...")
    
    # –ü–µ—Ç—ô–∞ –æ–±—É–∫–µ
    for epoch in range(100):
        await train_epoch(model_id, data_path, epoch)
        await ctx.report_status(
            "running",
            f"Training epoch {epoch + 1}/100",
            progress=epoch + 1,
            total=100
        )
    
    await ctx.report_status("completed", "Training finished")
    return f"Model {model_id} trained successfully"
```
  
### –ê–Ω–æ—Ç–∞—Ü–∏—ò–µ –∞–ª–∞—Ç–∞

```python
# –ê–Ω–Ω–æ—Ç–∞—Ü–∏—ò–µ –ø—Ä—É–∂–∞—ò—É –º–µ—Ç–∞–ø–æ–¥–∞—Ç–∫–µ –æ –ø–æ–Ω–∞—à–∞—ö—É –∞–ª–∞—Ç–∞
@app.tool(
    annotations={
        "destructive": False,      # –ù–µ –º–µ—ö–∞ –ø–æ–¥–∞—Ç–∫–µ
        "idempotent": True,        # –ë–µ–∑–±–µ–¥–Ω–æ –∑–∞ –ø–æ–Ω–æ–≤–Ω–∏ –ø–æ–∫—É—à–∞—ò
        "timeout_seconds": 30,     # –û—á–µ–∫—É—ò–∞–Ω–æ –º–∞–∫—Å–∏–º–∞–ª–Ω–æ —Ç—Ä–∞—ò–∞—ö–µ
        "requires_approval": False # –ù–∏—ò–µ –ø–æ—Ç—Ä–µ–±–Ω–∞ –∫–æ—Ä–∏—Å–Ω–∏—á–∫–∞ —Å–∞–≥–ª–∞—Å–Ω–æ—Å—Ç
    }
)
async def safe_query(query: str) -> str:
    """A read-only database query tool."""
    return await execute_read_query(query)
```
  
---

## –®—Ç–∞ —Å–ª–µ–¥–∏

- [–ú–æ–¥—É–ª 8 - –ù–∞—ò–±–æ—ô–µ –ø—Ä–∞–∫—Å–µ](../../08-BestPractices/README.md)  
- [5.14 - –ò–Ω–∂–µ—ö–µ—Ä–∏–Ω–≥ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞](../mcp-contextengineering/README.md)  
- [–ò–∑–º–µ–Ω–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—ò–µ MCP](https://spec.modelcontextprotocol.io/)  

---

## –î–æ–¥–∞—Ç–Ω–∏ —Ä–µ—Å—É—Ä—Å–∏

- [MCP —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—ò–∞ 2025-11-25](https://spec.modelcontextprotocol.io/specification/2025-11-25/)  
- [JSON-RPC 2.0 –∫–æ–¥–æ–≤–∏ –≥—Ä–µ—à–∞–∫–∞](https://www.jsonrpc.org/specification#error_object)  
- [–ü—Ä–∏–º–µ—Ä–∏ Python SDK-–∞](https://github.com/modelcontextprotocol/python-sdk/tree/main/examples)  
- [–ü—Ä–∏–º–µ—Ä–∏ TypeScript SDK-–∞](https://github.com/modelcontextprotocol/typescript-sdk/tree/main/examples)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**–ò–∑—ò–∞–≤–∞ –æ –æ–¥—Ä–∏—Ü–∞—ö—É –æ–¥–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç–∏**:
–û–≤–∞—ò –¥–æ–∫—É–º–µ–Ω—Ç —ò–µ –ø—Ä–µ–≤–µ–¥–µ–Ω –∫–æ—Ä–∏—à—õ–µ—ö–µ–º –ê–ò —É—Å–ª—É–≥–µ –∑–∞ –ø—Ä–µ–≤–æ—í–µ—ö–µ [Co-op Translator](https://github.com/Azure/co-op-translator). –ò–∞–∫–æ —Ç–µ–∂–∏–º–æ —Ç–∞—á–Ω–æ—Å—Ç–∏, –∏–º–∞—ò—Ç–µ –Ω–∞ —É–º—É –¥–∞ –∞—É—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–∏ –ø—Ä–µ–≤–æ–¥–∏ –º–æ–≥—É —Å–∞–¥—Ä–∂–∞—Ç–∏ –≥—Ä–µ—à–∫–µ –∏–ª–∏ –Ω–µ—Ç–∞—á–Ω–æ—Å—Ç–∏. –û—Ä–∏–≥–∏–Ω–∞–ª–Ω–∏ –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ —ö–µ–≥–æ–≤–æ–º –∏–∑–≤–æ—Ä–Ω–æ–º —ò–µ–∑–∏–∫—É —Ç—Ä–µ–±–∞ —Å–º–∞—Ç—Ä–∞—Ç–∏ –∞—É—Ç–æ—Ä–∏—Ç–∞—Ç–∏–≤–Ω–∏–º –∏–∑–≤–æ—Ä–æ–º. –ó–∞ –∫—Ä–∏—Ç–∏—á–Ω–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—ò–µ –ø—Ä–µ–ø–æ—Ä—É—á—É—ò–µ —Å–µ –ø—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–Ω–∏ —ô—É–¥—Å–∫–∏ –ø—Ä–µ–≤–æ–¥. –ù–∏—Å–º–æ –æ–¥–≥–æ–≤–æ—Ä–Ω–∏ –∑–∞ –±–∏–ª–æ –∫–∞–∫–≤–∞ –Ω–µ—Å–ø–æ—Ä–∞–∑—É–º–µ–≤–∞—ö–∞ –∏–ª–∏ –ø–æ–≥—Ä–µ—à–Ω–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—ò–µ –∫–æ—ò–µ –º–æ–≥—É –ø—Ä–æ–∏—Å—Ç–µ—õ–∏ –∏–∑ —É–ø–æ—Ç—Ä–µ–±–µ –æ–≤–æ–≥ –ø—Ä–µ–≤–æ–¥–∞.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->