<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "5b00b8a8971a07d2d8803be4c9f138f8",
  "translation_date": "2025-12-11T12:17:34+00:00",
  "source_file": "03-GettingStarted/11-simple-auth/README.md",
  "language_code": "ml"
}
-->
# ലളിതമായ ഓത്ത്

MCP SDKകൾ OAuth 2.1 ഉപയോഗിക്കുന്നതിന് പിന്തുണ നൽകുന്നു, ഇത് സത്യത്തിൽ ഒരു സങ്കീർണ്ണമായ പ്രക്രിയയാണ്, അതിൽ ഓത്ത് സർവർ, റിസോഴ്‌സ് സർവർ, ക്രെഡൻഷ്യലുകൾ പോസ്റ്റ് ചെയ്യൽ, ഒരു കോഡ് ലഭിക്കൽ, കോഡ് ഒരു ബിയറർ ടോക്കനായി മാറ്റൽ എന്നിവ ഉൾപ്പെടുന്നു, ഇതുവരെ നിങ്ങൾക്ക് നിങ്ങളുടെ റിസോഴ്‌സ് ഡാറ്റ finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally finally
Next, let's look into role based access control, also known as RBAC.

## Adding role based access control

The idea is that we want to express that different roles have different permissions. For example, we assume an admin can do everything and that a normal users can do read/write and that a guest can only read. Therefore, here are some possible permission levels:

- Admin.Write 
- User.Read
- Guest.Read

Let's look at how we can implement such a control with middleware. Middlewares can be added per route as well as for all routes.

**Python**

```python
from starlette.middleware.base import BaseHTTPMiddleware
from starlette.responses import JSONResponse
import jwt

# രഹസ്യം കോഡിൽ ഇങ്ങനെ വെക്കരുത്, ഇത് പ്രദർശനത്തിനായാണ് മാത്രം. സുരക്ഷിതമായ സ്ഥലത്ത് നിന്ന് വായിക്കുക.
SECRET_KEY = "your-secret-key" # ഇത് എൻവൈറൺമെന്റ് വേരിയബിളിൽ വെക്കുക
REQUIRED_PERMISSION = "User.Read"

class JWTPermissionMiddleware(BaseHTTPMiddleware):
    async def dispatch(self, request, call_next):
        auth_header = request.headers.get("Authorization")
        if not auth_header or not auth_header.startswith("Bearer "):
            return JSONResponse({"error": "Missing or invalid Authorization header"}, status_code=401)

        token = auth_header.split(" ")[1]
        try:
            decoded = jwt.decode(token, SECRET_KEY, algorithms=["HS256"])
        except jwt.ExpiredSignatureError:
            return JSONResponse({"error": "Token expired"}, status_code=401)
        except jwt.InvalidTokenError:
            return JSONResponse({"error": "Invalid token"}, status_code=401)

        permissions = decoded.get("permissions", [])
        if REQUIRED_PERMISSION not in permissions:
            return JSONResponse({"error": "Permission denied"}, status_code=403)

        request.state.user = decoded
        return await call_next(request)


```

There a few different ways to add the middleware like below:

```python

# Alt 1: സ്റ്റാർലെറ്റ് ആപ്പ് നിർമ്മിക്കുമ്പോൾ മിഡിൽവെയർ ചേർക്കുക
middleware = [
    Middleware(JWTPermissionMiddleware)
]

app = Starlette(routes=routes, middleware=middleware)

# Alt 2: സ്റ്റാർലെറ്റ് ആപ്പ് ഇതിനകം നിർമ്മിച്ചതിന് ശേഷം മിഡിൽവെയർ ചേർക്കുക
starlette_app.add_middleware(JWTPermissionMiddleware)

# Alt 3: ഓരോ റൂട്ടിനും മിഡിൽവെയർ ചേർക്കുക
routes = [
    Route(
        "/mcp",
        endpoint=..., # ഹാൻഡ്ലർ
        middleware=[Middleware(JWTPermissionMiddleware)]
    )
]
```

**TypeScript**

We can use `app.use` and a middleware that will run for all requests. 

```typescript
app.use((req, res, next) => {
    console.log('Request received:', req.method, req.url, req.headers);
    console.log('Headers:', req.headers["authorization"]);

    // 1. അനുമതി ഹെഡർ അയച്ചിട്ടുണ്ടോ എന്ന് പരിശോധിക്കുക

    if(!req.headers["authorization"]) {
        res.status(401).send('Unauthorized');
        return;
    }
    
    let token = req.headers["authorization"];

    // 2. ടോക്കൺ സാധുവാണോ എന്ന് പരിശോധിക്കുക
    if(!isValid(token)) {
        res.status(403).send('Forbidden');
        return;
    }  

    // 3. ടോക്കൺ ഉപയോക്താവ് നമ്മുടെ സിസ്റ്റത്തിൽ ഉണ്ടോ എന്ന് പരിശോധിക്കുക
    if(!isExistingUser(token)) {
        res.status(403).send('Forbidden');
        console.log("User does not exist");
        return;
    }
    console.log("User exists");

    // 4. ടോക്കണിന് ശരിയായ അനുമതികൾ ഉണ്ടോ എന്ന് സ്ഥിരീകരിക്കുക
    if(!hasScopes(token, ["User.Read"])){
        res.status(403).send('Forbidden - insufficient scopes');
    }

    console.log("User has required scopes");

    console.log('Middleware executed');
    next();
});

```

There's quite a few things we can let our middleware and that our middleware SHOULD do, namely:

1. Check if authorization header is present
2. Check if token is valid, we call `isValid` which is a method we wrote that check integrity and validity of JWT token.
3. Verify the user exist in our system, we should check this.

   ```typescript
    // ഡാറ്റാബേസിലുള്ള ഉപയോക്താക്കൾ
   const users = [
     "user1",
     "User usersson",
   ]

   function isExistingUser(token) {
     let decodedToken = verifyToken(token);

     // ചെയ്യേണ്ടത്, ഉപയോക്താവ് ഡാറ്റാബേസിൽ ഉണ്ടോ എന്ന് പരിശോധിക്കുക
     return users.includes(decodedToken?.name || "");
   }
   ```

   Above, we've created a very simple `users` list, which should be in a database obviously.

4. Additionally, we should also check the token has the right permissions.

   ```typescript
   if(!hasScopes(token, ["User.Read"])){
        res.status(403).send('Forbidden - insufficient scopes');
   }
   ```

   In this code above from the middleware, we check that the token contains User.Read permission, if not we send a 403 error. Below is the `hasScopes` helper method.

   ```typescript
   function hasScopes(scope: string, requiredScopes: string[]) {
     let decodedToken = verifyToken(scope);
    return requiredScopes.every(scope => decodedToken?.scopes.includes(scope));
  }
   ```

Have a think which additional checks you should be doing, but these are the absolute minimum of checks you should be doing.

Using Express as a web framework is a common choice. There are helpers library when you use JWT so you can write less code.

- `express-jwt`, helper library that provides a middleware that helps decode your token.
- `express-jwt-permissions`, this provides a middleware `guard` that helps check if a certain permission is on the token.

Here's what these libraries can look like when used:

```typescript
const express = require('express');
const jwt = require('express-jwt');
const guard = require('express-jwt-permissions')();

const app = express();
const secretKey = 'your-secret-key'; // put this in env variable

// Decode JWT and attach to req.user
app.use(jwt({ secret: secretKey, algorithms: ['HS256'] }));

// Check for User.Read permission
app.use(guard.check('User.Read'));

// multiple permissions
// app.use(guard.check(['User.Read', 'Admin.Access']));

app.get('/protected', (req, res) => {
  res.json({ message: `Welcome ${req.user.name}` });
});

// Error handler
app.use((err, req, res, next) => {
  if (err.code === 'permission_denied') {
    return res.status(403).send('Forbidden');
  }
  next(err);
});

```

Now you have seen how middleware can be used for both authentication and authorization, what about MCP though, does it change how we do auth? Let's find out in the next section.

### -3- Add RBAC to MCP

You've seen so far how you can add RBAC via middleware, however, for MCP there's no easy way to add a per MCP feature RBAC, so what do we do? Well, we just have to add code like this that checks in this case whether the client has the rights to call a specific tool:

You have a few different choices on how to accomplish per feature RBAC, here are some:

- Add a check for each tool, resource, prompt where you need to check permission level.

   **python**

   ```python
   @tool()
   def delete_product(id: int):
      try:
          check_permissions(role="Admin.Write", request)
      catch:
        pass # ക്ലയന്റ് അംഗീകാരം പരാജയപ്പെട്ടു, അംഗീകാരം പിശക് ഉയർത്തുക
   ```

   **typescript**

   ```typescript
   server.registerTool(
    "delete-product",
    {
      title: Delete a product",
      description: "Deletes a product",
      inputSchema: { id: z.number() }
    },
    async ({ id }) => {
      
      try {
        checkPermissions("Admin.Write", request);
        // ചെയ്യേണ്ടത്, id productService-ലും remote entry-ലും അയയ്ക്കുക
      } catch(Exception e) {
        console.log("Authorization error, you're not allowed");  
      }

      return {
        content: [{ type: "text", text: `Deletected product with id ${id}` }]
      };
    }
   );
   ```


- Use advanced server approach and the request handlers so you minimize how many places you need to make the check.

   **Python**

   ```python
   
   tool_permission = {
      "create_product": ["User.Write", "Admin.Write"],
      "delete_product": ["Admin.Write"]
   }

   def has_permission(user_permissions, required_permissions) -> bool:
      # user_permissions: ഉപയോക്താവിന് ഉള്ള അനുമതികളുടെ പട്ടിക
      # required_permissions: ടൂളിനായി ആവശ്യമായ അനുമതികളുടെ പട്ടിക
      return any(perm in user_permissions for perm in required_permissions)

   @server.call_tool()
   async def handle_call_tool(
     name: str, arguments: dict[str, str] | None
   ) -> list[types.TextContent]:
    # request.user.permissions ഉപയോക്താവിന് ഉള്ള അനുമതികളുടെ പട്ടികയാണെന്ന് കരുതുക
     user_permissions = request.user.permissions
     required_permissions = tool_permission.get(name, [])
     if not has_permission(user_permissions, required_permissions):
        # പിഴവ് ഉയർത്തുക "നിങ്ങൾക്ക് ടൂൾ {name} വിളിക്കാൻ അനുമതി ഇല്ല"
        raise Exception(f"You don't have permission to call tool {name}")
     # തുടർന്നു ടൂൾ വിളിക്കുക
     # ...
   ```   
   

   **TypeScript**

   ```typescript
   function hasPermission(userPermissions: string[], requiredPermissions: string[]): boolean {
       if (!Array.isArray(userPermissions) || !Array.isArray(requiredPermissions)) return false;
       // ഉപയോക്താവിന് കുറഞ്ഞത് ഒരു ആവശ്യമായ അനുമതി ഉണ്ടെങ്കിൽ സത്യം മടക്കുക
       
       return requiredPermissions.some(perm => userPermissions.includes(perm));
   }
  
   server.setRequestHandler(CallToolRequestSchema, async (request) => {
      const { params: { name } } = request;
  
      let permissions = request.user.permissions;
  
      if (!hasPermission(permissions, toolPermissions[name])) {
         return new Error(`You don't have permission to call ${name}`);
      }
  
      // തുടരുക..
   });
   ```

   Note, you will need to ensure your middleware assigns a decoded token to the request's user property so the code above is made simple.

### Summing up

Now that we discussed how to add support for RBAC in general and for MCP in particular, it's time to try to implement security on your own to ensure you understood the concepts presented to you.

## Assignment 1: Build an mcp server and mcp client using basic authentication

Here you will take what you've learnt in terms of sending credentials through headers.

## Solution 1

[Solution 1](./code/basic/README.md)

## Assignment 2: Upgrade the solution from Assignment 1 to use JWT

Take the first solution but this time, let's improve upon it. 

Instead of using Basic Auth, let's use JWT. 

## Solution 2

[Solution 2](./solution/jwt-solution/README.md)

## Challenge

Add the RBAC per tool that we describe in section "Add RBAC to MCP".

## Summary

You've hopefully learned a lot in this chapter, from no security at all, to basic security, to JWT and how it can be added to MCP.

We’ve built a solid foundation with custom JWTs, but as we scale, we’re moving toward a standards-based identity model. Adopting an IdP like Entra or Keycloak lets us offload token issuance, validation, and lifecycle management to a trusted platform — freeing us to focus on app logic and user experience.

For that, we have a more [advanced chapter on Entra](../../05-AdvancedTopics/mcp-security-entra/README.md)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**അസൂയാ**:  
ഈ രേഖ AI വിവർത്തന സേവനം [Co-op Translator](https://github.com/Azure/co-op-translator) ഉപയോഗിച്ച് വിവർത്തനം ചെയ്തതാണ്. നാം കൃത്യതയ്ക്ക് ശ്രമിച്ചിട്ടുണ്ടെങ്കിലും, സ്വയം പ്രവർത്തിക്കുന്ന വിവർത്തനങ്ങളിൽ പിശകുകൾ അല്ലെങ്കിൽ തെറ്റുകൾ ഉണ്ടാകാമെന്ന് ദയവായി ശ്രദ്ധിക്കുക. അതിന്റെ മാതൃഭാഷയിലുള്ള യഥാർത്ഥ രേഖ അധികാരപരമായ ഉറവിടമായി കണക്കാക്കണം. നിർണായക വിവരങ്ങൾക്ക്, പ്രൊഫഷണൽ മനുഷ്യ വിവർത്തനം ശുപാർശ ചെയ്യപ്പെടുന്നു. ഈ വിവർത്തനം ഉപയോഗിക്കുന്നതിൽ നിന്നുണ്ടാകുന്ന ഏതെങ്കിലും തെറ്റിദ്ധാരണകൾക്കോ തെറ്റായ വ്യാഖ്യാനങ്ങൾക്കോ ഞങ്ങൾ ഉത്തരവാദികളല്ല.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->